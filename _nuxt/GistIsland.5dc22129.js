import{d as H,r as m,I as h,Y as U,o as B,Z as R,$ as D,C as M,a0 as V,g as A,N as q,a1 as z,F as G,a2 as J,j as K,a3 as Q,Q as W,a4 as X,a5 as Y,l as Z,b as ee,X as te,w as ae,D as ne}from"./entry.62dc2328.js";import{u as se}from"./ssr.aa76f02f.js";const le={trailing:!0};function re(e,l=25,s={}){if(s={...le,...s},!Number.isFinite(l))throw new TypeError("Expected `wait` to be a finite number");let c,a,y=[],u,d;const g=(o,f)=>(u=ue(e,o,f),u.finally(()=>{if(u=null,s.trailing&&d&&!a){const r=g(o,d);return d=null,r}}),u);return function(...o){return u?(s.trailing&&(d=o),u):new Promise(f=>{const r=!a&&s.leading;clearTimeout(a),a=setTimeout(()=>{a=null;const x=s.leading?c:g(this,o);for(const i of y)i(x);y=[]},l),r?(c=g(this,o),f(c)):y.push(f)})}}async function ue(e,l,s){return await e.apply(l,s)}const p="_islandPromises",F=/nuxt-ssr-component-uid="([^"]*)"/,oe=/nuxt-ssr-component-uid(="([^"]*)")?/,ie=/nuxt-ssr-slot-name="([^"]*)"/g,ce=/<div nuxt-slot-fallback-start="([^"]*)"[^>]*><\/div>(((?!<div nuxt-slot-fallback-end[^>]*>)[\s\S])*)<div nuxt-slot-fallback-end[^>]*><\/div>/g;let de=0;const S=()=>(de++).toString(),fe=H({name:"NuxtIsland",props:{name:{type:String,required:!0},lazy:Boolean,props:{type:Object,default:()=>{}},context:{type:Object,default:()=>({})},source:{type:String,default:()=>{}}},async setup(e,{slots:l}){var N,j,E,L,C;const s=m(null),c=Z(),a=K(),y=h(()=>e.props?Object.fromEntries(Object.entries(e.props).filter(([t])=>!t.startsWith("data-v-"))):{}),u=h(()=>U([e.name,y.value,e.context,e.source])),d=Q();se();const g=globalThis.fetch,o=m(!1);B(()=>{o.value=!0});function f(t,n){a.payload.data[t]={__nuxt_island:{key:t,params:{...e.context,props:e.props?JSON.stringify(e.props):void 0}},...n}}const r=m("");{const t=((j=R(((N=d.vnode)==null?void 0:N.el)??null))==null?void 0:j.join(""))??"";t&&a.isHydrating&&f(`${e.name}_${u.value}`,{html:((L=R(((E=d.vnode)==null?void 0:E.el)??null,!0))==null?void 0:L.join(""))??"",state:{},head:{link:[],style:[]}}),r.value=t}const x=h(()=>D(r.value)),i=m(((C=r.value.match(F))==null?void 0:C[1])??S()),I=h(()=>[...r.value.matchAll(ie)].map(t=>t[1])),T=h(()=>{const t=Object.keys(l);return r.value.replace(ce,(n,v,_)=>t.includes(v)?"":_)});function $(){var t;i.value=((t=r.value.match(F))==null?void 0:t[1])??S()}const b=m({link:[],style:[]});M(b);async function P(t=!1){const n=`${e.name}_${u.value}`;if(a.payload.data[n]&&!t)return a.payload.data[n];const v=`/__nuxt_island/${n}.json`,O=await(await g(X(e.source?v:Y(c.app.baseURL??"",v),{...e.context,props:e.props?JSON.stringify(e.props):void 0}))).json();return f(n,O),O}const w=m(0);async function k(t=!1){a[p]=a[p]||{},a[p][i.value]||(a[p][i.value]=P(t).finally(()=>{delete a[p][i.value]}));try{const n=await a[p][i.value];b.value.link=n.head.link,b.value.style=n.head.style,r.value=n.html.replace(oe,()=>`nuxt-ssr-component-uid="${S()}"`),w.value++,s.value=null,await W(),$()}catch(n){s.value=n}}return V(e,re(()=>k(),100)),!a.isHydrating&&e.lazy?k():(!a.isHydrating||!a.payload.serverRendered)&&await k(),()=>{if((!T.value||s.value)&&l.fallback)return[l.fallback({error:s.value})];const t=[A(G,{key:w.value},[q(z(T.value||"<div></div>",1))])];if(i.value&&(o.value||a.isHydrating))for(const n in l)I.value.includes(n)&&t.push(A(J,{to:`[nuxt-ssr-component-uid='${i.value}'] [nuxt-ssr-slot-name='${n}']`},{default:()=>(x.value[n]??[void 0]).map(v=>{var _;return(_=l[n])==null?void 0:_.call(l,v)})}));return t}}}),pe=H({__name:"GistIsland",props:{gist:{type:String,required:!0}},setup(e){return(l,s)=>{const c=fe;return ee(),te(c,{name:"Gist",props:{gist:e.gist},lazy:""},{fallback:ae(()=>[ne("Fallback")]),_:1},8,["props"])}}});export{pe as default};
