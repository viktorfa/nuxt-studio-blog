[{"_path":"/posts/google-ai-product-search-vs-vertex-multimodal-embedding","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Google Product Search vs Vertex AI multimodal embeddings","description":"Google offers a managed service for searching with images to find similar products called Product Search. It's a quite neat service that allows you to do product search without manually embedding images, setting up a vector database, manipulating images etc. The pricing is quite predictable with 1 USD per 10000 images stored and 4.50 USD per 1000 queries using images.\nThe service has not been updated much by Google, and it has no graphical interface in the Cloud Console, which makes it a bit hard to use. This, together with the first generation of Google Cloud AI services, seem to be neglected in favor of the new Vertex AI.","date":"2023-11-13T00:00:00.000Z","language":"english","draft":false,"layout":"article","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Google offers a managed service for searching with images to find similar products called "},{"type":"element","tag":"a","props":{"href":"https://cloud.google.com/vision/product-search/docs","rel":["nofollow"]},"children":[{"type":"text","value":"Product Search"}]},{"type":"text","value":". It's a quite neat service that allows you to do product search without manually embedding images, setting up a vector database, manipulating images etc. The pricing is quite predictable with 1 USD per 10000 images stored and 4.50 USD per 1000 queries using images.\nThe service has not been updated much by Google, and it has no graphical interface in the Cloud Console, which makes it a bit hard to use. This, together with the first generation of Google Cloud AI services, seem to be neglected in favor of the new "},{"type":"element","tag":"a","props":{"href":"https://cloud.google.com/vertex-ai-vision","rel":["nofollow"]},"children":[{"type":"text","value":"Vertex AI"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this article I will compare the performance of managed Product Search with embedding images myself with Google Vertex's multimodal embedding. These two solutions will be referred to as "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Product Search"}]},{"type":"text","value":" and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Vertex"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"methodology"},"children":[{"type":"text","value":"Methodology"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I got target images from 380 products from one store categorized as \"Eggs and diary\" which form the search space. Then I found 13 test images of products from other stores or offer catalogs, all 13 judged by me to belong to the \"Eggs and diary\" category."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For Product Search the target images were indexed and set to the \"general\" category with no extra tags. Then the test images were queried to the product collection."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For Vertex multimodal the images were sent to the multimodal@001 embedding endpoint with only the image and no text. The test images were queried with scikit-learn NearestNeighbors (k=3) and cosine similarity."}]},{"type":"element","tag":"h2","props":{"id":"results"},"children":[{"type":"text","value":"Results"}]},{"type":"element","tag":"ProductSearch","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"discussion"},"children":[{"type":"text","value":"Discussion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Both solutions get most of the images right, and rank some images in a slightly different order when they have it right."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For \"Tine Lettmelk med smak\" and \"Biola skogsbær/vanilje\", only Product Search found a good match, while Vertex did not. These images were from offer catalogs, and had text in the foreground, which probably made the embeddings less likely to identify only the product image."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For \"Philadelphia\", there was no good match in the search space, so both solutions found other matches, these matches having lower scores than for images where there were good matches. Both ranked butter or margarine highest."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For \"Smøremyk\", which had no very visually similar matches, both found similar products, i.e. butter-imitation spreads."}]},{"type":"element","tag":"h2","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It seems that Product Search offers a better solution than using only multimodal embeddings and KNN queries. Perhaps Product Search does something in its pipeline to identify objects and extract the most relevant part of an image. For the Vertex solution to be equally good, we might have to preprocess images to identify products before embedding them."}]},{"type":"element","tag":"h2","props":{"id":"on-pricing-and-management"},"children":[{"type":"text","value":"On pricing and management"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Product search is a ready to use service, where experts at Google have made a good solution for the specific purpose of recognizing similar products from images. One only has to upload items for it to work. Using Vertex involves more steps and is, as demonstrated, not as good without optimizing the processing pipeline."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For indexing images one time, the price is the same for Vertex and Product Search: 1 USD per 10000 images. Product Search charges this monthly, while with Vertex one could store the embeddings much more cheaply.\nFor querying, Product Search charges 4.50 USD per 1000 queries, while for Vertex the cost of querying would vary depending on how one would do it. If the goal is to find similar products one time, then this could be done in a Python workbench for a negligible cost. To query continuously, the cost of managing a database capable of KNN search would depend on many factors. One could perhaps assume that the cost to run a vector database such as Google Vector Search is similar to the cost of using Product Search."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Product Search has the capability of storing metadata with products, so that it is possible to filter search results. Using Vertex, one could of course filter and sort as one wished with any database system."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vertex multimodal embedding also allows for embedding text strings in English in the same 1408-dimensional space as images, so searching your images with only text is not possible if using Product Search."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"methodology","depth":2,"text":"Methodology"},{"id":"results","depth":2,"text":"Results"},{"id":"discussion","depth":2,"text":"Discussion"},{"id":"conclusion","depth":2,"text":"Conclusion"},{"id":"on-pricing-and-management","depth":2,"text":"On pricing and management"}]}},"_type":"markdown","_id":"content:posts:google-ai-product-search-vs-vertex-multimodal-embedding:index.md","_source":"content","_file":"posts/google-ai-product-search-vs-vertex-multimodal-embedding/index.md","_extension":"md","sitemap":{"loc":"/posts/google-ai-product-search-vs-vertex-multimodal-embedding","images":[]}},{"_path":"/posts/how-to-use-your-own-email-in-google-workspace-without-paying-for-a-license","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"How to use your own email in Google Workspace without paying for a license","description":"When creating a Google Workspace to get Gmail for an organization on their own domain, you have to add a first user. This process can be a bit cumbersome if you are creating an email solution for a client, and you do not personally need to be involved in the organization. But you want to be able to configure the workspace in case the client needs some updates, such as adding a forwarding address, adding an organization member, or making an email alias.","date":"2023-03-21T02:15:11.000Z","language":"english","type":"post","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When creating a Google Workspace to get Gmail for an organization on their own domain, you have to add a first user. This process can be a bit cumbersome if you are creating an email solution for a client, and you do not personally need to be involved in the organization. But you want to be able to configure the workspace in case the client needs some updates, such as adding a forwarding address, adding an organization member, or making an email alias."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled","src":"/posts/How to use your own email in Google Workspace without paying for a license/Untitled.png","style":{"aspectRatio":"586/795"}},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"possible-solutions"},"children":[{"type":"text","value":"Possible solutions"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I will present 2 suboptimal solutions, and a third solution that involves a bit more tinkering, but is clearly superior in my opinion."}]},{"type":"element","tag":"h3","props":{"id":"use-the-clients-account-to-administer"},"children":[{"type":"text","value":"Use the client’s account to administer"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When setting up the workspace, you can create "},{"type":"element","tag":"a","props":{"href":"mailto:my.clients.name@company.com"},"children":[{"type":"text","value":"my.clients.name@company.com"}]},{"type":"text","value":" as the first account. This works fine when initially setting up the account, but if you want to do some changes later, you have to share the password with your client to use this account. Since your client will use this email in their work, it’s a bit weird if you should have access to their emails and documents. Especially if you’re just an outside “IT person” for the organization."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Additionally Google will sometimes require you do verify the account with a phone number. If you want to use your client’s phone number, you have to coordinate the approval SMS message flow, which can be cumbersome, time consuming and annoying for your client.\nAn alternative is just using your own phone number, but then you will link your phone number to the client’s account."}]},{"type":"element","tag":"h3","props":{"id":"use-your-own-account-or-an-administrator-account"},"children":[{"type":"text","value":"Use your own account or an administrator account"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is a bit cleaner. You can make "},{"type":"element","tag":"a","props":{"href":"mailto:your.name@company.com"},"children":[{"type":"text","value":"your.name@company.com"}]},{"type":"text","value":" or "},{"type":"element","tag":"a","props":{"href":"mailto:administrator@company.com"},"children":[{"type":"text","value":"administrator@company.com"}]},{"type":"text","value":" as the first account, and use that later when you have to do changes. It’s still a bit inelegant if you are not really a part of the organization, and just the outside person setting up emails."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You or your client also has to pay the subscription for this account, which is wasted money if you are not using Gmail or Google Docs inside the organization, which is the normal case when doing IT work for clients."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The last solution allows you to use your own login without paying for a subscription."}]},{"type":"element","tag":"h3","props":{"id":"use-google-cloud-identity-in-your-google-workspace"},"children":[{"type":"text","value":"Use Google Cloud Identity in your Google Workspace"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Google’s cloud platform offers something called Google Cloud Identity. It’s a complicated tool that can be used for everything from our simple case to managing complex access patterns in large organizations."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled","src":"Untitled_1.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use this with Google Workspace, you need to activate it on "},{"type":"element","tag":"a","props":{"href":"https://console.cloud.google.com/cloud-setup/organization","rel":["nofollow"]},"children":[{"type":"text","value":"https://console.cloud.google.com/cloud-setup/organization"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Select "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"I’m a current Workspace customer"}]},{"type":"text","value":", and enable Cloud Identity. Note that you have to verify your domain first, which is something you have to do to use Gmail with Google Workspace."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled","src":"Untitled_2.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You activate Cloud Identity Free in your Google Workspace "},{"type":"element","tag":"a","props":{"href":"https://admin.google.com/u/3/ac/billing/catalog","rel":["nofollow"]},"children":[{"type":"text","value":"https://admin.google.com/u/0/ac/billing/catalog"}]},{"type":"text","value":". Click "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Get Started"}]},{"type":"text","value":" and go through the short process."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled","src":"Untitled_3.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You should now come to the licenses page of your Google Workspace, which was not available before you activated Cloud Identity. Here you can decide who of the organization members should have a license for Google Workspace. A license means access to Gmail, Google Docs, and everything useful in Workspace."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To remove yourself as a licensee, and thus not having to pay for your own account, you need to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"turn off automatic licensing"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled","src":"Untitled_4.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After doing that, you can go to your own user, scroll down to Licenses, and turn it off for Workspace (not for Cloud Identity!)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled","src":"Untitled_5.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You now save some money, and do not use any of the quota of 10 users allowed for a standard workspace."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Remember that new users you add now, will not have a license automatically, so you have to assign it to them manually if they are to be able to use Gmail etc."}]},{"type":"element","tag":"h2","props":{"id":"additional-steps"},"children":[{"type":"text","value":"Additional steps"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some additional steps can be taken if you want."}]},{"type":"element","tag":"h3","props":{"id":"forward-emails-to-your-own-account"},"children":[{"type":"text","value":"Forward emails to your own account"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you still want to be able to see emails sent to your account in your client’s organization, you can solve this by setting up a forwarding rule in Google Workspace’s Gmail settings. This can be useful if you use e.g. "},{"type":"element","tag":"a","props":{"href":"mailto:administrator@company.com"},"children":[{"type":"text","value":"administrator@company.com"}]},{"type":"text","value":" or "},{"type":"element","tag":"a","props":{"href":"mailto:your.name@company.com"},"children":[{"type":"text","value":"your.name@company.com"}]},{"type":"text","value":" to sign up for software tools or something else online."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To do this, go to Apps > Google Workspace > Gmail, scroll down to "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Routing"}]},{"type":"text","value":" and click. Configure "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Email forwarding using recipient address map"}]},{"type":"text","value":" where you enter your email in the organization, and your preferred destination email."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled","src":"Untitled_6.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After adding the rule, wait a few minutes before you send a test email, as this takes some time to update in Google’s systems. Also remember that you have to set up Gmail for this workspace by adding MX records etc. in your DNS settings for email forwarding to work."}]},{"type":"element","tag":"h3","props":{"id":"log-in-to-the-organization-with-another-email"},"children":[{"type":"text","value":"Log in to the organization with another email"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Maybe you have a bazillion Google accounts, and want to just use a few of them in your daily work. I tried adding my personal email to the client’s organization in Cloud Identity, but that does not seem to be possible. Only emails ending with the organization’s domain name can be added as far as I know as of March 2023."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"possible-solutions","depth":2,"text":"Possible solutions","children":[{"id":"use-the-clients-account-to-administer","depth":3,"text":"Use the client’s account to administer"},{"id":"use-your-own-account-or-an-administrator-account","depth":3,"text":"Use your own account or an administrator account"},{"id":"use-google-cloud-identity-in-your-google-workspace","depth":3,"text":"Use Google Cloud Identity in your Google Workspace"}]},{"id":"additional-steps","depth":2,"text":"Additional steps","children":[{"id":"forward-emails-to-your-own-account","depth":3,"text":"Forward emails to your own account"},{"id":"log-in-to-the-organization-with-another-email","depth":3,"text":"Log in to the organization with another email"}]}]}},"_type":"markdown","_id":"content:posts:How to use your own email in Google Workspace without paying for a license:index.md","_source":"content","_file":"posts/How to use your own email in Google Workspace without paying for a license/index.md","_extension":"md","sitemap":{"loc":"/posts/how-to-use-your-own-email-in-google-workspace-without-paying-for-a-license","images":[]}},{"_path":"/posts/serverless-strapi-4-guide","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"AWS Lambda Serverless Strapi 4 Guide","description":"The code for this guide is in this Github repo.","date":"2022-06-14T01:25:06.000Z","language":"english","draft":false,"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The code for this guide is in "},{"type":"element","tag":"a","props":{"href":"https://github.com/viktorfa/strapi-4-serverless-guide","rel":["nofollow"]},"children":[{"type":"text","value":"this Github repo"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I earlier wrote "},{"type":"element","tag":"a","props":{"href":"/posts/serverless-strapi-tutorial/"},"children":[{"type":"text","value":"a guide"}]},{"type":"text","value":" on how to use Strapi 3 on AWS Lambda. Now that a new non-backward-compatible Strapi version is released, it’s time to make a new guide for Strapi 4."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hosting Strapi on Lambda comes with some restrictions, as some features and plugins will not work."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"However, using Lambda to host Strapi is a great way to create a scalable deployment where you pay as you go, can enjoy Amazon’s generous free tier, and don’t need to worry about server updates."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As I said in the previous article, “serverless” does not mean there are no servers. It means that the developer or organization can minimize the concern about managing servers. Ideally, serverless applications should be scalable and priced in a pay-for-what-you-use basis."}]},{"type":"element","tag":"h2","props":{"id":"strapi-4-databases"},"children":[{"type":"text","value":"Strapi 4 databases"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Unfortunately, Strapi 4 does not support using MongoDB. I this this is kinda bad, because it’s so easy to get free managed MongoDB hosting with Mongo Atlas. We will use PostgreSQL from AWS RDS in this guide, as they offer a free tier for 12 months."}]},{"type":"element","tag":"h2","props":{"id":"what-tools-we-will-use"},"children":[{"type":"text","value":"What tools we will use"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This guide will use"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Unix command line"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Serverless Framework"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Strapi 4"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Node and Yarn (NPM will also work)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"An AWS account"}]}]},{"type":"element","tag":"h2","props":{"id":"set-up-strapi"},"children":[{"type":"text","value":"Set up Strapi"}]},{"type":"element","tag":"pre","props":{"code":"yarn create strapi-app serverless-strapi-4-guide --quickstart\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" strapi-app"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless-strapi-4-guide"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --quickstart\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"create strapi app.png","src":"/posts/serverless-strapi-4-guide/create_strapi_app.png","style":{"aspectRatio":"945/946"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This will create a new folder and automatically install the dependencies, start Strapi and open a browser window. If it does not open, just visit "},{"type":"element","tag":"a","props":{"href":"http://localhost:1337/admin","rel":["nofollow"]},"children":[{"type":"text","value":"http://localhost:1337/admin"}]},{"type":"text","value":" to see the admin dashboard. You can register a user to see that it works, but we will change databases and not use this user later."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Change to the newly created folder."}]},{"type":"element","tag":"h2","props":{"id":"set-up-the-serverless-framework"},"children":[{"type":"text","value":"Set up the Serverless framework"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the dependencies and create a basic configuration in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]}]},{"type":"element","tag":"pre","props":{"code":"npm install -g serverless\nyarn add -D serverless-offline\nyarn add serverless-http pg\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -g"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -D"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless-offline\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless-http"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" pg\n"}]}]}]}]},{"type":"element","tag":"pre","props":{"code":"# serverless.yml\n\nservice: strapi-4-serverless-guide\n\nframeworkVersion: \"3\"\n\nprovider:\n  name: aws\n  runtime: nodejs16.x\n  region: eu-central-1 # NOTE: Update to your region\n  logRetentionInDays: 1\n  versionFunctions: false\n\n  memorySize: 2048\n  timeout: 30\n\npackage:\n  excludeDevDependencies: true\n  exclude: \"**/**\"\n  include: \"src/**\"\n\nfunctions:\n  hello:\n    handler: src/app.hello\n    events:\n      - http:\n          path: /\n          method: ANY\n          cors: true\n      - http:\n          path: /{any+}\n          method: ANY\n          cors: true\n\nplugins:\n  - serverless-offline\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"service"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"strapi-4-serverless-guide\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"frameworkVersion"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"3\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"provider"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"aws\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  runtime"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"nodejs16.x\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  region"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"eu-central-1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":" # NOTE: Update to your region\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  logRetentionInDays"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  versionFunctions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  memorySize"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"2048\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  timeout"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"30\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"package"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  excludeDevDependencies"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  exclude"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"**/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  include"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"src/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"functions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  hello"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"src/app.hello\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    events"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"http"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          path"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          method"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"ANY\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          cors"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"http"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          path"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"/{any+}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          method"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"ANY\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          cors"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"plugins"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"serverless-offline\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will first make a simple function just to see that we can run Serverless locally and deploy it without problems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create a file with a handler in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"src/app.js"}]}]},{"type":"element","tag":"pre","props":{"code":"// src/app.js\n\nmodule.exports.hello = async (event, context) => {\n  return {\n    body: JSON.stringify({ message: \"Hello from Serverless\" }),\n    headers: { \"Content-Type\": \"application/json\" },\n  };\n};\n","language":"javascript","meta":"","className":"language-javascript shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// src/app.js\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"hello"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    body: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"JSON"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"stringify"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"({ message: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Hello from Serverless\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" }),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    headers: { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Content-Type\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"application/json\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  };\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"};\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check that Serverless offline works with"}]},{"type":"element","tag":"pre","props":{"code":"yarn serverless offline\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" offline\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Go to "},{"type":"element","tag":"a","props":{"href":"http://localhost:3000/dev","rel":["nofollow"]},"children":[{"type":"text","value":"http://localhost:3000/dev"}]},{"type":"text","value":" in your browser where you should get the response from "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"src/app.js"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, deploy the function to the AWS cloud."}]},{"type":"element","tag":"pre","props":{"code":"yarn serverless deploy\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you have not used the Serverless framework before, you have to do some configuration. Create a role for serverless and make a user with the client id and client secret in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"~/.aws/credentials"}]},{"type":"text","value":". See "},{"type":"element","tag":"a","props":{"href":"https://www.serverless.com/framework/docs/providers/aws/guide/credentials/","rel":["nofollow"]},"children":[{"type":"text","value":"the guide"}]},{"type":"text","value":" from Serverless on how to do this on. If you don't have an AWS account yet, you can register one in the "},{"type":"element","tag":"a","props":{"href":"https://aws.amazon.com/console/","rel":["nofollow"]},"children":[{"type":"text","value":"AWS console"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"aws credentials file.png","src":"/posts/serverless-strapi-4-guide/aws_credentials_file.png","style":{"aspectRatio":"382/88"}},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"This is the profile this guide will use from ~/.aws/credentials"}]}]},{"type":"element","tag":"pre","props":{"code":"yarn serverless deploy --aws-profile strapi-serverless-admin\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --aws-profile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" strapi-serverless-admin\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"./serverless hello deployed.png","src":"/posts/serverless-strapi-4-guide/serverless_hello_deployed.png","style":{"aspectRatio":"952/324"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It should now be deployed and available on the url showed in the terminal. Visit the url to be sure that it works."}]},{"type":"element","tag":"h2","props":{"id":"creating-a-postgresql-database"},"children":[{"type":"text","value":"Creating a PostgreSQL database"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you already have a database you want to use with Strapi, you can skip this step and just configure "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/database.js"}]},{"type":"text","value":" to connect to it. See the Strapi docs for more information."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This guide will set up a free tier PostgreSQL database in AWS. This is a good choice as it's free for 12 months and has good enough performance for using Strapi as a CMS. Having the database in the AWS system is also practical, as we don't need to subscribe to more services.\nYou can choose to use serverless AWS Aurora with PostgreSQL compatibility, but this offering does not have a free tier and will cost about 0.70$ per day for the cheapest option."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will create the database in the AWS web console using so called \"click ops\". We could use CloudFormation and so called \"infastructure as code\". But it's quite cumbersome to define an Aurora database cluster in CloudFormation because of the sheer size and readability of the yaml file, the creation of a master password which is of risk of being leaked, and the risk of accidental deletion of the database when automatically updating the CloudFormation stack."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Go to the AWS web console and remember to switch to the region you want to deploy to. This guide will use eu-central-1. Search for RDS in the search bar and select RDS. Click the button to create a new database."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"select rds.png","src":"/posts/serverless-strapi-4-guide/select_rds.png","style":{"aspectRatio":"974/518"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Select PostgreSQL as the database. It's probably a good idea to select the latest PostgreSQL version. Choose a cluster name, username and password. It's not a good idea to use the default username, as this makes the database more vulnerable to bots who automatically guess credentials. "},{"type":"element","tag":"a","props":{"href":"https://passwordsgenerator.net/","rel":["nofollow"]},"children":[{"type":"text","value":"Generate a password"}]},{"type":"text","value":" 32 characters long with only letters and numbers as some special characters are not supported. Copy and paste the password somewhere as you will not see the password again."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"create postgres 1.png","src":"/posts/serverless-strapi-4-guide/create_postgres_1.png","style":{"aspectRatio":"812/895"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Choose the default db.t3.micro instance. You can of course modify the configuration to fit your needs, but this guide will choose the cheapest options. Select to create a new VPC."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"create postgres 2.png","src":"/posts/serverless-strapi-4-guide/create_postgres_2.png","style":{"aspectRatio":"784/878"}},"children":[]},{"type":"element","tag":"img","props":{"alt":"create postgres 3.png","src":"/posts/serverless-strapi-4-guide/create_postgres_3.png","style":{"aspectRatio":"776/893"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check the \"Allow public access\" option and select create to create a new VPC security group."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"create postgres 4.png","src":"/posts/serverless-strapi-4-guide/create_postgres_4.png","style":{"aspectRatio":"761/894"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Monitoring can be useful if you plan to use this database in production, but it will add some cost if you go above the free tier of CloudWatch logs. Choose an initial database name such as \"strapi4\". The rest of the options can just the the default ones."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"create postgres 5.png","src":"/posts/serverless-strapi-4-guide/create_postgres_5.png","style":{"aspectRatio":"775/886"}},"children":[]},{"type":"element","tag":"img","props":{"alt":"create postgres 6.png","src":"/posts/serverless-strapi-4-guide/create_postgres_6.png","style":{"aspectRatio":"770/897"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Scroll down and click the button to create the database. You will need to wait about 5 minutes for the instance to be ready. When it's ready you can see the endpoint which we will use to connect to the database from Strapi."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"creating postgres.png","src":"/posts/serverless-strapi-4-guide/creating_postgres.png","style":{"aspectRatio":"1576/387"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The last thing is to enable access from all IP addresses. Since we generated a long password, this is not a considerable security risk for most cases."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"postgres overview.png","src":"/posts/serverless-strapi-4-guide/postgres_overview.png","style":{"aspectRatio":"1390/811"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Under \"Security\" in the instance overview, select the VPC security group. Go to \"Inbound rules\" and click \"Edit inbound rules\". Select \"Anywhere-IPv4\" under \"Source\" and save."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"select inbound rules.png","src":"/posts/serverless-strapi-4-guide/select_inbound_rules.png","style":{"aspectRatio":"1550/383"}},"children":[]},{"type":"element","tag":"img","props":{"alt":"security group anywhere.png","src":"/posts/serverless-strapi-4-guide/security_group_anywhere.png","style":{"aspectRatio":"1796/440"}},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"connecting-to-the-new-database-with-strapi"},"children":[{"type":"text","value":"Connecting to the new database with Strapi"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now that we have a database, we can configure Strapi to connect to it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Populate the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":".env"}]},{"type":"text","value":" file with the credentials, database name and the host name."}]},{"type":"element","tag":"pre","props":{"code":"# ...\n# Change to the values from the database configuration\n\nSERVER_URL=\"https://localhost:3000/dev\"\nDATABASE_PASSWORD=ENTER_YOUR_DATABASE_PASSWORD\nDATABASE_USERNAME=strapi_4_owner\nDATABASE_NAME=strapi4\nDATABASE_HOST=\"strapi-serverless-postgres.YOUR_HASH.eu-central-1.rds.amazonaws.com\"\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# ...\n# Change to the values from the database configuration\n\nSERVER_URL=\"https://localhost:3000/dev\"\nDATABASE_PASSWORD=ENTER_YOUR_DATABASE_PASSWORD\nDATABASE_USERNAME=strapi_4_owner\nDATABASE_NAME=strapi4\nDATABASE_HOST=\"strapi-serverless-postgres.YOUR_HASH.eu-central-1.rds.amazonaws.com\"\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then edit "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/database.js"}]},{"type":"text","value":" to the following"}]},{"type":"element","tag":"pre","props":{"code":"// config/database.js\n\nmodule.exports = ({ env }) => ({\n  connection: {\n    client: \"postgres\",\n    connection: {\n      host: env(\"DATABASE_HOST\", \"\"),\n      port: env.int(\"DATABASE_PORT\", 5432),\n      database: env(\"DATABASE_NAME\", \"\"),\n      user: env(\"DATABASE_USERNAME\", \"\"),\n      password: env(\"DATABASE_PASSWORD\", \"\"),\n      schema: \"public\",\n      ssl: {\n        rejectUnauthorized: env.bool(\"DATABASE_SSL_SELF\", false), // For self-signed certificates\n      },\n    },\n    debug: false,\n    // The connection pool can be adjusted, but these minimal limits seem to work well.\n    pool: {\n      min: 0,\n      max: 1,\n      idleTimeoutMillis: 500,\n    },\n  },\n});\n","language":"javascript","meta":"","className":"language-javascript shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// config/database.js\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ({ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" }) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  connection: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    client: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"postgres\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    connection: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      host: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"DATABASE_HOST\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      port: env."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"DATABASE_PORT\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"5432"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      database: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"DATABASE_NAME\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      user: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"DATABASE_USERNAME\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      password: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"DATABASE_PASSWORD\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      schema: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"public\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      ssl: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        rejectUnauthorized: env."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"bool"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"DATABASE_SSL_SELF\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"), "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// For self-signed certificates\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    debug: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    // The connection pool can be adjusted, but these minimal limits seem to work well.\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    pool: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      min: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      max: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      idleTimeoutMillis: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"500"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"});\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Run Strapi in development again to see that it works. You can now register a new user and create a content type if you want."}]},{"type":"element","tag":"pre","props":{"code":"yarn develop\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" develop\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If everything works, we are ready to deploy to Lambda.  If "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"yarn develop"}]},{"type":"text","value":" does not work properly, you might have to delete the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"build"}]},{"type":"text","value":" folder which is created whenever you run "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"yarn build"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"strapi-with-serverless"},"children":[{"type":"text","value":"Strapi with Serverless"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We have to configure Strapi in a certain way to make it work."}]},{"type":"element","tag":"pre","props":{"code":"// config/server.js\n\nconst getUrl = ({ env }) => {\n  if (process.argv.join(\" \").includes(\"strapi develop\")) {\n    return \"\";\n  } else if (env.bool(\"IS_OFFLINE\") || env.bool(\"BUILD_FOR_OFFLINE\")) {\n    return \"http://localhost:3000/dev\";\n  } else {\n    return env(\"SERVER_URL\", \"dev\");\n  }\n};\n\nmodule.exports = ({ env }) => ({\n  host: env(\"HOST\", \"0.0.0.0\"),\n  port: env.int(\"PORT\", 1337),\n  app: {\n    keys: env.array(\"APP_KEYS\"),\n  },\n  url: getUrl({ env }),\n});\n","language":"javascript","meta":"","className":"language-javascript shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// config/server.js\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" getUrl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ({ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" }) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" (process.argv."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\" \""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"includes"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"strapi develop\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" (env."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"bool"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"IS_OFFLINE\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"||"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" env."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"bool"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"BUILD_FOR_OFFLINE\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"http://localhost:3000/dev\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"SERVER_URL\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"dev\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ({ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" }) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  host: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"HOST\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"0.0.0.0\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  port: env."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"PORT\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1337"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  app: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    keys: env."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"array"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"APP_KEYS\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  url: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"getUrl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"({ env }),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"});\n"}]}]}]}]},{"type":"element","tag":"pre","props":{"code":"// config/admin.js\n\nconst getUrl = () => {\n  if (process.argv.join(\" \").includes(\"strapi develop\")) {\n    return \"admin\";\n  } else {\n    return \"dev/admin\";\n  }\n};\n\nmodule.exports = ({ env }) => ({\n  auth: {\n    secret: env(\"ADMIN_JWT_SECRET\"),\n  },\n  apiToken: {\n    salt: env(\"API_TOKEN_SALT\"),\n  },\n  url: getUrl(),\n  autoOpen: false,\n});\n","language":"javascript","meta":"","className":"language-javascript shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// config/admin.js\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" getUrl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" (process.argv."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\" \""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"includes"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"strapi develop\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"admin\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"dev/admin\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ({ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" }) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  auth: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    secret: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"ADMIN_JWT_SECRET\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  apiToken: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    salt: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"API_TOKEN_SALT\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  url: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"getUrl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"(),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  autoOpen: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"});\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Before we run it in with Serverless, we need to update "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"src/app.js"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":"."}]},{"type":"element","tag":"pre","props":{"code":"// src/app.js\n\nconst serverless = require(\"serverless-http\");\nconst Strapi = require(\"@strapi/strapi/lib/index.js\");\n\nmodule.exports.hello = async (event, context) => {\n  return {\n    body: JSON.stringify({ message: \"Hello from Serverless\" }),\n    headers: { \"Content-Type\": \"application/json\" },\n  };\n};\n\nconst startStrapi = async (strapi) => {\n  try {\n    if (!strapi.isLoaded) {\n      await strapi.load();\n    }\n    await strapi.postListen();\n    strapi.server.mount();\n    return strapi;\n  } catch (error) {\n    return strapi.stopWithError(error);\n  }\n};\n\nmodule.exports.strapiHandler = async (event, context) => {\n  let workingDir = process.cwd();\n  if (process.env.LAMBDA_TASK_ROOT && process.env.IS_OFFLINE !== \"true\") {\n    workingDir = process.env.LAMBDA_TASK_ROOT;\n  }\n  if (!global.strapi) {\n    console.info(\"Cold starting Strapi\");\n    Strapi({ dir: workingDir });\n  }\n  if (!global.strapi.isLoaded) {\n    await startStrapi(global.strapi);\n  }\n  const handler = serverless(global.strapi.server.app);\n  return handler(event, context);\n};\n","language":"javascript","meta":"","className":"language-javascript shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// src/app.js\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" require"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"serverless-http\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" Strapi"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" require"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"@strapi/strapi/lib/index.js\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"hello"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    body: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"JSON"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"stringify"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"({ message: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Hello from Serverless\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" }),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    headers: { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Content-Type\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"application/json\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  };\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" startStrapi"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"strapi"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  try"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"strapi.isLoaded) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"      await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" strapi."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"load"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" strapi."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"postListen"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    strapi.server."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"mount"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" strapi;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" (error) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" strapi."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"stopWithError"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"(error);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"strapiHandler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" workingDir "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" process."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"cwd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" (process.env."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"LAMBDA_TASK_ROOT"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" &&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" process.env."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"IS_OFFLINE"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" !=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"true\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    workingDir "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" process.env."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"LAMBDA_TASK_ROOT"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"global.strapi) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    console."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"info"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Cold starting Strapi\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"    Strapi"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"({ dir: workingDir });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"global.strapi.isLoaded) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" startStrapi"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"(global.strapi);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"(global.strapi.server.app);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"(event, context);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"};\n"}]}]}]}]},{"type":"element","tag":"pre","props":{"code":"# serverless.yml\n\nservice: strapi-4-serverless-guide\n\nframeworkVersion: \"3\"\nuseDotenv: true\n\nprovider:\n  name: aws\n  runtime: nodejs16.x\n  region: eu-central-1 # NOTE: Update to your region\n  profile: strapi-serverless-admin # NOTE: Update to your profile name as in ~/.aws/credentials\n  logRetentionInDays: 1\n  versionFunctions: false\n\n  memorySize: 2048\n  timeout: 30\n\n  environment:\n    APP_KEYS: ${env:APP_KEYS}\n    API_TOKEN_SALT: ${env:API_TOKEN_SALT}\n    ADMIN_JWT_SECRET: ${env:ADMIN_JWT_SECRET}\n    JWT_SECRET: ${env:JWT_SECRET}\n\n    SERVER_URL: ${env:SERVER_URL}\n    DATABASE_PASSWORD: ${env:DATABASE_PASSWORD}\n    DATABASE_USERNAME: ${env:DATABASE_USERNAME}\n    DATABASE_NAME: ${env:DATABASE_NAME}\n    DATABASE_HOST: ${env:DATABASE_HOST}\n\npackage:\n  excludeDevDependencies: true\n  exclude:\n    - \"**\"\n  include:\n    - \"build/**\"\n    - \"config/**\"\n    - \"database/**\"\n    - \"node_modules/**\"\n    - \"public/**\"\n    - \"src/**\"\n    - \".env.example\"\n    - \"package.json\"\n    - \"!node_modules/esbuild-linux-64/**\"\n    - \"!node_modules/@babel/**\"\n    - \"!node_modules/@types/**\"\n    - \"!node_modules/webpack/**\"\n    - \"!node_modules/@sentry/**\"\n\nfunctions:\n  api:\n    handler: src/app.strapiHandler\n    events:\n      - http:\n          path: /\n          method: ANY\n          cors: true\n      - http:\n          path: /{any+}\n          method: ANY\n          cors: true\n\nplugins:\n  - serverless-offline\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"service"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"strapi-4-serverless-guide\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"frameworkVersion"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"3\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"useDotenv"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"provider"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"aws\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  runtime"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"nodejs16.x\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  region"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"eu-central-1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":" # NOTE: Update to your region\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  profile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"strapi-serverless-admin"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":" # NOTE: Update to your profile name as in ~/.aws/credentials\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  logRetentionInDays"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  versionFunctions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  memorySize"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"2048\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  timeout"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"30\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  environment"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    APP_KEYS"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${env:APP_KEYS}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    API_TOKEN_SALT"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${env:API_TOKEN_SALT}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    ADMIN_JWT_SECRET"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${env:ADMIN_JWT_SECRET}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    JWT_SECRET"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${env:JWT_SECRET}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    SERVER_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${env:SERVER_URL}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    DATABASE_PASSWORD"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${env:DATABASE_PASSWORD}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    DATABASE_USERNAME"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${env:DATABASE_USERNAME}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    DATABASE_NAME"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${env:DATABASE_NAME}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    DATABASE_HOST"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${env:DATABASE_HOST}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"package"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  excludeDevDependencies"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  exclude"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  include"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"build/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"config/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"database/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"node_modules/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"public/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"src/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\".env.example\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"package.json\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"!node_modules/esbuild-linux-64/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":45},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"!node_modules/@babel/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":46},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"!node_modules/@types/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":47},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"!node_modules/webpack/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":48},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"!node_modules/@sentry/**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":49},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":50},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"functions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":51},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  api"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":52},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"src/app.strapiHandler\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":53},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    events"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":54},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"http"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":55},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          path"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":56},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          method"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"ANY\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":57},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          cors"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":58},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"http"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":59},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          path"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"/{any+}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":60},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          method"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"ANY\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":61},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          cors"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":62},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":63},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"plugins"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":64},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"serverless-offline\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we can check that it works with Serverless offline. First, we need to build the frontend with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"BUILD_FOR_OFFLINE=true yarn build"}]}]},{"type":"element","tag":"pre","props":{"code":"BUILD_FOR_OFFLINE=true yarn build\nserverless offline\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"BUILD_FOR_OFFLINE"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" offline\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"yarn strapi build.png","src":"/posts/serverless-strapi-4-guide/yarn_strapi_build.png","style":{"aspectRatio":"523/189"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Go to "},{"type":"element","tag":"a","props":{"href":"http://localhost:3000/dev/index.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://localhost:3000/dev/index.html"}]},{"type":"text","value":" then log in see see that it works. Strapi is now connected to the database in the cloud and running on Lambda locally."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We can now deploy to the cloud"}]},{"type":"element","tag":"pre","props":{"code":"serverless deploy\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"serverless deploy\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It should upload successfully. Note that the UI will not work, as we use "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"http://localhost:3000/dev"}]},{"type":"text","value":" as the SERVER_URL. After running "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless deploy"}]},{"type":"text","value":" you should see a url in the format of "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"https://YOUR_HASH.execute-api.eu-central-1.amazonaws.com/dev"}]},{"type":"text","value":" in the console. Copy this and paste it in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":".env"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"serverless deployed.png","src":"/posts/serverless-strapi-4-guide/serverless_deployed.png","style":{"aspectRatio":"727/281"}},"children":[]}]},{"type":"element","tag":"pre","props":{"code":"# .env\n# ...\nSERVER_URL=\"https://YOUR_HASH.execute-api.eu-central-1.amazonaws.com/dev\"\n# ...\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# .env\n# ...\nSERVER_URL=\"https://YOUR_HASH.execute-api.eu-central-1.amazonaws.com/dev\"\n# ...\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can see the logs from lambda with"}]},{"type":"element","tag":"pre","props":{"code":"serverless logs -f api -t\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" logs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" api"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -t\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"While the GUI will not work, you can check that the API works by going to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"https://YOUR_HASH.execute-api.eu-central-1.amazonaws.com/dev/api/users"}]},{"type":"text","value":". You should get a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"403 Forbidden response"}]},{"type":"text","value":". If you get a 5xx response, something is wrong, and you can check the logs to debug it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After you have inserted the correct "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"SERVER_URL"}]},{"type":"text","value":" environment variable to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":".env"}]},{"type":"text","value":", we can build and deploy again."}]},{"type":"element","tag":"pre","props":{"code":"yarn build\nserverless deploy\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Visit "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"https://YOUR_HASH.execute-api.eu-central-1.amazonaws.com/dev"}]},{"type":"text","value":" and login to the GUI. The username and password you chose locally should work here too, as we use the same database."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If it works, congratulations! You have successfully deployed Strapi with Lambda."}]},{"type":"element","tag":"h2","props":{"id":"whats-next"},"children":[{"type":"text","value":"What's next"}]},{"type":"element","tag":"h3","props":{"id":"deploying-the-frontend-separately"},"children":[{"type":"text","value":"Deploying the frontend separately"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's possible to split up the Strapi app and deploy the frontend on a separate static site. This will Make the initial loading of the site a little bit faster, and also save you a few requests to API Gateway and Lambda. To do this, you need to edit "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/admin.js"}]},{"type":"text","value":" and change the url to the domain you're hosting on. Then run "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"yarn build"}]},{"type":"text","value":" and deploy the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"build"}]},{"type":"text","value":" folder to whatever static site hosting you prefer."}]},{"type":"element","tag":"h3","props":{"id":"use-lambda-url"},"children":[{"type":"text","value":"Use Lambda URL"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's possible to invoke a "},{"type":"element","tag":"a","props":{"href":"https://docs.aws.amazon.com/lambda/latest/dg/lambda-urls.html","rel":["nofollow"]},"children":[{"type":"text","value":"Lambda directly"}]},{"type":"text","value":" with HTTP without using API Gateway. This will save some cost if you go above the free tier of Lambda and API Gateway. The backside is that the Serverless Offline plugin will not work, so you can't test your app locally easily. You can use Lambda URL by adding the following to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" and removing "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"dev"}]},{"type":"text","value":" from the url in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/server.js"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/admin.js"}]}]},{"type":"element","tag":"pre","props":{"code":"# serverless.yml\n#...\nfunctions:\n  api-url:\n    handler: src/app.strapiHandler\n    url:\n      cors: true\n#...\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"#...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"functions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  api-url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"src/app.strapiHandler\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      cors"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"#...\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"further-reduce-the-package-size"},"children":[{"type":"text","value":"Further reduce the package size"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you use additional Strapi plugins or dependencies, your package size might get higher than the maximum limit for Lambda. More dependencies can safely be removed from "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"node_modules"}]},{"type":"text","value":" by adding them under "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"include"}]},{"type":"text","value":" in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":". All the frontend dependencies can be safely removed if you host the frontend separately."}]},{"type":"element","tag":"h3","props":{"id":"deploy-several-strapi-instances"},"children":[{"type":"text","value":"Deploy several Strapi instances"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you need to deploy several Strapi instances, you can configure this project differently or just make several copies of the project. Each instance needs its own database, but you can use the same AWS PostgreSQL database cluster for several databases without any extra cost. Just create a new database with an SQL query in PostgreSQL."}]},{"type":"element","tag":"h3","props":{"id":"upload-images-and-static-assets"},"children":[{"type":"text","value":"Upload images and static assets"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can use S3 to host your images and static assets in Strapi. The "},{"type":"element","tag":"a","props":{"href":"/posts/serverless-strapi-tutorial/"},"children":[{"type":"text","value":"previous guide"}]},{"type":"text","value":" explains how to do this in Strapi 3. It should be fairly similar to do it in Strapi 4."}]},{"type":"element","tag":"h2","props":{"id":"feedback"},"children":[{"type":"text","value":"Feedback"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mention me on Twitter on @vikfand or send a mail to "},{"type":"element","tag":"a","props":{"href":"mailto:vikfand@gmail.com"},"children":[{"type":"text","value":"vikfand@gmail.com"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check the "},{"type":"element","tag":"a","props":{"href":"https://github.com/viktorfa/strapi-4-serverless-guide","rel":["nofollow"]},"children":[{"type":"text","value":"Github repo"}]},{"type":"text","value":" for the full code used."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"strapi-4-databases","depth":2,"text":"Strapi 4 databases"},{"id":"what-tools-we-will-use","depth":2,"text":"What tools we will use"},{"id":"set-up-strapi","depth":2,"text":"Set up Strapi"},{"id":"set-up-the-serverless-framework","depth":2,"text":"Set up the Serverless framework"},{"id":"creating-a-postgresql-database","depth":2,"text":"Creating a PostgreSQL database"},{"id":"connecting-to-the-new-database-with-strapi","depth":2,"text":"Connecting to the new database with Strapi"},{"id":"strapi-with-serverless","depth":2,"text":"Strapi with Serverless"},{"id":"whats-next","depth":2,"text":"What's next","children":[{"id":"deploying-the-frontend-separately","depth":3,"text":"Deploying the frontend separately"},{"id":"use-lambda-url","depth":3,"text":"Use Lambda URL"},{"id":"further-reduce-the-package-size","depth":3,"text":"Further reduce the package size"},{"id":"deploy-several-strapi-instances","depth":3,"text":"Deploy several Strapi instances"},{"id":"upload-images-and-static-assets","depth":3,"text":"Upload images and static assets"}]},{"id":"feedback","depth":2,"text":"Feedback"}]}},"_type":"markdown","_id":"content:posts:serverless-strapi-4-guide:index.md","_source":"content","_file":"posts/serverless-strapi-4-guide/index.md","_extension":"md","sitemap":{"loc":"/posts/serverless-strapi-4-guide","images":[]}},{"_path":"/posts/how-to-fix-php-error-in-wordpress-plugin","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"How to fix \"syntax error, unexpected '|'\" error in Symfony Polyfill in Wordpress plugins","description":"I experienced a quite troublesome problem when trying to upload a plugin to the Wordpress repository with SVN. The issue was some files of the Symfony Polyfill libraries. They contain code that is only compatible with PHP 8. The code is not supposed to run on older versions of PHP, but the Wordpress SVN validator will check all uploaded files whether they run or not. Since the Wordpress server doesn't have PHP 8 yet, it will raise an error.","date":"2022-03-04 08:00:00 +0000","categories":["wordpress","development","php","svn"],"layout":"post","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I experienced a quite troublesome problem when trying to upload a plugin to the Wordpress repository with SVN. The issue was some files of the Symfony Polyfill libraries. They contain code that is only compatible with PHP 8. The code is not supposed to run on older versions of PHP, but the Wordpress SVN validator will check all uploaded files whether they run or not. Since the Wordpress server doesn't have PHP 8 yet, it will raise an error."}]},{"type":"element","tag":"pre","props":{"code":"Committing transaction...\nsvn: E165001: Commit blocked by pre-commit hook (exit code 1) with output:\n\n***********************************\nPHP error in: simple-social-media-preview/tags/1.0.0/vendor/psr/log/src/LoggerInterface.php:\n\nParse error: syntax error, unexpected '|', expecting variable (T_VARIABLE) in Standard input code on line 30\nErrors parsing Standard input code\n***********************************\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Committing transaction...\nsvn: E165001: Commit blocked by pre-commit hook (exit code 1) with output:\n\n***********************************\nPHP error in: simple-social-media-preview/tags/1.0.0/vendor/psr/log/src/LoggerInterface.php:\n\nParse error: syntax error, unexpected '|', expecting variable (T_VARIABLE) in Standard input code on line 30\nErrors parsing Standard input code\n***********************************\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I debugged alot and in the end I found no other solution than to delete the files that caused the problem, and prevent them from being loaded at all."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This can be done with a quite simple bash script."}]},{"type":"element","tag":"pre","props":{"code":"# remove_bootstrap80.sh\n# !/bin/bash\n\nfind ./vendor/symfony/polyfill -name \"*.php\" -type f | xargs sed -i -e \"/return require __DIR__\\.'\\/bootstrap80\\.php';/d\"\nfind ./vendor/symfony/polyfill -name \"bootstrap80.php\" -delete\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# remove_bootstrap80.sh\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# !/bin/bash\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"find"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" ./vendor/symfony/polyfill"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"*.php\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" |"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" xargs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" sed"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -i"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -e"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"/return require __DIR__\\.'\\/bootstrap80\\.php';/d\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"find"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" ./vendor/symfony/polyfill"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"bootstrap80.php\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -delete\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This will first remove the line that loads "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"bootstrap80.php"}]},{"type":"text","value":" in all files, then delete all the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"bootstrap80.php"}]},{"type":"text","value":" files.\nDoing this before uploading your plugin to the Wordpress SVN repository will make the problem to go away."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:how-to-fix-php-error-in-wordpress-plugin:index.md","_source":"content","_file":"posts/how-to-fix-php-error-in-wordpress-plugin/index.md","_extension":"md","sitemap":{"loc":"/posts/how-to-fix-php-error-in-wordpress-plugin","images":[]}},{"_path":"/posts/make-medium-readable-and-not-annoying","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Make Medium readable and less frustrating","description":"Lots of people write articles on Medium.com. Some of these articles are very useful and also rank very high on the Google search results. I often search for a solution to a software development problem I have, and am so happy to see somebody has made a Medium post about it.","date":"2020-11-28","language":"English","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Lots of people write articles on Medium.com. Some of these articles are very useful and also rank very high on the Google search results. I often search for a solution to a software development problem I have, and am so happy to see somebody has made a Medium post about it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then I enter the page ..."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It used to be just an annoying popup blocking the screen. But I could dismiss that. And we kinda take thay level of annoyance as a minimum in this post-GDPR phase of the Internet."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then Medium started hiding the text in the article. You had to create an account and have a subscription to read it. Those poor article authors who thought posting to Medium rather than their personal blog would give them more exposure."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, Medium won't even load on my computer. I don't know whether it's the battle between my adblockers and Medium's tracking scripts leaving the entire site as a unusable ruin. Or maybe I have too many weird extensions that are incompatible with Medium. Anyway, I figured I had to make Medium readable again with another extension."}]},{"type":"element","tag":"h2","props":{"id":"fix-it-by-blocking-javascript-with-an-extension"},"children":[{"type":"text","value":"Fix it by blocking Javascript with an extension"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The simples solution in my opinion is just installing the "},{"type":"element","tag":"a","props":{"href":"https://chrome.google.com/webstore/detail/quick-javascript-switcher/geddoclleiomckbhadiaipdggiiccfje","rel":["nofollow"]},"children":[{"type":"text","value":"Quick Javascript Switcher"}]},{"type":"text","value":" extension, and add medium.com to the list of blocked sites. After installing the extension, "},{"type":"element","tag":"a","props":{"href":"chrome://settings/content/javascript"},"children":[{"type":"text","value":"this is the link to the settings"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Add https://medium.com to the list of blocked sites in the Javascript settings of your browser.","src":"/posts/make-medium-readable-and-not-annoying/image-1.png","style":{"aspectRatio":"1037/239"}},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"enjoy-reading-medium-articles-again"},"children":[{"type":"text","value":"Enjoy reading Medium articles again"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All the popups, banners, login prompts etc will be gone when simply blocking Javascript."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"fix-it-by-blocking-javascript-with-an-extension","depth":2,"text":"Fix it by blocking Javascript with an extension"},{"id":"enjoy-reading-medium-articles-again","depth":2,"text":"Enjoy reading Medium articles again"}]}},"_type":"markdown","_id":"content:posts:make-medium-readable-and-not-annoying:index.md","_source":"content","_file":"posts/make-medium-readable-and-not-annoying/index.md","_extension":"md","sitemap":{"loc":"/posts/make-medium-readable-and-not-annoying","images":[]}},{"_path":"/posts/e-handel-i-norden-for-amazon","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"E-handel i Norden før Amazon","description":"Vi lever nå i de siste månedene før giganten Amazon endelig kommer til Norden. Vårt verdenshjørne gjenstår som et av de siste markedene uten en eller flere kjempeplattformer for netthandel, og det er der Amazon ser muligheten.","date":"2020-10-16T04:45:49.000Z","tags":["amazon","netthandel","plattform","aggregation"],"lang":"norwegian","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Et fraktfly fra Amazon med Prime-logoen på siden. I forgrunnen pakker fra Amazon klare til levering.","src":"/posts/e-handel-i-norden-for-amazon/amazon-prime-plane.jpg","style":{"aspectRatio":"2048/1367"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vi lever nå i de siste månedene før giganten Amazon endelig kommer til Norden. Vårt verdenshjørne gjenstår som et av de siste markedene uten en eller flere "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"kjempeplattformer"}]},{"type":"text","value":" for netthandel, og det er der Amazon ser muligheten."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En \"kjempeplattform\" er ikke bare et vagt buzzord. Jeg mener en "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"aggregator"}]},{"type":"text","value":" i "},{"type":"element","tag":"a","props":{"href":"https://stratechery.com/aggregation-theory/","rel":["nofollow"]},"children":[{"type":"text","value":"Ben Thompson's definisjon"}]},{"type":"text","value":". Kort sagt er det et fenomen som oppstår når nettverkseffekter fører til en positiv feedback-loop som stadig forsterker den dominerende spilleren i markedet. Jeg beverer ordet plattform fordi plattformsfunksjonaliteten er en viktig distinksjon mellom Amazon og alle nettbutikker vi har i Norge idag."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Amazon lar andre butikker selge sine varer på amazon.com. For andre butikker er det attraktivt fordi Amazon kan ta seg av betaling, frakt, lager, kundeservice og mer. Men aller viktigst er det at de fleste kundene er på Amazon allerede. Det at flere selgere velger Amazon fordi kunder er der gjør at Amazon's priser og utvalg blir enda bedre. Det fører igjen til at flere kunder velger Amazon. En positiv feedback-loop."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Av lignende grunner har f eks FINN.no blitt dominerende på boligannonser i Norge. Ingen boligselgere vil risikere å ikke ha en annonse på Finn. Det gjør at boligkjøpere kun sjekker annonsene på Finn, fordi de vet at alle annonsene er der. For en konkurrent å bryte den posisjonen Finn har der er utrolig vanskelig."}]},{"type":"element","tag":"h2","props":{"id":"alternativer-i-norden"},"children":[{"type":"text","value":"Alternativer i Norden"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I Norge ville både Elkjøp, Komplett og Finn lage egne plattformer for netthandel med samme modell som Amazon. Det var en stusselig og lite gjennomtenkt satsning fra alle sammen, fordi de ga opp og la ned "},{"type":"element","tag":"a","props":{"href":"https://blog.vikfand.com/posts/kolonial-norges-amazon/","rel":["nofollow"]},"children":[{"type":"text","value":"kort tid etter"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://cdon.com","rel":["nofollow"]},"children":[{"type":"text","value":"CDON.com"}]},{"type":"text","value":" er så vidt jeg vet eneste Nordiske selskap med noe som potensielt kan måle seg med det Amazon vil komme med. CDON.com er ikke lenger bare din platebutikk på nettet. Andre butikker som maxgaming.com, computersalg.com, adlibris.no, og mange fler selger sine varer gjennom CDON.com sin løsning. Dette er nesten usynlig for brukeren, men det fører til at CDON har det desidert beste utvalget av varer på nett i Norden med flere millioner artikler."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Skjermdump fra CDON.com sin side som promoterer deres markedsplass.","src":"/posts/e-handel-i-norden-for-amazon/cdon-com-marketplace.png","style":{"aspectRatio":"1045/772"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hvis den tidligere plategiganten kan fortsette å pushe på som plattform ved å få enda flere partnere, enda bedre betalingsløsninger, og enda bedre kundeservice, kan de muligens bygge en såpass sterk barriere at de kan bli en likeverdig konkurrent for Amazon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Men antakeligvis vil de ikke klare å slå Amazon på det å være en plattform for netthandel. Ikke minst fordi de har hatt flere år på seg til å komme med markedsføring og kundeklubber som Amazon Prime til å faktisk sementere posisjonen sin, men ikke gjort det i betydelig grad."}]},{"type":"element","tag":"h2","props":{"id":"hva-vil-amazonno-se-ut-som"},"children":[{"type":"text","value":"Hva vil Amazon.no se ut som?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Det blir spennende å se hvordan Amazon lanseres i Norden. De vil med sin svært effektive drift og lange erfaring antakeligvis kunne gi de beste prisene på nesten alle merkevarer. Jeg regner med at de vil lansere med flere store partnere på laget slik at de også selger varer i flere nisjer. Bare det vil gjøre Amazon til det mest naturlige stedet for en kunde å gå til for å handle noe på nettet."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Det mer usikre er om de vil lansere tjenester som Prime. Med medlemskap i Prime betaler man en liten sum i måneden mot at man får man gratis frakt på alt man bestiller. I USA får man også raskere leveringstid. Med en slik tjeneste og enormt utvalg vil kunder ha liten grunn til å engang sjekke andre butikker når de skal kjøpe noe."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Skjermdump fra Amazon sin nettside som promoterer Amazon Prime. Gratis levering og 150 millioner medlemmer promoteres.","src":"/posts/e-handel-i-norden-for-amazon/amazon-prime-banner.png","style":{"aspectRatio":"1013/531"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Amazon har i andre markeder brukt både egne løsninger og eksisterende tjenester for frakt av varene. F eks i USA begynte de å kun bruke posten til å levere for å så bygge et eget nettverk med egne biler og til og med fraktfly for å kunne levere raskere og billigere enn konkurrenter kunne drømme om. På dette området har CDON.com ingenting å konkurrere med. I Norge kan muligens Kolonial.no kunne måle seg med tilsvarende raskt frakttilbud. Kolonial har begynt å lage et nettbutikk i "},{"type":"element","tag":"a","props":{"href":"https://blog.vikfand.com/posts/kolonial-norges-amazon/","rel":["nofollow"]},"children":[{"type":"text","value":"motsatt ende som Amazon"}]},{"type":"text","value":". De har nå en knallgod logistikktjeneste i Oslo og Omegn, men om de kan begynne å selge varer med høyere margin enn dagligvarer gjenstår å se."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"alternativer-i-norden","depth":2,"text":"Alternativer i Norden"},{"id":"hva-vil-amazonno-se-ut-som","depth":2,"text":"Hva vil Amazon.no se ut som?"}]}},"_type":"markdown","_id":"content:posts:e-handel-i-norden-for-amazon:index.md","_source":"content","_file":"posts/e-handel-i-norden-for-amazon/index.md","_extension":"md","sitemap":{"loc":"/posts/e-handel-i-norden-for-amazon","images":[]}},{"_path":"/posts/serverless-strapi-tutorial","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Serverless Strapi Tutorial","description":"","date":"2020-08-17T01:25:06.000Z","language":"english","draft":false,"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"motivation"},"children":[{"type":"text","value":"Motivation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The JAM Stack and Serverless are two trends in web development that have a lot going on right now. One of the most common thing to do for a web developer is to create a website with a CMS. Static sites in themselves follow the serverless paradigm of infinite scalability, pay-per-use, and no-touch operations. But we lack an all-round CMS with the same properties."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Wordpress can be used as a headless CMS for modern front-ends, but the old giant is still not ready for more than a few use cases. There are managed CMS-es such as "},{"type":"element","tag":"a","props":{"href":"https://www.contentful.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Contentful"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://www.cosmicjs.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Cosmic"}]},{"type":"text","value":". These are good products, but are expensive for many users. Furthermore, they are not open source which entails some drawbacks such as not being very flexible."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Strapi is a leading open source headless CMS. While it's relatively new, it is popular, which means they really fill a need in the market. I have many complaints about Strapi, but they are, as far as I see it now, the best option for a general open source CMS."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One drawback even with Strapi is that you need to host it yourself. While it's easy to spin up a server with a database, you have to be worried about scaling it. Even for hobby projects which will probably never have to scale, I feel uncomfortable knowing I might have to get my hands dirty with scaling a database and all that."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Strapi is not made to be serverless. It is, however, possible to shoehorn a Strapi application onto AWS Lambda with the Serverless framework. Since AWS also has a MySQL compatible serverless database in Aurora, we might be able to create an infinitely scalable Strapi that requires very little ops, and costs nothing when not used."}]},{"type":"element","tag":"h3","props":{"id":"what-is-serverless"},"children":[{"type":"text","value":"What is serverless?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"It has little to do with servers."}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Infinitely scalable"}]},{"type":"text","value":"\nThe infrastructure can handle spikes and sudden growth is use without problem."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"No touch operations"}]},{"type":"text","value":"\nNot only is it scalable. Scaling does not require any effort. You don't manually add or remove instances. You don't write scripts to automatically do that stuff. It's taken care of in the infrastructure. You don't shut things down at night or in weekends to save money because you don't need to. You don't worry about scaling because you know it does so by itself."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Pay-per-use"}]},{"type":"text","value":"\nYou only pay when things are being done. Costs are predictable and follow a smooth, linear curve. No execution means zero cost."}]}]},{"type":"element","tag":"h2","props":{"id":"set-up-strapi"},"children":[{"type":"text","value":"Set Up Strapi"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We start by setting up Strapi locally. We roughly follow the "},{"type":"element","tag":"a","props":{"href":"https://strapi.io/documentation/v3.x/installation/cli.html","rel":["nofollow"]},"children":[{"type":"text","value":"official quick start guide"}]},{"type":"text","value":" for Strapi 3.1."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"yarn create strapi-app sls-strapi --quickstart\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" strapi-app"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" sls-strapi"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --quickstart\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This will create a basic Strapi app with the file based database SQLite in the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"sls-strapi"}]},{"type":"text","value":" folder. If successful, Strapi will run on "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"http://localhost:1337"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"/posts/serverless-strapi-tutorial/Untitled.png","src":"/posts/serverless-strapi-tutorial/Untitled.png","style":{"aspectRatio":"952/563"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 1.png","src":"/posts/serverless-strapi-tutorial/Untitled_1.png","style":{"aspectRatio":"480/694"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"While we won't use this instance of Strapi with the SQLite database, you should make at least one content type in Strapi either through the content type builder or by adding a content type in the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"api/"}]},{"type":"text","value":" folder. I will create a content type called "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"page"}]},{"type":"text","value":" with a single field called "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"title"}]},{"type":"text","value":". Make the content type and wait for the server to restart."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 2.png","src":"/posts/serverless-strapi-tutorial/Untitled_2.png","style":{"aspectRatio":"924/327"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add a single item to the collection, then test that it works by getting "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"http://localhost:1337/pages"}]},{"type":"text","value":". You will get a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"403 FORBIDDEN"}]},{"type":"text","value":" message, as we need to allow unauthenticated users read access to the collection."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 3.png","src":"/posts/serverless-strapi-tutorial/Untitled_3.png","style":{"aspectRatio":"1197/742"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Go to Roles & Permissions, edit the Public group and add permissions to read. "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"http://localhost:1337/pages"}]},{"type":"text","value":" should now respond with your single page item."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will come back to configuring Strapi for our serverless needs later."}]},{"type":"element","tag":"h2","props":{"id":"set-up-serverless"},"children":[{"type":"text","value":"Set up Serverless"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will add some Serverless config in the same folder as our Strapi app. If you're not familiar with Serverless, you should perhaps try to deploy a simple Express app on Amazon Web Services (AWS) first, just to get some idea of how it works. To get started, check out the official "},{"type":"element","tag":"a","props":{"href":"https://www.serverless.com/framework/docs/providers/aws/guide/quick-start/","rel":["nofollow"]},"children":[{"type":"text","value":"AWS quick start guide"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We install some packages and create a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" config and a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"app.js"}]},{"type":"text","value":" file to get started."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"yarn add -D serverless-offline\nyarn add serverless-http\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -D"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless-offline\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless-http\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless-http"}]},{"type":"text","value":" is an amazing plugin that makes it trivial to run any Node server as a Lambda function. Koa, which Strapi uses, is also supported."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless-offline"}]},{"type":"text","value":" is a well-made plugin that lets you run Serverless apps locally. It works well with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless-http"}]},{"type":"text","value":" and even simulates API Gateway, which is a layer in the AWS cloud all http requests go through."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"TIP"}]},{"type":"text","value":"\nUse a profile in your Serverless config with AWS credentials."}]},{"type":"element","tag":"GistIsland","props":{"gist":"viktorfa/909da389bfccd7255b147a63487ff7fd"},"children":[]},{"type":"element","tag":"GistIsland","props":{"gist":"viktorfa/8186fa9becd42baf5e83868a93de9297"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You should now have "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"app.js"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" in your root directory."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Before we try it, update the database config in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/database.js"}]},{"type":"text","value":", so that the storage path for SQLite in the cloud is in the writeable "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/tmp"}]},{"type":"text","value":" directory."}]},{"type":"element","tag":"GistIsland","props":{"gist":"viktorfa/da283a1381aaa6db8e7e89570ec5b08f"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It should now be possible to run Strapi as a Serverless app. Test it locally by executing"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"sls offline\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" offline\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This will start the serverless-offline server, but Strapi won't start until you visit an endpoint. Go to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"http://localhost:3000/dev/pages"}]},{"type":"text","value":". If you get a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"200 OK"}]},{"type":"text","value":" with the one page you created before, everything works as it should. The first response might be a bit slow, as the Strapi server takes some time to boot, but subsequent requests will be fast."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Serverless will add a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/dev"}]},{"type":"text","value":" prefix to your URL path, and we need to configure Strapi to work around this later. This is a feature of API Gateway, and not easy to get around without using a custom domain."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 4.png","src":"/posts/serverless-strapi-tutorial/Untitled_4.png","style":{"aspectRatio":"630/610"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now that we have it working locally, maybe we should try to deploy it to the cloud just to see that everything works as it should there too. Let Serverless deploy it with:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"sls deploy --verbose\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --verbose\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 5.png","src":"/posts/serverless-strapi-tutorial/Untitled_5.png","style":{"aspectRatio":"955/612"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"That did not work. The size of our application is way too large for Lambda. This is a common problem when attempting to run applications that are not at all designed for Lambda, in Lambda."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Fortunately, it is quite easy to divide the Strapi monolith into a frontend and backend. Our plan is to host the frontend as a static website (which can practically be hosted anywhere), and the backend as a Serverless app in AWS Lambda."}]},{"type":"element","tag":"h3","props":{"id":"trimming-strapi"},"children":[{"type":"text","value":"Trimming Strapi"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First, let's follow the "},{"type":"element","tag":"a","props":{"href":"https://strapi.io/documentation/v3.x/admin-panel/deploy.html#deploy-the-administration-panel-on-another-server-aws-s3-azure-etc-than-the-api","rel":["nofollow"]},"children":[{"type":"text","value":"official guide"}]},{"type":"text","value":" for running the admin part of Strapi separately, with some (maybe dirty) tricks to make it work well with our "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/dev"}]},{"type":"text","value":" path prefix."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Edit the config of "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/server.js"}]},{"type":"text","value":" to disable the admin panel, and take care of the path prefix."}]},{"type":"element","tag":"GistIsland","props":{"gist":"viktorfa/23847bd9f9926872f860455329b0153e"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will also edit the build command in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"package.json"}]},{"type":"text","value":" to run a bash script after the normal build."}]},{"type":"element","tag":"pre","props":{"className":"language-json shiki shiki-themes github-light github-dark","code":"// package.json\n{\n    ...\n    \"build\": \"strapi build && ./scripts/post-build.sh\",\n    ...\n}\n","language":"json","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// package.json\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B31D28;--shiki-dark:#FDAEB7;--shiki-default-font-style:italic;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"    \"build\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"strapi build && ./scripts/post-build.sh\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B31D28;--shiki-dark:#FDAEB7;--shiki-default-font-style:italic;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create a script called "},{"type":"element","tag":"a","props":{"href":"http://post-build.sh","rel":["nofollow"]},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"post-build.sh"}]}]},{"type":"text","value":" in a new folder called "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"scripts/"}]},{"type":"text","value":". Make it executable with:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"chmod +x scripts/post-build.sh\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"chmod"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" +x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" scripts/post-build.sh\n"}]}]}]}]},{"type":"element","tag":"GistIsland","props":{"gist":"viktorfa/4d0d3e1d9f6f317d7037bcead27f28c0"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The script simply moves the bundle files in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"build/"}]},{"type":"text","value":" to a sub folder called "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/dev"}]},{"type":"text","value":" which fixes the issue with our path prefixes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Build the admin panel with:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"IS_OFFLINE=true yarn build\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"IS_OFFLINE"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 6.png","src":"/posts/serverless-strapi-tutorial/Untitled_6.png","style":{"aspectRatio":"468/171"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Verify that the current setup works by starting the serverless-offline app with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"sls offline"}]},{"type":"text","value":", and then serve the frontend as a separate static site."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can serve the frontend with"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"npm i -g serve\nserve build/\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" i"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -g"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serve\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"serve"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build/\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 7.png","src":"/posts/serverless-strapi-tutorial/Untitled_7.png","style":{"aspectRatio":"947/335"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Go to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"http://localhost:5000"}]},{"type":"text","value":" and check that Strapi still works. Remember to run sls offline in the background."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It may be boring to move slowly and double check everything. One thing I've learnt using Serverless and AWS Lambda is that you will spend hours debugging the most trivial things and cryptic error messages if you don't double check and isolate everything at every step."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you can still use the Strapi admin, everything is going well."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The size of our code is still not small enough to be used in Lambda, so we need to trim more. Let's explore "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"node_modules"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 8.png","src":"/posts/serverless-strapi-tutorial/Untitled_8.png","style":{"aspectRatio":"956/645"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We see "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"node_modules"}]},{"type":"text","value":" is a whopping 561 MB. We also see a lot of fat packages that are definitely only for frontend use, such as those containing \"react\", \"fortawesome\", or \"bootstrap\". We also see that some locale-data, which is just translations, use most space of all."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It would be great if Strapi automagically removed all frontend stuff from "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"node_modules"}]},{"type":"text","value":" when we run the backend on a separate server, but I don't know of any such functionality. We will therefore manually delete some excessive packages with some simple commands we put in a bash script aptly called "},{"type":"element","tag":"a","props":{"href":"http://trim-node-modules.sh/","rel":["nofollow"]},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"trim-node-modules.sh"}]}]},{"type":"text","value":"."}]},{"type":"element","tag":"GistIsland","props":{"gist":"viktorfa/972a4ea019fdd1f0861059a9299df544"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install a neat tool called "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"node-prune"}]},{"type":"text","value":" first, which automatically removes files that are certainly unnecessary, such as Readmes etc. Get it done with:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"npm i -g node-prune\nchmod +x scripts/trim-node-modules.sh\n./scripts/trim-node-modules.sh\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" i"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -g"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" node-prune\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"chmod"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" +x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" scripts/trim-node-modules.sh\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"./scripts/trim-node-modules.sh\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"That should reduce the size of "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"node_modules"}]},{"type":"text","value":" to around 287MB without losing anything we need for the backend."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finish this step by successfully deploying with:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"sls deploy --verbose\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --verbose\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 9.png","src":"/posts/serverless-strapi-tutorial/Untitled_9.png","style":{"aspectRatio":"621/500"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Stack update finished... 🚀"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"That's what we want to see. The backend is now available online, and you can check it by visiting the generated endpoint ("},{"type":"element","tag":"a","props":{"href":"https://7s7w7gyekl.execute-api.us-east-1.amazonaws.com/dev/","rel":["nofollow"]},"children":[{"type":"text","value":"https://7s7w7gyekl.execute-api.us-east-1.amazonaws.com/dev/"}]},{"type":"text","value":" for me)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 10.png","src":"/posts/serverless-strapi-tutorial/Untitled_10.png","style":{"aspectRatio":"1097/500"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Our database is not at all suitable for Lambda, as it's an SQLite db where the data is stored in the local filesystem which can reset between Lambda invocations. However, it should work for demonstration purposes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check your logs with:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"sls logs --function api --tail\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" logs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" api"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --tail\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 11.png","src":"/posts/serverless-strapi-tutorial/Untitled_11.png","style":{"aspectRatio":"951/854"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Update "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/server.js"}]},{"type":"text","value":" with the newly generated endpoint."}]},{"type":"element","tag":"pre","props":{"className":"language-jsx shiki shiki-themes github-light github-dark","code":"// config/server.js\n\n// ...\nlet url = \"https://7s7w7gyekl.execute-api.us-east-1.amazonaws.com\";\n// ...\n","language":"jsx","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// config/server.js\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" url "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"https://7s7w7gyekl.execute-api.us-east-1.amazonaws.com\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"// ...\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's build the frontend again with the new endpoint in the config. Don't forget to delete the old build folder and reinstall the frontend packages we deleted previously."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"rm -rf build/\nyarn\nyarn build\nserve build/\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"rm"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -rf"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"serve"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build/\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Visit "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"http://localhost:5000"}]},{"type":"text","value":" and make sure Strapi is working as before."}]},{"type":"element","tag":"h2","props":{"id":"make-a-serverless-database-and-file-storage"},"children":[{"type":"text","value":"Make a serverless database and file storage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So far we have divided Strapi into two components: 1) a static website frontend and 2) a backend running on Lambda accessible through API Gateway. We will add two additional components. The backend also needs 3) a database and 4) a static file storage for images and other files we upload."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All the components should have the serverless properties. Scalable, pay-per-use, and no touch ops. For static file storage, we will use Amazon S3 file storage, which is not only highly appropriate for the task, but Strapi also comes with a plugin for S3."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The database is more tricky. It's possible to create a DynamoDB connector to Strapi, but that would limit the index flexibility of Strapi, and remove full text search. Let's consider the options."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.notion.so/6fefceebc6414fec8b6939e7030d409d","rel":["nofollow"]},"children":[{"type":"text","value":"Databases for Strapi Serverless"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"DynamoDB does not work with Strapi without a connector we would have to create ourselves."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Aurora is a managed relational database offered by Amazon. It is compatible with PostgreSQL or MySQL. It has a \"serverless\" configuration setting which enables sleep when inactive and auto scaling. The AWS managed databases like Aurora are only available within a Virtual Private Cloud (VPC). Having our Lambda function in the same VPC means it loses internet access without further configuration and costs, so we won't use that option in this tutorial."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We can use an external database such as Mongo hosted with "},{"type":"element","tag":"a","props":{"href":"https://www.mongodb.com/cloud/atlas","rel":["nofollow"]},"children":[{"type":"text","value":"Mongo Atlas"}]},{"type":"text","value":". It is not serverless, but it is managed and possible to scale by just upgrading a subscription. You can also host your own SQL or Mongo instance either in the Amazon cloud or somewhere else."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We don't have a perfect database option for all uses cases. If you use Strapi as a CMS or static sites, the database performance is not a priority at all, so we choose something that is easy to set up and has a free offering. This tutorial will show how to use Mongo Atlas."}]},{"type":"element","tag":"h3","props":{"id":"set-up-mongo"},"children":[{"type":"text","value":"Set up Mongo"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Just "},{"type":"element","tag":"a","props":{"href":"https://www.mongodb.com/cloud/atlas/register","rel":["nofollow"]},"children":[{"type":"text","value":"create an account"}]},{"type":"text","value":" and set up a free Mongo cluster in Atlas for the purpose of this tutorial. You must create a database user with a username and password, then get the connection URI and insert it as an environment variable to our Lambda function."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 12.png","src":"/posts/serverless-strapi-tutorial/Untitled_12.png","style":{"aspectRatio":"923/262"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Get the connection URI string in Cluster > Connect > Connect your application."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 13.png","src":"/posts/serverless-strapi-tutorial/Untitled_13.png","style":{"aspectRatio":"887/666"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add the connection URI as an environment variable."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"# serverless.yml\nprovider:\n    # ...\n    environment:\n        MONGODB_URI \"mongodb+srv://strapiowner:PASSWORD@cluster0.weldo.mongodb.net/strapi?retryWrites=true&w=majority\"\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"provider:\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    # ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"    environment:\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"        MONGODB_URI"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"mongodb+srv://strapiowner:PASSWORD@cluster0.weldo.mongodb.net/strapi?retryWrites=true&w=majority\"\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We then edit "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/database.js"}]},{"type":"text","value":" to tell Strapi to use the Mongo database."}]},{"type":"element","tag":"GistIsland","props":{"gist":"viktorfa/3975ee2e67f38e885d02b4e2c4c1097e"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Lastly, install the Strapi connector for Mongo:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"yarn add strapi-connector-mongoose\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" strapi-connector-mongoose\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can now start Strapi with  "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"sls offline"}]},{"type":"text","value":" and check that it works locally by visiting "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"http://localhost:3000/dev"}]},{"type":"text","value":". While it should work i the cloud as well, it's good to double check by deploying with:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"yarn && ./scripts/trim-node-modules.sh\nsls deploy --verbose\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" && "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"./scripts/trim-node-modules.sh\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --verbose\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"cloudformation-of-s3"},"children":[{"type":"text","value":"Cloudformation of S3"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We create a simple S3 bucket in our Cloudformation templates. An advantage of the Serverless framework is the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"infrastructure as code"}]},{"type":"text","value":" comes included to a large degree, so managing resources like S3 buckets is controlled and checked in your Git repo."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We edit the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"provider"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"custom"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"plugins"}]},{"type":"text","value":", and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"resources"}]},{"type":"text","value":" sections of our "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" config."}]},{"type":"element","tag":"GistIsland","props":{"gist":"viktorfa/76e6ee19dd53e3f1a03db360eabb5263"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the Strapi provider for S3 upload and two other plugins:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"yarn add strapi-provider-upload-aws-s3\nyarn add -D serverless-apigw-binary\nyarn add -D serverless-cloudformation-sub-variables\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" strapi-provider-upload-aws-s3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -D"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless-apigw-binary\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -D"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless-cloudformation-sub-variables\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We need to add some config in a new file called "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"config/plugins.js"}]},{"type":"text","value":". S3 in Lambda works quite automagically, so the only config we need is the bucket name. Note that the BUCKET_NAME environment variable will be \""},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"Object object"}]},{"type":"text","value":"\" if you run locally with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"sls offline"}]},{"type":"text","value":", because we get the bucket name in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" with a Cloudformation "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"!Ref"}]},{"type":"text","value":". After you deploy, you get the name of your S3 bucket which you can use to test with S3 locally later."}]},{"type":"element","tag":"GistIsland","props":{"gist":"viktorfa/6d8973dd95998b1325f4f8c981e08bf8"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To create the S3 bucket, deploy with"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark","code":"./scripts/trim-node-modules.sh\nsls deploy --verbose\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"./scripts/trim-node-modules.sh\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --verbose\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once deployed, visit "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"http://localhost:5000"}]},{"type":"text","value":" to visit the admin user interface. Go to Media Library and try to upload a file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 14.png","src":"/posts/serverless-strapi-tutorial/Untitled_14.png","style":{"aspectRatio":"709/237"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Untitled 15.png","src":"/posts/serverless-strapi-tutorial/Untitled_15.png","style":{"aspectRatio":"1499/532"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"File upload and API Gateway"}]},{"type":"text","value":"\nUploading files when using Serverless can be a bit of a hassle. All HTTP requests goes through an Amazon service called API Gateway. This gateway processes files in a certain way.\nUploads are often in a binary format, and we need to tell API Gateway explicitly which content types it should handle as binary files.\nIn Strapi the content type is "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"multipart/form-data"}]},{"type":"text","value":", and we configure this with the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless-apigw-binary"}]},{"type":"text","value":" plugin. DON'T add \""},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"/"}]},{"type":"text","value":"\" as a content-type, as this will break the CORS configuration of your API."}]},{"type":"element","tag":"h2","props":{"id":"wrapping-up"},"children":[{"type":"text","value":"Wrapping up"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You know have a scalable Strapi instance that is paid on a pay-per-use basis. Unfortunately, we were not able to make the database as serverless as the rest of the application, but for many use, cases, such as when Strapi is a backend for a CMS to a static site, this is of little significance."}]},{"type":"element","tag":"h3","props":{"id":"multi-tenancy-and-strapi-as-headless-cms"},"children":[{"type":"text","value":"Multi tenancy and Strapi as headless CMS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Strapi does not support multi tenancy. Meaning if you have a portfolio of websites that use Strapi as a CMS, each website needs its own Strapi instance. This is a major weakness of Strapi in my opinion. Wordpress supports multisite config, and many hosting providers have support for unlimited Wordpress instances on a single subscription, which is possible because Wordpress supports multi tenancy."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Many managed CMSs such as Contentful charge on a per user and per project basis. Meaning you have to pay much more once you want people to cooperate on a project or you have many projects."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Our Serverless Strapi allows scalable multi tenancy with Strapi in the following way: Create a new Strapi application for each project just like we did in this tutorial. Let all projects use the same database cluster, but a different database name and user. You can now create hundreds of Strapi APIs using the same fixed cost database. The other costs are S3 file storage, Lambda invocations, and some bandwidth which is billed on a pure pay-per-use basis."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the Git repo for this tutorial at "},{"type":"element","tag":"a","props":{"href":"https://github.com/viktorfa/strapi-serverless","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/viktorfa/strapi-serverless"}]},{"type":"text","value":"."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"motivation","depth":2,"text":"Motivation","children":[{"id":"what-is-serverless","depth":3,"text":"What is serverless?"}]},{"id":"set-up-strapi","depth":2,"text":"Set Up Strapi"},{"id":"set-up-serverless","depth":2,"text":"Set up Serverless","children":[{"id":"trimming-strapi","depth":3,"text":"Trimming Strapi"}]},{"id":"make-a-serverless-database-and-file-storage","depth":2,"text":"Make a serverless database and file storage","children":[{"id":"set-up-mongo","depth":3,"text":"Set up Mongo"},{"id":"cloudformation-of-s3","depth":3,"text":"Cloudformation of S3"}]},{"id":"wrapping-up","depth":2,"text":"Wrapping up","children":[{"id":"multi-tenancy-and-strapi-as-headless-cms","depth":3,"text":"Multi tenancy and Strapi as headless CMS"}]}]}},"_type":"markdown","_id":"content:posts:serverless-strapi-tutorial:index.md","_source":"content","_file":"posts/serverless-strapi-tutorial/index.md","_extension":"md","sitemap":{"loc":"/posts/serverless-strapi-tutorial","images":[]}},{"_path":"/posts/social-media-preview-by-url-get","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Social media preview by url get","description":"I had an idea for a very simple SaaS. Quick generation of social media preview images.\nWebsite owners can choose a featured image to be shown whenever a page is shared on social media. Having a good image is important, as it makes people quickly see what the link is about, and make them more likely to click it. But it is quite a pain in the ass (PITA) to manage these images, as they need to have correct dimensions, and you might want to have a different image for each of your thousands of articles.","date":"2020-06-23 08:00:00 +0000","categories":["business","idea","development"],"layout":"post","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I had an idea for a very simple SaaS. Quick generation of social media preview images.\nWebsite owners can choose a featured image to be shown whenever a page is shared on social media. Having a good image is important, as it makes people quickly see what the link is about, and make them more likely to click it. But it is quite a pain in the ass (PITA) to manage these images, as they need to have correct dimensions, and you might want to have a different image for each of your thousands of articles."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bloggers and article writers often select a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"featured image"}]},{"type":"text","value":" for each piece of content that is used as an for an internal link, like the front page of an online newspaper. The featured image is also often highly visible above the text content on the page. A common problem is that this image will be shown when a page is shared on social media, but it does not have the correct proportions. So we get situations when half of John Bolton's face is shown on the link preview or something like that.\nContent creators can crop a custom photo for the social sharing purpose, but this can be tedious.\nSome big sites seem to always do this, perhaps automatically, to make really good social share preview images with a relevant image and perhaps some text and/or logo laid on top.\nBut there's no easy way to do this for most sites, as we can see by observing the bad state of social share preview images around the web."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Social share preview image of a post on Slate Star Codex. The preview image is too small and uninformtive.","src":"/posts/social-media-preview-by-url-get/slatestarcodex-preview.png","style":{"aspectRatio":"963/147"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://slatestarcodex.com","rel":["nofollow"]},"children":[{"type":"text","value":"slatestarcodex.com"}]},{"type":"text","value":" is an excellent blog, but it lacks a good social preview image for its articles."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Social share preview image of an article on D Hagemeier's blog. The image contains only text and a logo and looks good.","src":"/posts/social-media-preview-by-url-get/d-hagemeier-preview.png","style":{"aspectRatio":"567/455"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"D Hagemeier automatically creates good social share images for his blog posts by programming a script."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Social share preview image of an article on the Norwegian news site NRK. The image is small and crops half of John Bolton's face out.","src":"/posts/social-media-preview-by-url-get/nrk-bolton-preview.png","style":{"aspectRatio":"540/254"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A solution is to simply use a title and a subtitle as input, and output an appropriate image with the right dimensions. D Hagemeier shows how this can be done in an "},{"type":"element","tag":"a","props":{"href":"https://www.d-hagemeier.com/en/articles/generate-social-media-preview-images/","rel":["nofollow"]},"children":[{"type":"text","value":"inspiring article"}]},{"type":"text","value":" from December 2010. Hagemeier is a talented programmer and does this automatically with is own script. I want to make such a script available for anyone to use so easily that it's effortless. It can be done by instead of first creating an image when publishing an article, you use an url link that includes the title and subtitle. The url points to my server which generates an image on the fly."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The idea is so simple I kinda expect somebody else to have done this already. They just need a server that generates an image based on some input text, and that's it. Even of there were somebody doing this, it's clearly not widespread enough, as many great websites lack good preview images for their pages. Even though, with a solution like I had in mind, it would be easy to generate a good image for all your pages."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After writing the first draft of this article, I found out there are at least two similar services out there: "},{"type":"element","tag":"a","props":{"href":"http://bannerbear.com","rel":["nofollow"]},"children":[{"type":"text","value":"bannerbear.com"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://placid.com","rel":["nofollow"]},"children":[{"type":"text","value":"placid.com"}]},{"type":"text","value":". Both offer a service to generate images based on text, which you can then insert into your web page. But only Placid offers to generate an image on the fly with a simple get request. This last solution is as far as I can think of, much easier for a website owner to manage."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Placid seems like such a good product I'm quite doubtful whether it's worth competing with them. The only strategy I can think of is just making a much simpler product, and allow for free trials with no time limit. Placid seems to have grown to a huge app supporting things like generating images for Instagram and integrating with Airtable. This can seem like too much for, say a developer who wants better preview images for her blog, which is why a strategy for my service could be to make it dead simple to get started with."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Placid allows free (as in beer) use of its API, but not with your own templates. There's a technical reason for this, as you can't really control who uses an API of this kind. Each person using the API will cost some money to the server owner, so my idea only works if enough people pay for a premium version. Perhaps by being really lean, the costs will be low enough for such a business model to work."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Maybe my product could have a landing page with a preview generator and the exact url need to create that. Premium features could be remove watermark, add logo, custom fonts, or other customization."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This product could risk getting a helluva lot of queries, as we can't really control who wants to generate an image. If it's not abused, though, Facebook and I suppose other apps cache the social preview images themselves. This service should also store images it generates so that it can cheaply serve them when asked a second time."}]},{"type":"element","tag":"h2","props":{"id":"say-hi-to-sharizard"},"children":[{"type":"text","value":"Say hi to Sharizard"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://sharizard.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Sharizard"}]},{"type":"text","value":" is the product I launched for this social share preview image generator. It was quick to make an MVP, and I'm using it for my own sites already. The name aims to be playful, as the product is primarily aimed at small time developers, bloggers and website owners. The main competitor, Placid, has a name I don't know how to explain, but it sounds a bit colder in my opinion. Shout out to my old friend Shahariar for first coming up with this awesome name."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Screenshot of the SaaS Sharizard, which makes it easy to create social share preview images with informative text by simply pasting a url on your site.","src":"/posts/social-media-preview-by-url-get/sharizard-screenshot.png","style":{"aspectRatio":"760/857"}},"children":[]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"say-hi-to-sharizard","depth":2,"text":"Say hi to Sharizard"}]}},"_type":"markdown","_id":"content:posts:social-media-preview-by-url-get:index.md","_source":"content","_file":"posts/social-media-preview-by-url-get/index.md","_extension":"md","sitemap":{"loc":"/posts/social-media-preview-by-url-get","images":[]}},{"_path":"/posts/verden-og-responsen-til-koronaviruset","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Verden og responsen til koronaviruset","description":"Koronaviruset i 2020 er forhåpentligvis den største hendelsen dette tiåret. Reaksjonen til folk, media og politikere har gitt oss et innblikk i hvordan verden fungerer i en stressituasjon. Spesielt interessant er Kinas og internasjonale organisasjoners rolle i dette.","date":"2020-04-02T02:45:49.000Z","tags":["korona","virus","covid","who","kina","politikk"],"lang":"norwegian","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"De som følger nyheter om Kina tett har hatt et spennende år i år. Det kommer stadig utrolige nyheter fra Kina, men de fleste sakene forblir begrenset til spesielt interesserte. Denne gangen har det gått helt overbord, og både Kinas og og internasjonale organisasjoners håndtering av koronaviruset har blitt noe alle må ta stilling til."}]},{"type":"element","tag":"h2","props":{"id":"uklare-kinesiske-tegn-i-januar"},"children":[{"type":"text","value":"Uklare kinesiske tegn i januar"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Allerede i januar begynte det å komme tweets og noen artikler om et mulig nytt utbrudd av noe tilsvarende SARS. De som kjenner Kina litt vet at nyhetene om SARS ble kraftig nedspilt av kinesiske myndigheter i sin tid. Under SARS-utbruddet hadde mediene i Kina et snev av frihet til å drive uavhengig journalistikk, men det var likevel ikke lett å få nyheter ut under kommunistpartiets vake. Nå i 2020 er mediene i Kina under "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"mye"}]},{"type":"text","value":" mer press fra myndighetene, og knapt noe som helst blir trykket dersom redaktører og journalister kan tenke seg at det faller i dårlig jord hos partiets ledelse. I januar var det derfor svært usikkert hva som foregikk, og hvor seriøst det var."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Midt under den kinesiske nyttårsfeiringen fikk vi et tegn som kunne tolkes tydelig. Mens verdens største årlige migrasjon av kinesere som reiser fra byene til hjembygda var i full gang, ble ordre gitt fra øverste hold i kommunistpartiet om å stenge all trafikk inn og ut av Wuhan. Det var et drastisk grep som tydet på at det som foregikk var alvorlig. Om kommunistpartiets ledelsesmåte er kjent for noe, så er det å handle innmari drastisk når de først handler. Ofte er det overreaksjoner som fører til tragedier, men det er et klart tegn på hva lederne prioriterer å få gjort."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"På grunn av stor kontroll av media i Kina er det svært vanskelig for observatører å få et godt bilde over hva som foregår. Det man stort sett ser er enten gladnyheter eller fordømmelser, mens ubekreftede rykter spres hele tiden over internett. De gruppene som faktisk vet hva som foregår er de som jobber på gulvet og lokale myndigheter. Begge disse gruppene er livredde for å skape trøbbel ved å komme med dårlige nyheter, så ting blir ofte ikke rapportert opp. Dr Li Wenliang er en av de på gulvet som snakket litt for høyt om mulige dårlige nyheter. Han ble straffet for å spre falske rykter, for å så dø av koronaviruset og etterlate seg en gravid kone. Dette tragiske dødsfallet skapte så store reaksjoner hos kinesere at sensurmyndighetene unngikk å fjerne frustrerte Wechat-poster med subtil kritikk av styresmaktene. Men da støvet la seg noen dager senere ble de sensurert igjen."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Logg fra chatgruppa Dr Li Wenliang informerte kolleger om det nye viruset den 30. desember 2019.","src":"/posts/verden-og-responsen-til-koronaviruset/li_wenliang_chat.png","style":{"aspectRatio":"800/600"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hvorfor oppførte myndighetene i Wuhan seg sånn de gjorde mot Dr Li? De var selv livredde for å komme med dårlige nyheter til sjefene sine i Beijing. De håpet at det hele ville gå over av seg selv, og visste at det bare var noe å tape ved å komme med bekymringer."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Li Wenliang ble avhørt av politiet for å ha spredt usanne rykter, og tvunget til å skrive under på en innrømmelse av skyld. Selv om ryktespredning kan ha negative konsekvenser, er dette en ganske så undertrykkende handling av myndighetene. Og sett i konteksten av at ryktene han spredde kun foregikk i en privat chatgruppe for kolleger og alumni fra universitetet hans er det nesten Orwelliansk. Det skal sies at Dr Li faktisk sa at utbruddet var av "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"SARS"}]},{"type":"text","value":", noe som faktisk var ubekreftet, men myndighetenes reaksjon var fortsatt litt overdreven."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nDet var akkurat i disse dager at verdens helsemyndigheter og epidemiforskere spent venta på mer informasjon fra Kina. Viktig og faktabasert informasjon som bekreftelse på smitte og genomdata kom ut senere, men man spekulere i om verden hadde fått bedre informasjon fortere dersom miljøet for diskusjon og åpenhet hadde vært bedre i Kina. Vi aner ikke hvor mange leger og forskere som visste noe, men ikke turte lufte tankene da de visste at selv å dele informasjon med kolleger kunne føre til avhør av politiet."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Artikkel fra kinesisk statsmedia med overskrift \"Turning the tide\" -- Xi leads anti-virus war toward victory","src":"/posts/verden-og-responsen-til-koronaviruset/xi_leder_krigen_mot_seier.png","style":{"aspectRatio":"1011/942"}},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Denne artikkelen har ikke med begynnelsen av utbruddet å gjøre, men legg merke til språkbruk og mild persondyrkelse i kinesisk statsmedia."}]}]},{"type":"element","tag":"h2","props":{"id":"tid-til-å-reagere"},"children":[{"type":"text","value":"Tid til å reagere"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Siste halvdel av januar var et kritisk periode, fordi resten av verden kunne ganske tydelig se alvoret, og vi hadde da fortsatt tid til å begrense spredningen. Til tross for dette ble lite gjort. Vårt mediebilde besto grovt sagt av to deler. Den første delen var sensasjonalisme, eller artikler som trigget redsels– og bekymringsinstinktene våre. Den andre delen besto av \"fornuftsposering\", en motreaksjon på den første delen, der offentlige personer og profesjonelle \"meningshavere\" spilte ned alvoret av situasjonen ved å si at viruset ikke var verre enn influensa, og at grensekontroll var en ufornuftig overreaksjon, osv. I den første delen brukte man de hurtig voksende offisielle tallene fra Kina til å spre frykt. Den andre delen sammenlignet de samme tallene med statistikk fra vanlig influensa uten å forstå at vanlig influensa er kjent, under kontroll, og allerede globalt, mens det nye viruset er ukjent, ikke ennå globalt, og vokser eksponensielt. Ingen var kritiske til de offentlige tallene fra Kina, som garantart ikke har noe med virkeligheten å gjøre."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vi sto da ovenfor en \"long tail\" situasjon. Det vil si at de mulige scenarionene for fremtiden ikke spente fra "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"litt dårlig"}]},{"type":"text","value":" til "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"litt bra"}]},{"type":"text","value":", men rommet av mulige utfall inkluderte "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"ekstremt dårlig"}]},{"type":"text","value":". Hva som faktisk ville skje var ukjent, antakeligvis ville det gå bra, men en potensielle nedsiden var kjempestor. Som å seile over Skagerrak uten å sjekke værmeldingen. Antakeligvis går det bra, og det er ingen bevis på at det blir storm. Men hvis det skulle bli storm er du ferdig, og sannsynligheten for storm er ikke neglisjerbar."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Jeg har litt sympati for politikerne i den situasjonen. De kunne satt igang tiltak som kunne reddet oss senere, men ingen ville takke dem for det. For i ettertid kunne man sagt: \"Der ser du, det var ikke verre enn influensa!\". Ved å ikke gjøre noe slapp man å ta et vanskelig valg, og man kunne fortsatt komme og redde dagen senere. En politiker kunne også vise til anbefalinger fra supranasjonale organisasjoner som WHO, og slik beskytte sitt eget skinn ved å hevde at ingen visste bedre."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Amerikanske medier skaper narrativet om at det nye viruset ikke er verre enn influensa.","src":"/posts/verden-og-responsen-til-koronaviruset/its_just_a_flu_media.jpeg","style":{"aspectRatio":"960/785"}},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"verdens-inkompetente-helseorganisasjon"},"children":[{"type":"text","value":"Verdens inkompetente helseorganisasjon"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En organisasjon som er skapt for å hjelpe oss i slike situasjoner er verdens helseorganisasjon (WHO). En supranasjonal organisasjon som blomstrer i denne globaliseringens tid. Akkurat som med FN vet alle nordmenn at disse organisasjonene uten tvil kjemper for "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"det gode"}]},{"type":"text","value":". Her har ingen ringere enn vår egen landsmoder, Gro Harlem Brundtland, tjent som generalsekretær."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Det er nok mange personer med stort talent og høy etisk standard i en slik organisasjon, men toppledelsen består stort sett av pensjonerte toppolitikere, og andre som vil ha en prestisjefull tittel og delta på prektige toppmøter. Noen av disse toppmøtene finner sted i Kina, og Kina har som nasjonal strategi å sørge for at deltakere på slike møter får en uforglemmelig opplevelse og blir sittende med et inntrykk av midtens rike som godt."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"WHO fikk faktisk rapporter med viktig informasjon fra medlemsland i god tid for å stoppe spredningen av viruset. Kina rapporterte den 31. desember om en ny type lungebetennelse av ukjent opphav. Samme dag kom også Taiwan, som blir utestengt fra WHO pga. Kina, med advarsler. Taiwan har et helt spesielt forhold til Kina, og er antakeligvis landet i verden best skikket til å se gjennom offentlige usannheter fra sin store nabo. Sammen med Macau og Hong Kong begynte Taiwan å undersøke tilreisende fra Wuhan fra 31. desember, som vil si at disse tre myndighetene var de første til å iverksette smittebegrensning av noe slag. Til tross for at over en million taiwanesere jobber i Kina, har øynasjonen klart å begrense spredningen merkverdig, uten engang å innføre lockdown eller andre ekstreme tiltak. Kun Nord-Korea som stengte grensene allerede 21. januar ser ut til å bli skånet i større grad enn Taiwan."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"WHO er er institusjon med tyngde. Det de sier og gjør blir sett av både politikere, journalister, og vanlige folk. Du har sikkert lagt merke til at flere apper nå viser en liten infomelding om koronaviruset, og denne inneholder en lenke til ingen andre enn WHO. Med dette følger et enormt ansvar, og idealer som sannhet og åpenhet bør stå høyere enn politisk manøvrering. Det er her WHO kom til kort i denne krisen."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Av et ønske om å ha et godt forhold til Kina har organisasjonen gang på gang uttalt seg feilaktig eller ufullstendig. Etter en Den 14. januar uttalte de at det ikke fantes klart bevis for at viruset var smittsomt. Ja ok, men at det ikke finnes bevis er ikke et bevis på at det ikke er noe der. Hvorfor sa de dette da situasjonen fortsatt var uklar, om det ikke var for å tilfredsstille Kina?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"WHO melder i en Tweet at det ikke finnes bevis for menneske-til-menneske smitte for viruset.","src":"/posts/verden-og-responsen-til-koronaviruset/who_no_evidence.png","style":{"aspectRatio":"601/668"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Den nåværende generalsekretæren for WHO sa litt senere at Kina håndterte situasjonen eksemplarisk. Virkelig? Der en lege fra Wuhan ble avhørt av politiet for å dele informasjon om viruset med kolleger i en privat chatgruppe, for å senere dø av sykdommen han prøvde å redde oss fra. Der tilfeller ble bekreftet så tidlig som november. Der vi nå vet at forskning på viruset "},{"type":"element","tag":"a","props":{"href":"https://www.nationalreview.com/news/chinese-authorities-gagged-laboratories-in-december-over-coronavirus-sars-connection/","rel":["nofollow"]},"children":[{"type":"text","value":"ble tiet ned i desember"}]},{"type":"text","value":". Der WHO ble varslet allerede 31. desember, mens i Kina var emnet praktisk talt forbudt å diskutere offentlig før 23. januar.\nWHO kom også den 31. januar med en uttalelse om at reiserestriksjoner ikke var nødvendige. Etter at flere land hadde begynt med omfattende restriksjoner, og nå i mars er mindre rammet på grunn av disse."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Det som fikk meg til å begynne å skrive denne artikkelen var da epidemolog i WHO Bruce Aylward med skammelig feighet nektet å svare på spørsmål relatert til Taiwan. Han nektet i det hele tatt å nevne Taiwan. Alle som har fulgt Kina litt vet hvordan Taiwan systematisk blir utelukket fra internasjonele organisasjoner, og hvordan Kina prøver å styre den offentlige oppfattelsen av Taiwan som et land. Det at hotellkjeder blir truet med utestengelse fra det kinesiske markedet dersom de ikke lister Taiwan som en region av Kina er ikke hovedpoenget med WHOs håndtering av koronaviruset, men det viser hvor stor rolle politikk og ønske om å ha et godt forhold med Kina styrer WHOs dagsorden."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://twitter.com/BonnieGlaser/status/1243907343269666818","rel":["nofollow"]},"children":[{"type":"text","value":"https://twitter.com/BonnieGlaser/status/1243907343269666818"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En organisasjon som priser Kinas håndtering av viruset og som nekter å engang nevne at Taiwan eksisterer som et uavhengig land. Kan vi regne med at de baserer seg på nøytrale fakta, eller er de blitt et jakttrofe for Kinas kommunistparti?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Polandball illustrasjon om forskjellige lands reaksjon til viruset.","src":"/posts/verden-og-responsen-til-koronaviruset/coronavirus_polandball.jpg","style":{"aspectRatio":"1080/810"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Li_Wenliang","rel":["nofollow"]},"children":[{"type":"text","value":"Li Wenliang (Wikipedia)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Timeline_of_the_2019%E2%80%9320_coronavirus_pandemic_from_November_2019_to_January_2020","rel":["nofollow"]},"children":[{"type":"text","value":"Utbruddets tidslinje (Wikipedia)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Travel_restrictions_related_to_the_2019%E2%80%9320_coronavirus_pandemic","rel":["nofollow"]},"children":[{"type":"text","value":"Reiserestriksjoner ifm. viruset (Wikipedia)"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://threadreaderapp.com/thread/1221486205847646208.html","rel":["nofollow"]},"children":[{"type":"text","value":"Systemic Risk of Pandemic via Novel Pathogens"}]},{"type":"text","value":" – en artikkel som beskriver potensielle katastrofale følger av nye patogener i en verden som er så sammenkoblet som vår."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://www.nrk.no/urix/brak-etter-at-who-nestsjef-nektet-a-svare-om-taiwan-1.14965483","rel":["nofollow"]},"children":[{"type":"text","value":"Artikkel om Bruce Aylwards respons til spørsmål om Taiwan (NRK)"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"uklare-kinesiske-tegn-i-januar","depth":2,"text":"Uklare kinesiske tegn i januar"},{"id":"tid-til-å-reagere","depth":2,"text":"Tid til å reagere"},{"id":"verdens-inkompetente-helseorganisasjon","depth":2,"text":"Verdens inkompetente helseorganisasjon"}]}},"_type":"markdown","_id":"content:posts:verden-og-responsen-til-koronaviruset:index.md","_source":"content","_file":"posts/verden-og-responsen-til-koronaviruset/index.md","_extension":"md","sitemap":{"loc":"/posts/verden-og-responsen-til-koronaviruset","images":[]}},{"_path":"/posts/qe-og-aksjepriser","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Kvantitativ lettelse og aksjepriser","description":"Kvantitativ lettelse (QE) er når sentralbanken kjøper finansielle eierdeler som gjeld og obligasjoner. Det fører til økning av penger i markedene. Mer penger med samme antall varer betyr høyere priser.","date":"2020-03-29T04:45:49.000Z","tags":["aksjer","qe","marked","økonomi","korona","finanskrise"],"lang":"norwegian","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Kvantitativ lettelse eller \"quantitive easing (QE)\" er et uttrykk vi har hørt mye om siden finanskrisen i 2008."}]},{"type":"element","tag":"h2","props":{"id":"kvantittitatativ-hvaforno"},"children":[{"type":"text","value":"Kvantittitatativ hvaforno?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La oss begynne med at kvantitativ lettelse er et dårlig uttrykk som ikke i det hele tatt er beskrivende for hva det faktisk er. Hvis sentralbanken kjøper finansielle eierandel som aksjer, derivater, obligasjoner, osv. så kaller vi det kvantitativ lettelse."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sentralbanken har historisk sett i all hovedsak kun eid statsobligasjoner, og har hatt som rolle å indirekte styre økonomien ved å låne ut penger til banker til en styringsrentenivå den selv bestemmer. Styringsrenta er roten til prisen av penger, og bestemmer omtrent hva renta på lån bedrifter og privatpersoner er.\nI krisetid tar sentralbanken en litt annen form og blir siste utveis utlåner (lender of last resort), og låner ut penger til banker når ingen andre tær å låne til hverandre.\nDette er et mektig verktøy som må brukes med stor omhu. Sentralbanken har potensielt uendelig med penger og når den trykker penger påvirker det hva penger er verdt. Trykker den for mye, så kan økonomien kollapse og en humanitær krise inntre som følge av hyperinflasjon."}]},{"type":"element","tag":"h2","props":{"id":"hvordan-vi-begynte"},"children":[{"type":"text","value":"Hvordan vi begynte"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finanskrisen i 2008 kom som følge av at en boligboble i USA sprakk i 2007. I utgangspunktet kan en boligboble sprekke uten at den stopper verden fra å gå sin gang, men banker og finansselskap hadde tatt og gitt store lån og avtaler med antakelsen av at boligboblen aldri ville sprekke."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bankene ble tatt med buksene nede da man fant ut at de eide haugevis av boliglån som plutselig ingen ville kjøpe lenger. Disse boliglånene ville antakeligvis aldri bli betalt tilbake. Ingen ville kjøpe dem, og de sank så mye i pris at ingen visste hva prisen var."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Fordi bankene hadde brukt disse lånene som plutselig ble verdiløse som garanti i andre lån, hadde sprekkingen av boligboblen ringvirkninger i hele verdensøkonomien. Ingen ville gi ut lån lenger, som førte til at ingen kunne investere, som førte til at mange mista jobben og dårlig økonomi."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sentralbankene kom flyvende inn med kappe for å redde økonomien. Renta var allerede så lav at den vanlige medisinen av å senke rentenivået ikke var effektiv lenger, da det kunne føre til høy inflasjon. Istedet ville de redde bankene ved å kjøpe de verdiløse boliglånene til en såpass høy pris at bankene kunne fortsette å operere som vanlig. Bankene hadde tatt ansvarsløse beslutninger, satt økonomien på spill, men slapp å høste det de sådde. De kom seg stort sett godt unna og tok godt betalt for det.\nMange mener at sentralbankens beslutning i å kjøpe de verdiløse lånene kanskje reddet verden fra en mer betydelig økonomisk kollaps. Det er godt mulig. I desperate sitasjoner kan man bruke ekstreme virkemidler, akkurat som kirurger kan bruke morfin i operasjoner uten narkose."}]},{"type":"element","tag":"h2","props":{"id":"og-vi-fortsetter-med-uendelig-qe"},"children":[{"type":"text","value":"Og vi fortsetter med uendelig QE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Eksreme tiltak blir et problem i lengden hvis pasienten blir avhengig av det. Det er ikke sunt å være avhengig av morfin jevnlig for å overleve."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vår pasient er økonomien og den er avhengig av kvantitativ lettelse. Det som skulle være et krisetiltak har nå blitt dagsorden for sentralbanker i USA og Europa. Svevende drømmer om en 100% effektiv økonomi, et aksjemarked som aldri synker, matematiske modeller som spår fremtiden, er hva økonomer med makt tror på. Dette systemet har vært på brinken av kollaps en stund, men når renta er på rundt 0% og sentralbanken kjøper papirer ingen andre vil kjøpe, så kan det fortsette frem til vi merker konsekvensene på andre måter."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Er det krise om økonomien ikke vokser så fort eller til og med krymper en stund? Nei, det bør i alle fall ikke være det. Men på grunn av store mengder gjeld og en religiøs overbevisning av økonomer med makt at økonomien "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"må"}]},{"type":"text","value":" vokse jevnt og trutt, så gjør de alt for å få tallene til å vise det de vil. Jo mer de pusher økonomien på denne måten, jo verre blir det når vi til slutt må møte virkeligheten, og at kontinuerlig økonomisk vekst ikke er mulig."}]},{"type":"element","tag":"h2","props":{"id":"kvantitativ-lettelse-og-priser-på-aksjer-og-andre-instrumenter"},"children":[{"type":"text","value":"Kvantitativ lettelse og priser på aksjer og andre instrumenter"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"QE er at sentralbanken kjøper finansielle papirer. De begynte med å kjøpe verdiløse lån for å redde økonimien fra krise, men har fortsatt med å kjøpe mye sikrere instrumenter som obligasjoner. Dette fører til at utbytte i obligasjoner blir mindre, som igjen fører til at andre investorer som privatpersoner og fond ser etter andre instrumenter med mer utbytte."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I hovedsak er disse andre instrumentene aksjer, hvis prisøkning er mye større enn BNP, men vi har også sett kraftig økning i prisene på eiendom og noen råvarer samt kryptovaluta siden sentralbankene begynte å booste økonomien med QE."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"QE resulterer i mer penger i finansmarkedene. Mer penger med samme mengde varer betyr økning i pris. Som konsekvens har alle som allerede eide aksjer og andre finansielle eierdeler økt sin formue betraktelig siden finanskrisen, men for alle andre er det vanskeligere å komme inn på markedet. Dette er enda en trend, i tillegg til globalisering og automasjon, som fører til mer økonomisk ulikhet i vår del av verden. Heldigvis har Norge egen valuta og et utenlands pensjonsfond som lar oss ta del i bonanzaen."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"kvantittitatativ-hvaforno","depth":2,"text":"Kvantittitatativ hvaforno?"},{"id":"hvordan-vi-begynte","depth":2,"text":"Hvordan vi begynte"},{"id":"og-vi-fortsetter-med-uendelig-qe","depth":2,"text":"Og vi fortsetter med uendelig QE"},{"id":"kvantitativ-lettelse-og-priser-på-aksjer-og-andre-instrumenter","depth":2,"text":"Kvantitativ lettelse og priser på aksjer og andre instrumenter"}]}},"_type":"markdown","_id":"content:posts:qe-og-aksjepriser:index.md","_source":"content","_file":"posts/qe-og-aksjepriser/index.md","_extension":"md","sitemap":{"loc":"/posts/qe-og-aksjepriser","images":[]}},{"_path":"/posts/stock-buybacks-og-aksjepriser","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Stock buybacks og aksjepriser","description":"Tilbakekjøp av egne aksjer er et usunt fenomen vi har sett mye av i det siste. Hva har det å si for økonomiens helse og aksjepriser?","date":"2020-03-29T04:45:49.000Z","tags":["aksjer","marked","økonomi","korona","finanskrise"],"lang":"norwegian","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"hva-er-stock-buybacks"},"children":[{"type":"text","value":"Hva er stock buybacks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Stock buybacks eller \"tilbakekjøp av egne aksjer\" er når et selskap kjøper sine egne aksjer. Aksjer ligger ute på børsen hvor hvem som helst – privatpersoner, fond, og selskap – kan kjøpe dem. Det er da ingen teknisk grunn til at et selskap ikke kan kjøpe "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tilbake"}]},{"type":"text","value":" sine egne aksjer."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Tilbake er et nøkkelord, for husk at alle aksjer i utangspunktet er en eierandel av et selskap som selskapet selv lager og selger for å skaffe investorer. Hver aksje i et aksjeselskap representerer et eierandel av selskapet. Èn aksje i et selskap med 100 aksjer tilsvarer 1% av selskapet, og det gir eieren rett til 1% av overskuddet til bedriften i fremtiden hvis bedriften bruker overskuddet til utbytte."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En bedrift kan gå med overskudd og overføre pengene i form av utbytte til aksjeeierene. Bedriften kan også avgjøre at overskuddet burde brukes på andre måter. Som å investere i nye maskiner, nye ansatte, betale tilbake gjeld, osv.\nEn kontroversiell bruk av overskuddet er å kjøpe tilbake egne aksjer. Det gir ikke særlig mye mening at et selskap skal bytte egne penger mot egne aksjer, da formålet med aksjer er å gjøre det motsatte: å selge aksjer slik at bedriften får penger. Det gir heller ingen fortrinn til bedriften å eie aksjer. Det bedrifter skal gjøre med kapital er å investere for å forbedre seg selv, og hvis det ikke er mulig, betale utbytte til eierene som belønning for at de investerte tidligere."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I de siste årene har vi sett en voldsom økning i etterkjøp av egne aksjer i store selskaper. Det kan ha negetive konsekvenser for økonomien, og er også et tegn på at noe er fundamentalt galt."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Googlesøk på \"biggest stock buybacks\" 29. mars 2020. (del_1)","src":"/posts/stock-buybacks-og-aksjepriser/google-search-stock-buybacks-1.png","style":{"aspectRatio":"735/893"}},"children":[]},{"type":"element","tag":"img","props":{"alt":"Googlesøk på \"biggest stock buybacks\" 29. mars 2020. (del_2)","src":"/posts/stock-buybacks-og-aksjepriser/google-search-stock-buybacks-2.png","style":{"aspectRatio":"701/880"}},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"hvorfor-stock-buybacks"},"children":[{"type":"text","value":"Hvorfor stock buybacks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"På grunn av tilbud og etterspørsel så vil prisen på en aksje stige når noen kjøper store mengder av den. Dvs at et selskap med betydelige mengder cash kan få sin egen aksjepris til å stige ved å kjøpe egne aksjer. Dette gir ingen fortrinn til bedriften, men det gjør de eksisterende eierene av aksjene rikere."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mange av de største selskapene i vår verden er offentlige aksjeselskap med enorme markedsverdier, det vi på engelsk ofte kaller corporations. Grunnleggerne av disse selskapene er døde for lenge siden, og etterkommerne deres er ikke involvert i driften. Selskapene drives daglig av C-gjengen (CEO, CFO, CTO, CMO, ...), og selskapets strategi settes av styret. Siden det ikke er noen grunnlegger eller visjonær person involvert her, så blir hele formålet med selskapet å \"tjene eierenes interesser\", som vil si å tjene penger."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"C-gjengen har krevende jobber med mye ansvar, så de blir godt kompensert med en høy lønn. Men det som virkelig kan gjøre dem rike eller ikke lønninga, men "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"stock options"}]},{"type":"text","value":" eller \"aksjemuligheter\". En stock option er et derivat av en aksje. Det høres komplisert ut, men det er bare en mulighet til å kjøpe en aksje til en fast pris i fremtiden. For selskapets daglige ledelse virker det som følger:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mr Smith blir ansatt som CEO i Boeing når Boeings aksje koster 100 dollar. Selv om Mr Smith har grad fra Harvard, har ledet andre selskaper med suksess tidligere, og er knallgod på jobbintervjuer, så kan ikke styret helt sikkert vite om de ansatte riktig person. \"Vil Mr Smith drive selskapet godt, og hvordan kan vi måle det?\", tenker de.\nDe finner ut at dersom aksjeprisen øker mens Mr Smith er daglig leder, så betyr det at han er en god leder. Mr Smith lover at hans geniale ledelse vil øke aksjeprisen, men løfter betyr ikke mye, så de finner ut at de vil gi Mr Smith soleklare insentiver til å øke aksjeprisen. De gir ham stock options i Boeing. Han får retten til å kjøpe aksjer nåværende pris, 100 dollar, etter han har ledet selskapet i 5 år.\nDa skjønner Mr Smith at økning i aksjeprisen vil gå rett i hans lomme, så han styrer med aksjeprisen som kompass.\nNår Mr Smith et par år senere sitter med CFO-en, Mrs Johnson, og diskuterer hva de skal gjøre med overskuddet, så vet begge at å kjøpe tilbake egne aksjer vil gjøre dem begge rike. Da blir det fort sånn at de velger bort å investere i nye maskiner eller å videreutdanne sine ansatte, og heller kjøper egne aksjer.\nDe som allerede eier aksjer, og de som eier stock options vinner. Alle andre taper. Må ikke selskapet etterhvert høste det de sår? Jo, men da er Mr Smith og Mrs Johnson gått av for lenge siden, og uansett vil jo myndighetene redde dem i en krise."}]},{"type":"element","tag":"h2","props":{"id":"lave-renter-og-stock-buybacks"},"children":[{"type":"text","value":"Lave renter og stock buybacks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hadde selskaper kun brukt eget overskudd på å kjøpe tilbake aksjer, hadde problemet vært begrenset. Problemet blir større når selskaper kan ta lån og så bruke de lånte pengene på å drive med stock buybacks.\nLave renter oppfordrer bedrifter til å ta lån for å investere i bedriften og slik gjøre økonomien bedre. Lave renter betyr at man kan få masse penger idag, og betale tilbake bare litt mer i fremtiden. Hvis man tror man kan bruke de lånte pengene på å tjene mer penger, er det da nesten idiotisk å ikke ta lån. For C-gjengen og de med stock options er det nesten idiotisk å ikke ta lån og bruke de lånte pengene på stock buybacks, da det er en steinenkel måte å øke aksjeprisen på uten å gjøre det vanskelige arbeidet med å øke overskuddet eller få større markedsandel."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vi har som kjent helt siden finanskrisen hatt historisk lave renter over en lang periode. Det har blant annet ført til høye boligpriser i Norge og høye aksjepriser globalt."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"hva-er-stock-buybacks","depth":2,"text":"Hva er stock buybacks"},{"id":"hvorfor-stock-buybacks","depth":2,"text":"Hvorfor stock buybacks"},{"id":"lave-renter-og-stock-buybacks","depth":2,"text":"Lave renter og stock buybacks"}]}},"_type":"markdown","_id":"content:posts:stock-buybacks-og-aksjepriser:index.md","_source":"content","_file":"posts/stock-buybacks-og-aksjepriser/index.md","_extension":"md","sitemap":{"loc":"/posts/stock-buybacks-og-aksjepriser","images":[]}},{"_path":"/posts/kolonial-norges-amazon","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Norges Amazon er satt på vent, men kan Kolonial gripe muligheten?","description":"2018 begynte med noen spennende nyheter for ehandel i Norge. Både Finn og Komplett kunngjorde at de skulle lansere tjenester for å bli \"Norges Amazon\", ved å tillate andre nettbutikker å selge varer gjennom deres plattform. Dette er en modell som kan være innmari lønnsom – noe Amazon, Alibaba, Lazada, Shopee, Etsy, og andre vitner til. Men det er tydeligvis ikke så lett å få til, hvertfall ikke i et marked som Norge, for både Komplett og Finn ga opp sine ambisiøse satsinger veldig fort.","date":"2020-02-12","language":"Norwegian","tags":"kolonial, aggregator, platform, amazon","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2018 begynte med noen spennende nyheter for ehandel i Norge. Både Finn og Komplett kunngjorde at de skulle lansere tjenester for å bli \"Norges Amazon\", ved å tillate andre nettbutikker å selge varer gjennom deres plattform. Dette er en modell som kan være innmari lønnsom – noe Amazon, Alibaba, Lazada, Shopee, Etsy, og andre vitner til. Men det er tydeligvis ikke så lett å få til, hvertfall ikke i et marked som Norge, for både Komplett og Finn ga opp sine ambisiøse satsinger veldig fort."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Det kan være synd for den norske forbrukeren, da vi nå er et av de få landene i verden uten en skikkelig online shoppingplattform. Det har vært snakk om at Amazon vil komme til Norge, kanskje med en felles skandinavisk ordning, men det er så vidt jeg vet ingenting som tyder på at det vil skje snart."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Søkemotorresultater som viser at Finn og Komplett startet et shoppingtjeneste i 2018 som de fort la ned igjen.","src":"/posts/kolonial-norges-amazon/norges_amazon.png","style":{"aspectRatio":"640/640"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For de som ønsker å selge på nettet i Norge betyr det at den eneste løsningen fortsatt er å starte egen nettbutikk og markedsføre den selv, eller evt. bruke torget på Finn.no til å trekke til seg kunder. Det er klart at en slik situasjon vil føre til verre utvalg, høyere priser, og færre nye bedrifter, da det er mer friksjon i å starte egen nettbutikk å markedsføre denne enn ved å kun lage annonser på Amazon e.l. slik mange som driver med netthandel i andre land gjør. Finn gir så vidt jeg vet ingen mulighet for automasjon eller integrasjon med andre plattformer, så det er ikke på langt nær like knirkefritt som f. eks. "},{"type":"element","tag":"a","props":{"href":"https://services.amazon.com/fulfillment-by-amazon/benefits.html","rel":["nofollow"]},"children":[{"type":"text","value":"Amazon FBA"}]},{"type":"text","value":" er."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://kolonial.no","rel":["nofollow"]},"children":[{"type":"text","value":"Kolonial.no"}]},{"type":"text","value":" er den nye internettkjempen for forbrukermarkedet i Norge. De driver for tiden med dagligvarer og går i kraftig underskudd, og det er kanskje å forvente når de velger å gå inn i en beryktet bransje dominert av et par-tre giganter. Matvarer er kanskje den typen varer som er minst passende for netthandel, men Kolonial har klart å bygge et flott distribusjonsnettverk som stort sett består av egne og innleide sjåfører med varebiler som kjører varer til hjem og bedrifter på Østlandet."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"De har egentlig klart å lage et budselskap som også har en nettside for dagligvarer. Bud og transport er en hårete bransje, men de har bygd et imponerende distribusjonsnettverk, som muligens kan være lønnsomt i fremtiden hvis de kan gi bedre priser og service enn konkurrenter som Posten og Postnord."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En spennende utvikling som begynte i 2019 er deres samarbeid med Clas Ohlson som gjør det mulig å bruke Kolonials budbilsnettverk til å også bestille varer fra gubbebarnehagens utvalg. Kolonial integrerer sitt distribusjonsnettverk med Clas Ohlsons vareutvalg ved å ha noen produkter på lager og på nettsiden sin. Så enkelt kan kunder bestille en rekke nye varer og få dem levert hjem på døren på et par dager – ikke ulikt slik det er i USA med Amazon Prime eller i Kina med Taobao og JD. Om dette er starten på Norges egen Amazon gjenstår å se. Det kan tenkes at de også vil åpne for alle andre å selge sine varer gjennom Kolonial, men jeg er egentlig skeptisk, da Kolonials forretningsmodell foreløpig ikke er bærekraftig, og at utfordringen i å starte en plattform som Amazon er større enn selv Kolonial kan håndtere."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Amazon begynte som kjent med å selge bøker, da dette var en ideell vare for netthandel. De har vokst til å bli et av verdens største selskaper mens de stort sett har brukt den nasjonale posttjenesten eller andre transportselskaper til å faktisk sende varene deres. Først nå i det siste har de begynt med eget transportnettverk. Også kun i det siste har de begynt å selge matvarer i USA, og det er slett ikke sikkert om det vil lykkes med det. De har også hele tiden vært kjente for å ha god kundeservice og ikke minst være åpne for at andre kan integrere seg med deres plattform både som selger eller affiliate."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Kolonial ser ut til å starte i andre enden ved å begynne rett på matvarer og eget transportnettverk. Det ser ut til å gi lite mening, for det er ikke særlig skalerbart, og som følge taper de penger til tross for høy omsetning og mange kunder. Kanskje er det mulighet for at de kan bruke kundemassen og transportnettverket til å selge mer lønnsomme varer. Kanskje de kan få mer investorpenger til å renne inn hvis de prøver å bli en plattform og tar opp utfordringen Finn og Komplett mislyktes med."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Skjermbilde som viser at Finn Shopping hadde svært dårlig vareutvalg.","src":"/posts/kolonial-norges-amazon/Screen_Shot_2019-11-23_at_23.42.11.png","style":{"aspectRatio":"750/1334"}},"children":[]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:kolonial-norges-amazon:index.md","_source":"content","_file":"posts/kolonial-norges-amazon/index.md","_extension":"md","sitemap":{"loc":"/posts/kolonial-norges-amazon","images":[]}},{"_path":"/posts/kan-jeg-bestille-varer-til-under-350-kroner","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Kan jeg bestille varer til under 350 kroner?","description":"OPPDATERING 7. MARS 2020\nNettavisen melder at alt vil være som før, SELV ETTER 1. april. Dvs. du kan fortsatt bestille til under 350kr uten å få et sjokkgebyr. Unntaket er næringsmidler, eller mat, som har måttet fortolles siden 1. januar 2020.","date":"2020-01-14T13:41:53.000Z","language":"norwegian","draft":false,"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"OPPDATERING 7. MARS 2020\n"},{"type":"element","tag":"a","props":{"href":"https://www.nettavisen.no/okonomi/norske-nettkunder-slipper-moms-tross-stortingets-vedtak---dette-er-uholdbart/3423931813.html","rel":["nofollow"]},"children":[{"type":"text","value":"Nettavisen"}]},{"type":"text","value":" melder at alt vil være som før, SELV ETTER 1. april. Dvs. du kan fortsatt bestille til under 350kr uten å få et sjokkgebyr. Unntaket er "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"næringsmidler"}]},{"type":"text","value":", eller mat, som har måttet fortolles siden 1. januar 2020."}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Alle har sikkert hørt noe om at grensen for momsfri netthandel på 350 kroner vil forsvinne i 2020. Det er litt forvirrende akkurat hva som vil skje, fordi utrullingen er litt merkelig, og systemet for import har vært litt forvirrende så lenge noen kan huske."}]},{"type":"element","tag":"h2","props":{"id":"kun-næringsmidler-og-mat-må-fortolles-fra-1-januar"},"children":[{"type":"text","value":"Kun næringsmidler og mat må fortolles fra 1. januar"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Tolletaten definerer næringsmidler som alt mennesker spiser. Dvs. godteri, spekepølse, stevia, honning, sjokolade, proteinpulver, osv. Det er nå for sent å bestille dette uten å måtte betale en skyhøy fortollingsavgift."}]},{"type":"element","tag":"h2","props":{"id":"alt-annet-må-fortolles-fra-1-april"},"children":[{"type":"text","value":"Alt annet må fortolles fra 1. april"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Det er ingen spøk å handle på nett lenger når alt skal fortolles uansett pris. Det blir spennende å se hvordan dette virker når det implementeres. Regjeringen forventer at alle nettbutikker som selger til Norge skal ha et system der prisen for varene automatisk inluderer mva. akkurat slik det er i fysiske butikker i Norge idag. Det er ikke noe vanlige kunder skal trenge å tenke på, men det gjelder å være forsiktig å bestille noe hvis ikke nettbutikken tydelig sier ifra at de bruker den såkalte \"VOEC-ordningen\"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dette betyr at vi allerede er inne i en overgangsperiode der det kommer til å være en del smerte både for forbrukere og nettbutikker. Husk at netthandel er relativt nytt, og at man aldri kommer unna at staten skal ha en del av pengene du bruker og tjener. Om noen år vil jeg tippe vi tenker over det det moms og toll på netthandel like mye som vi tenker over moms og toll på varer i fysiske butikker – altså ingenting."}]},{"type":"element","tag":"h2","props":{"id":"få-handelen-unnagjort-nå"},"children":[{"type":"text","value":"Få handelen unnagjort nå"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Det vil nok absolutt lønne seg å få unnagjort all handel av ting som koster mindre enn 350 så fort som mulig. Dersom pakken i posten krysser Norges grense etter 1. april kan du risikere å måtte betale en ganske sur fortollingsavgift."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vi får håpe at store butikker som Wish, Ebay, og AliExpress innfører \"VOEC\" for kunder i Norge så fort som mulig, slik at vi slipper å bekymre oss så mye."}]},{"type":"element","tag":"h2","props":{"id":"norske-nettbutikker-vil-være-akkurat-som-før"},"children":[{"type":"text","value":"Norske nettbutikker vil være akkurat som før"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Selv når 1. april nærmer seg kan du med ro handle fra norske nettbutikker. Husk bare at selv om siden er på norsk, kan butikken være utenlandsk. Husk derfor å se om de sier noe om fortolling eller forsikre deg om at lageret er i Norge."}]},{"type":"element","tag":"h2","props":{"id":"start-din-egen-nettbutikk"},"children":[{"type":"text","value":"Start din egen nettbutikk"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Jeg vil tro at dette er en gyllen mulighet for nordmenn å starte sin egen lille nettbutikk. Norske butikker har måttet konkurrere på ganske lik linje med utenlandske nettbutikker, men vil nå få en fordel, da det er enklere for nordmenn å forstå alle de nye reglene. Husk at du ikke nødvendigvis trenger en nettside og sånt for å selge på nettet, da det også er mulig å kun bruke Facebook, Finn, Tise o.l."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"kun-næringsmidler-og-mat-må-fortolles-fra-1-januar","depth":2,"text":"Kun næringsmidler og mat må fortolles fra 1. januar"},{"id":"alt-annet-må-fortolles-fra-1-april","depth":2,"text":"Alt annet må fortolles fra 1. april"},{"id":"få-handelen-unnagjort-nå","depth":2,"text":"Få handelen unnagjort nå"},{"id":"norske-nettbutikker-vil-være-akkurat-som-før","depth":2,"text":"Norske nettbutikker vil være akkurat som før"},{"id":"start-din-egen-nettbutikk","depth":2,"text":"Start din egen nettbutikk"}]}},"_type":"markdown","_id":"content:posts:kan-jeg-bestille-varer-til-under-350-kroner.md","_source":"content","_file":"posts/kan-jeg-bestille-varer-til-under-350-kroner.md","_extension":"md","sitemap":{"loc":"/posts/kan-jeg-bestille-varer-til-under-350-kroner","images":[]}},{"_path":"/posts/scrapy-fargate-sls-guide","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Serverless Scraping with Scrapy, AWS Lambda and Fargate – a guide","description":"","date":"2019-09-07T01:25:06.000Z","language":"english","draft":false,"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"running-scrapy-in-aws-lambda"},"children":[{"type":"text","value":"Running Scrapy in AWS Lambda"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will be using the "},{"type":"element","tag":"a","props":{"href":"https://serverless.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Serverless framework"}]},{"type":"text","value":" in this tutorial, as it's a good and extendable open-source framework that does much of the gruntwork of serverless applications. "},{"type":"element","tag":"a","props":{"href":"https://scrapy.org/","rel":["nofollow"]},"children":[{"type":"text","value":"Scrapy"}]},{"type":"text","value":" is a Python framework, also leading and open-source, with all the benefits that come from using a mature framework. Since only "},{"type":"element","tag":"a","props":{"href":"https://aws.amazon.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Amazon Web Services"}]},{"type":"text","value":" (AWS) of the major cloud platforms support Python in serverless functions, it's a natural choice that can't go wrong since AWS has solutions for just about everything."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The code used in this guide can be found on "},{"type":"element","tag":"a","props":{"href":"https://github.com/viktorfa/scrapy-fargate-sls-guide","rel":["nofollow"]},"children":[{"type":"text","value":"github.com/viktorfa/scrapy-fargate-sls-guide"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"requirements"},"children":[{"type":"text","value":"Requirements"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's assumed that the reader is somewhat familiar with Scrapy and has the ability to work with the command line. Several programs need to be installed to complete this guide. An AWS account with billing enabled is necessary (although the resulting bill from completing the guide is in order of single digit cents)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Command line tools used:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"virtualenv*"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"git*"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pip"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"aws"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"* recommended, but not necessary"}]},{"type":"element","tag":"h3","props":{"id":"result"},"children":[{"type":"text","value":"Result"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Completing this guide will result with the basics of a scalable and maintainable scraper infrastructure following the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"serverless"}]},{"type":"text","value":" paradigm with all its advantages such as low initial cost and infrastructure as code deployment. The resulting artifact will be extended in a similar fashion with a data processing pipeline in future guides."}]},{"type":"element","tag":"h2","props":{"id":"setting-up-a-crawler"},"children":[{"type":"text","value":"Setting up a crawler"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We start by making a simple Scrapy crawler that can run from a script locally, and move thinfs gradually from there."}]},{"type":"element","tag":"h3","props":{"id":"creating-the-scraper"},"children":[{"type":"text","value":"Creating the scraper"}]},{"type":"element","tag":"pre","props":{"code":"python -v # Should have python3.7\npip install Scrapy\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"python"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -v"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":" # Should have python3.7\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"pip"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" Scrapy\n"}]}]}]}]},{"type":"element","tag":"pre","props":{"code":"mkdir scrapy-serverless && cd $_\nscrapy startproject my_sls_scraper scraper\ncd scraper\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"mkdir"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" scrapy-serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" && "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" $_\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"scrapy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" startproject"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" my_sls_scraper"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" scraper\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" scraper\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All the code of this guide will be in the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"scrapy-serverless/scraper"}]},{"type":"text","value":" folder, but other modules will be added in the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"scrapy-serverless"}]},{"type":"text","value":" folder in future guides."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will use the default Scrapy project structure. Create a simple spider in the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"spiders"}]},{"type":"text","value":" module."}]},{"type":"element","tag":"pre","props":{"code":"# my_sls_scraper/spiders/header_spider.py\nfrom scrapy.spiders import CrawlSpider, Rule\nfrom scrapy.linkextractors import LinkExtractor\n\n\nclass HeaderSpider(CrawlSpider):\n    name = \"header_spider\"\n\n    start_urls = [\"https://scrapy.org\"]\n    allowed_domains = [\"scrapy.org\"]\n    rules = [  # Get all links on start url\n        Rule(\n            link_extractor=LinkExtractor(\n                deny=r\"\\?\",\n            ),\n            follow=False,\n            callback=\"parse_page\",\n        )\n    ]\n\n    def parse_start_url(self, response):\n        return self.parse_page(response)\n\n    def parse_page(self, response):\n        header = response.css(\"h1, h2\").extract_first(\n        ) or response.css(\"title\").extract_first() or response.url\n        return {\n            \"header\": remove_tags(header),\n            \"url\": response.url,\n        }\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# my_sls_scraper/spiders/header_spider.py\nfrom scrapy.spiders import CrawlSpider, Rule\nfrom scrapy.linkextractors import LinkExtractor\n\n\nclass HeaderSpider(CrawlSpider):\n    name = \"header_spider\"\n\n    start_urls = [\"https://scrapy.org\"]\n    allowed_domains = [\"scrapy.org\"]\n    rules = [  # Get all links on start url\n        Rule(\n            link_extractor=LinkExtractor(\n                deny=r\"\\?\",\n            ),\n            follow=False,\n            callback=\"parse_page\",\n        )\n    ]\n\n    def parse_start_url(self, response):\n        return self.parse_page(response)\n\n    def parse_page(self, response):\n        header = response.css(\"h1, h2\").extract_first(\n        ) or response.css(\"title\").extract_first() or response.url\n        return {\n            \"header\": remove_tags(header),\n            \"url\": response.url,\n        }\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Also add the following to the settings in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"my_sls_scraper/settings.py"}]}]},{"type":"element","tag":"pre","props":{"code":"# my_sls_scraper/settings.py\n# ...\nHTTPCACHE_ENABLED = True\nHTTPCACHE_EXPIRATION_SECS = 60 * 60 * 24 * 7\nHTTPCACHE_DIR = 'httpcache'\nCLOSESPIDER_PAGECOUNT = 32\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# my_sls_scraper/settings.py\n# ...\nHTTPCACHE_ENABLED = True\nHTTPCACHE_EXPIRATION_SECS = 60 * 60 * 24 * 7\nHTTPCACHE_DIR = 'httpcache'\nCLOSESPIDER_PAGECOUNT = 32\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Test that the spider is working by running the crawler and printing the output"}]},{"type":"element","tag":"pre","props":{"code":"scrapy crawl header_spider --output \"feed/%(name)s-%(time)s.json\" --output-format json\ncat feed/$(ls feed -q | tail -1)\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"scrapy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" crawl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" header_spider"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --output"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"feed/%(name)s-%(time)s.json\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --output-format"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" json\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"cat"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" feed/$("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"ls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" feed "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"-q"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" |"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":" tail"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":")\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You should see a json feed in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"feed/header_spider-<time string>.json"}]},{"type":"text","value":" with the scraped data."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next, we create files to launch the scraper from a script, which will be needed in Lambda and Fargate. We'll create 2 new files to make this work in different scenarios, "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"launcher.py"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"my_sls_scraper/crawl.py"}]},{"type":"text","value":"."}]},{"type":"element","tag":"pre","props":{"code":"# my_sls_scraper/crawl.py\nimport sys\nimport imp\nimport os\nimport logging\nfrom urllib.parse import urlparse\n\nfrom scrapy.spiderloader import SpiderLoader\nfrom scrapy.crawler import CrawlerProcess\nfrom scrapy.utils.project import get_project_settings\n\n# Need to \"mock\" sqlite for the process to not crash in AWS Lambda / Amazon Linux\nsys.modules[\"sqlite\"] = imp.new_module(\"sqlite\")\nsys.modules[\"sqlite3.dbapi2\"] = imp.new_module(\"sqlite.dbapi2\")\n\n\ndef is_in_aws():\n    return os.getenv('AWS_EXECUTION_ENV') is not None\n\n\ndef crawl(settings={}, spider_name=\"header_spider\", spider_kwargs={}):\n    project_settings = get_project_settings()\n    spider_loader = SpiderLoader(project_settings)\n\n    spider_cls = spider_loader.load(spider_name)\n\n    feed_uri = \"\"\n    feed_format = \"json\"\n\n    try:\n        spider_key = urlparse(spider_kwargs.get(\"start_urls\")[0]).hostname if spider_kwargs.get(\n            \"start_urls\") else urlparse(spider_cls.start_urls[0]).hostname\n    except Exception:\n        logging.exception(\"Spider or kwargs need start_urls.\")\n\n    if is_in_aws():\n        # Lambda can only write to the /tmp folder.\n        settings['HTTPCACHE_DIR'] =  \"/tmp\"\n    else:\n        feed_uri = \"file://{}/%(name)s-{}-%(time)s.json\".format(\n            os.path.join(os.getcwd(), \"feed\"),\n            spider_key,\n        )\n\n    settings['FEED_URI'] = feed_uri\n    settings['FEED_FORMAT'] = feed_format\n\n    process = CrawlerProcess({**project_settings, **settings})\n\n    process.crawl(spider_cls, **spider_kwargs)\n    process.start()\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# my_sls_scraper/crawl.py\nimport sys\nimport imp\nimport os\nimport logging\nfrom urllib.parse import urlparse\n\nfrom scrapy.spiderloader import SpiderLoader\nfrom scrapy.crawler import CrawlerProcess\nfrom scrapy.utils.project import get_project_settings\n\n# Need to \"mock\" sqlite for the process to not crash in AWS Lambda / Amazon Linux\nsys.modules[\"sqlite\"] = imp.new_module(\"sqlite\")\nsys.modules[\"sqlite3.dbapi2\"] = imp.new_module(\"sqlite.dbapi2\")\n\n\ndef is_in_aws():\n    return os.getenv('AWS_EXECUTION_ENV') is not None\n\n\ndef crawl(settings={}, spider_name=\"header_spider\", spider_kwargs={}):\n    project_settings = get_project_settings()\n    spider_loader = SpiderLoader(project_settings)\n\n    spider_cls = spider_loader.load(spider_name)\n\n    feed_uri = \"\"\n    feed_format = \"json\"\n\n    try:\n        spider_key = urlparse(spider_kwargs.get(\"start_urls\")[0]).hostname if spider_kwargs.get(\n            \"start_urls\") else urlparse(spider_cls.start_urls[0]).hostname\n    except Exception:\n        logging.exception(\"Spider or kwargs need start_urls.\")\n\n    if is_in_aws():\n        # Lambda can only write to the /tmp folder.\n        settings['HTTPCACHE_DIR'] =  \"/tmp\"\n    else:\n        feed_uri = \"file://{}/%(name)s-{}-%(time)s.json\".format(\n            os.path.join(os.getcwd(), \"feed\"),\n            spider_key,\n        )\n\n    settings['FEED_URI'] = feed_uri\n    settings['FEED_FORMAT'] = feed_format\n\n    process = CrawlerProcess({**project_settings, **settings})\n\n    process.crawl(spider_cls, **spider_kwargs)\n    process.start()\n"}]}]},{"type":"element","tag":"pre","props":{"code":"# launcher.py'\nimport sys\nimport json\n\nfrom my_sls_scraper.crawl import crawl\n\n\ndef scrape(event={}, context={}):\n    crawl(**event)\n\n\nif __name__ == \"__main__\":\n    try:\n        event = json.loads(sys.argv[1])\n    except IndexError:\n        event = {}\n    scrape(event)\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# launcher.py'\nimport sys\nimport json\n\nfrom my_sls_scraper.crawl import crawl\n\n\ndef scrape(event={}, context={}):\n    crawl(**event)\n\n\nif __name__ == \"__main__\":\n    try:\n        event = json.loads(sys.argv[1])\n    except IndexError:\n        event = {}\n    scrape(event)\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Check that you can scrape by executing "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"launcher.py"}]},{"type":"text","value":" with"}]},{"type":"element","tag":"pre","props":{"code":"python launcher.py\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"python"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" launcher.py\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If that works, the scraper is pretty much done, and we'll spend the rest of the guide on AWS and Serverless stuff."}]},{"type":"element","tag":"h2","props":{"id":"setting-up-an-aws-lambda-function"},"children":[{"type":"text","value":"Setting up an AWS Lambda function"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Initialize serverless in the same directory as "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"scrapy.cfg"}]},{"type":"text","value":" with"}]},{"type":"element","tag":"pre","props":{"code":"serverless create --template aws-python3 --name my-sls-scraper\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"serverless"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" aws-python3"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" my-sls-scraper\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You need to have an AWS account and created an IAM admin user to work with Serverless. If you haven't follow the steps on "},{"type":"element","tag":"a","props":{"href":"https://serverless.com/framework/docs/providers/aws/guide/credentials/","rel":["nofollow"]},"children":[{"type":"text","value":"this guide"}]},{"type":"text","value":" to get started. I like using aws profiles where you store the credentials in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"~/.aws/credentials"}]},{"type":"text","value":", but see the link for what works best for you."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you're not familiar with AWS and Serverless, you will run into many weird issues that are hard to debug. To mitigate that, deploy the function for every change you make in the configuration of Serverless and the scraper to make it easier to identify what causes things to break."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We'll start by deploying the dummy default Lambda function. Do it with"}]},{"type":"element","tag":"pre","props":{"code":"sls deploy -f hello\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" hello\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you use aws profiles for credentials and you have a profile called "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"my-sls-admin"}]},{"type":"text","value":", you can deploy with"}]},{"type":"element","tag":"pre","props":{"code":"sls deploy -f hello --aws-profile my-sls-admin\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" hello"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --aws-profile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" my-sls-admin\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or add the profile key under provider in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":"."}]},{"type":"element","tag":"pre","props":{"code":"# serverless.yml\n# ...\nprovider:\n  name: aws\nruntime: python3.7\nprofile: my-sls-admin\n# ...\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"provider"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"aws\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"runtime"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"python3.7\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"profile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"my-sls-admin\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# ...\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When deploying, the output should be similar to"}]},{"type":"element","tag":"pre","props":{"code":"11:40 $ sls deploy\nServerless: Packaging service...\nServerless: Excluding development dependencies...\nServerless: Creating Stack...\nServerless: Checking Stack create progress...\n.....\nServerless: Stack create finished...\nServerless: Uploading CloudFormation file to S3...\nServerless: Uploading artifacts...\nServerless: Uploading service my-sls-scraper.zip file to S3 (162.74 KB)...\nServerless: Validating template...\nServerless: Updating Stack...\nServerless: Checking Stack update progress...\n...............\nServerless: Stack update finished...\nService Information\nservice: my-sls-scraper\nstage: dev\nregion: us-east-1\nstack: my-sls-scraper-dev\nresources: 5\napi keys:\n  None\nendpoints:\n  None\nfunctions:\n  hello: my-sls-scraper-dev-hello\nlayers:\n  None\nServerless: Run the \"serverless\" command to setup monitoring, troubleshooting and testing.\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"11:40 $ sls deploy\nServerless: Packaging service...\nServerless: Excluding development dependencies...\nServerless: Creating Stack...\nServerless: Checking Stack create progress...\n.....\nServerless: Stack create finished...\nServerless: Uploading CloudFormation file to S3...\nServerless: Uploading artifacts...\nServerless: Uploading service my-sls-scraper.zip file to S3 (162.74 KB)...\nServerless: Validating template...\nServerless: Updating Stack...\nServerless: Checking Stack update progress...\n...............\nServerless: Stack update finished...\nService Information\nservice: my-sls-scraper\nstage: dev\nregion: us-east-1\nstack: my-sls-scraper-dev\nresources: 5\napi keys:\n  None\nendpoints:\n  None\nfunctions:\n  hello: my-sls-scraper-dev-hello\nlayers:\n  None\nServerless: Run the \"serverless\" command to setup monitoring, troubleshooting and testing.\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You should now see the deployed function in the "},{"type":"element","tag":"a","props":{"href":"https://console.aws.amazon.com/lambda/home","rel":["nofollow"]},"children":[{"type":"text","value":"AWS Lambda web console"}]},{"type":"text","value":". (Change your region if you don't see it!)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Verify that the function can be invoked and see its output with"}]},{"type":"element","tag":"pre","props":{"code":"sls invoke -f hello --log\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" invoke"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" hello"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --log\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The output should be something like"}]},{"type":"element","tag":"pre","props":{"code":"12:12 $ sls invoke -f hello --log\n{\n    \"statusCode\": 200,\n    \"body\": \"{\\\"message\\\": \\\"Go Serverless v1.0! Your function executed successfully!\\\", \\\"input\\\": {}}\"\n}\n--------------------------------------------------------------------\nSTART RequestId: f38a0d84-e974-4a00-93ab-9e2825d94003 Version: $LATEST\nEND RequestId: f38a0d84-e974-4a00-93ab-9e2825d94003\nREPORT RequestId: f38a0d84-e974-4a00-93ab-9e2825d94003  Duration: 1.62 ms   Billed Duration: 100 ms Memory Size: 1024 MB    Max Memory Used: 56 MB  Init Duration: 110.34 ms\n\nXRAY TraceId: 1-5d723275-c57192d30e2a524902b401fd   SegmentId: 5cc7e2685a1e85bc Sampled: false\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"12:12 $ sls invoke -f hello --log\n{\n    \"statusCode\": 200,\n    \"body\": \"{\\\"message\\\": \\\"Go Serverless v1.0! Your function executed successfully!\\\", \\\"input\\\": {}}\"\n}\n--------------------------------------------------------------------\nSTART RequestId: f38a0d84-e974-4a00-93ab-9e2825d94003 Version: $LATEST\nEND RequestId: f38a0d84-e974-4a00-93ab-9e2825d94003\nREPORT RequestId: f38a0d84-e974-4a00-93ab-9e2825d94003  Duration: 1.62 ms   Billed Duration: 100 ms Memory Size: 1024 MB    Max Memory Used: 56 MB  Init Duration: 110.34 ms\n\nXRAY TraceId: 1-5d723275-c57192d30e2a524902b401fd   SegmentId: 5cc7e2685a1e85bc Sampled: false\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we'll need to package the function in a way that includes all the dependencies. Install the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless-python-requirements"}]},{"type":"text","value":" plugin with"}]},{"type":"element","tag":"pre","props":{"code":"sls plugin install --name serverless-python-requirements\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" plugin"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless-python-requirements\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And rehaul "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":"."}]},{"type":"element","tag":"pre","props":{"code":"# serverless.yml\nservice: my-sls-scraper\n\nprovider:\n  name: aws\n  runtime: python3.7\n  logRetentionInDays: 1\n\nfunctions:\n  hello:\n    handler: handler.hello\n  lambdaScrape:\n    handler: launcher.scrape\n\n# We include files by whitelisting to reduce the deployment time.\n# Just remember to add any files you create!\npackage:\n  include:\n    - handler.py\n    - launcher.py\n    - my_sls_scraper/**\n    - scrapy.cfg\n  exclude:\n    - \"./**\"\n\nplugins:\n  - serverless-python-requirements\n\ncustom:\n  pythonRequirements:\n    slim: true # Omits tests, __pycache__, *.pyc etc from dependencies\n    fileName: requirements.txt\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"service"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"my-sls-scraper\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"provider"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"aws\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  runtime"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"python3.7\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  logRetentionInDays"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"functions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  hello"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"handler.hello\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  lambdaScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"launcher.scrape\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# We include files by whitelisting to reduce the deployment time.\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# Just remember to add any files you create!\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"package"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  include"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"handler.py\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"launcher.py\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"my_sls_scraper/**\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"scrapy.cfg\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  exclude"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"./**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"plugins"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"serverless-python-requirements\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"custom"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  pythonRequirements"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    slim"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":" # Omits tests, __pycache__, *.pyc etc from dependencies\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    fileName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"requirements.txt\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that we added a new function "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"lambdaScrape"}]},{"type":"text","value":" that does the scraping in the Lambda function."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We also need a minimal "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"requirements.txt"}]},{"type":"text","value":" for pip requirements."}]},{"type":"element","tag":"pre","props":{"code":"# requirements.txt\nScrapy==1.7.3\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# requirements.txt\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"Scrapy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1.7"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":".3\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Try to deploy the function again and see that it works."}]},{"type":"element","tag":"pre","props":{"code":"sls deploy --verbose\nsls invoke -f hello --log\nsls invoke -f lambdaScrape --log\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --verbose\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" invoke"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" hello"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --log\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" invoke"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" lambdaScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --log\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We've now created the minimal solution for serverless scraping – well done! In the rest of the guide we'll set up more resources in the AWS platform to store the scraped data and run long crawls in Fargate instead of Lambda."}]},{"type":"element","tag":"h2","props":{"id":"storing-scraped-data-in-s3"},"children":[{"type":"text","value":"Storing scraped data in S3"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Storing the scraped data in S3 gives us a low-cost repository for spider outputs which can be used to further process the data. We will use the config in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" and CloudFormation templates to create and use resources in the AWS ecosystem, so that we follow the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"infrastructure as code"}]},{"type":"text","value":" paradigm."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Before we continue, let's install a useful plugin that lets us use "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"!Sub"}]},{"type":"text","value":" commands in out templates called "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless-cloudformation-sub-variables"}]},{"type":"text","value":" and add it to our "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" with"}]},{"type":"element","tag":"pre","props":{"code":"sls plugin install --name serverless-cloudformation-sub-variables\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" plugin"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" serverless-cloudformation-sub-variables\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's create the templates in a separate file called "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"s3-template.yml"}]},{"type":"text","value":" as the template will get quite large later."}]},{"type":"element","tag":"pre","props":{"code":"# s3-template.yml\nResources:\n  ScraperFeedBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      VersioningConfiguration:\n        Status: \"Enabled\"\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# s3-template.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Resources"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  ScraperFeedBucket"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"AWS::S3::Bucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      VersioningConfiguration"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Status"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Enabled\"\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We have to set up permissions in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":", import the template file, and pass the bucket name in an environment variable to our Lambda function.\nAdd the following IAM role statement and environment variable"}]},{"type":"element","tag":"pre","props":{"code":"# serverless.yml\nprovider:\n    # ...\n    environment:\n        FEED_BUCKET_NAME: !Ref ScraperFeedBucket\n    iamRoleStatements:\n        - Effect: \"Allow\"\n          Action:\n            - \"s3:PutObject\"\n          Resource: !Sub\n            - \"arn:aws:s3:::#{BucketName}/*\"\n            - BucketName: !Ref ScraperFeedBucket\n\nresources:\n  - AWSTemplateFormatVersion: \"2010-09-09\"\n    Transform: \"AWS::Serverless-2016-10-31\"\n  - ${file(./s3-template.yml)}\n# ...\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"provider"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    # ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    environment"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        FEED_BUCKET_NAME"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" ScraperFeedBucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    iamRoleStatements"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Allow\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"s3:PutObject\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Resource"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"arn:aws:s3:::#{BucketName}/*\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"BucketName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" ScraperFeedBucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"resources"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"AWSTemplateFormatVersion"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"2010-09-09\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Transform"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::Serverless-2016-10-31\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${file(./s3-template.yml)}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# ...\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can check that your configuration doesn't contain syntax errors with"}]},{"type":"element","tag":"pre","props":{"code":"sls package\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" package\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"but the only way to check that your CloudFormation templates are valid on your current stack is to deploy it.\nBefore deploying, let's configure the crawler to store the output in S3."}]},{"type":"element","tag":"pre","props":{"code":"# my_sls_scraper/crawl.py\ndef  crawl(settings={}, spider_name=\"header_spider\", spider_kwargs={}):\n    # ...\n    if is_in_aws():\n        # Lambda can only write to the /tmp folder.\n        settings['HTTPCACHE_DIR'] = \"/tmp\"\n        feed_uri = f\"s3://{os.getenv('FEED_BUCKET_NAME')}/%(name)s-{spider_key}.json\"\n    # ...\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# my_sls_scraper/crawl.py\ndef  crawl(settings={}, spider_name=\"header_spider\", spider_kwargs={}):\n    # ...\n    if is_in_aws():\n        # Lambda can only write to the /tmp folder.\n        settings['HTTPCACHE_DIR'] = \"/tmp\"\n        feed_uri = f\"s3://{os.getenv('FEED_BUCKET_NAME')}/%(name)s-{spider_key}.json\"\n    # ...\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Scrapy uses the AWS library "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"boto3"}]},{"type":"text","value":" under the hood to store to S3. Inside a Lambda function, boto3 is always available, and credentials are automatically discovered. It will work as long as the IAM Role Statements we configured for the Lambda function are correct.\nWe don't need to timestamp the file name in S3 with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"%(time)s"}]},{"type":"text","value":", as we configured the bucket to use versioning in our CloudFormation template, which enables us to access old spider outputs by looking at the file history."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, deploy the function and crawl again."}]},{"type":"element","tag":"pre","props":{"code":"sls deploy -v\nsls invoke -f lambdaScrape --log\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -v\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" invoke"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" lambdaScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --log\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You should now find the feed output in a file if you check your "},{"type":"element","tag":"a","props":{"href":"https://s3.console.aws.amazon.com/s3/home","rel":["nofollow"]},"children":[{"type":"text","value":"S3 console"}]},{"type":"text","value":". You should also see some new info has appeared for your function in the "},{"type":"element","tag":"a","props":{"href":"https://console.aws.amazon.com/lambda/home","rel":["nofollow"]},"children":[{"type":"text","value":"Lambda console"}]},{"type":"text","value":", like the environment variable and the S3 resource.\nWhile it's absolutely recommended to set up all resources in CloudFormation templates or other infrastructure as code frameworks, the AWS console web interface is very useful for debugging and inspection."}]},{"type":"element","tag":"h2","props":{"id":"running-scrapy-in-aws-fargate"},"children":[{"type":"text","value":"Running Scrapy in AWS Fargate"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We now have a crawler that can be run from a script and uses S3 to store its output. We can run it in AWS Lambda, but we are constrained by the 15 minute execution limit.\nLambda is simply not made for long-lasting tasks, but it is possible to run long-lasting crawlers in the serverless paradigm by "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"containerizing"}]},{"type":"text","value":" our crawler and running it as a task in a managed container service such as AWS Fargate. This means we need to create a "},{"type":"element","tag":"a","props":{"href":"https://www.docker.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Docker"}]},{"type":"text","value":" image of our crawler, uploading the image to an image repository – we'll use Amazon Container Registry (ACR), and execute the image in a container as a task in Amazon Container Services (ECS).\nI'm dropping a lot of acronyms, and you'll see even more later. Running containers on AWS may be serverless, but it requires a lot of configuration at the moment."}]},{"type":"element","tag":"h3","props":{"id":"dockerize-it"},"children":[{"type":"text","value":"Dockerize it"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you have Docker installed, this is the easy part. Let's create a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Dockerfile"}]},{"type":"text","value":" to containerize our crawler."}]},{"type":"element","tag":"pre","props":{"code":"FROM python:3.7\n\nWORKDIR /usr/src/app\n\nCOPY scrapy.cfg ./\nCOPY launcher.py ./\nCOPY my_sls_scraper ./my_sls_scraper\nCOPY requirements.txt ./\n\nRUN pip install boto3 --quiet\nRUN pip install -r requirements.txt --quiet\n\nCMD [\"python3\", \"./launcher.py\"]\n","language":"docker","meta":"","className":"language-docker","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"FROM python:3.7\n\nWORKDIR /usr/src/app\n\nCOPY scrapy.cfg ./\nCOPY launcher.py ./\nCOPY my_sls_scraper ./my_sls_scraper\nCOPY requirements.txt ./\n\nRUN pip install boto3 --quiet\nRUN pip install -r requirements.txt --quiet\n\nCMD [\"python3\", \"./launcher.py\"]\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The docker file is the recipe to put our scraper in an image. Create it and put a tag on it with"}]},{"type":"element","tag":"pre","props":{"code":"docker build -t my_sls_scraper:latest .\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -t"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" my_sls_scraper:latest"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" .\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You should see an output similar to"}]},{"type":"element","tag":"pre","props":{"code":"16:55 $ docker build -t my_sls_scraper:latest .\nSending build context to Docker daemon  15.62MB\nStep 1/9 : FROM python:3.7\n ---> 60e318e4984a\nStep 2/9 : WORKDIR /usr/src/app\n ---> Using cache\n ---> 0277144c85a9\nStep 3/9 : COPY scrapy.cfg ./\n ---> c72f2df3b4d7\nRemoving intermediate container 80cf0e765353\nStep 4/9 : COPY launcher.py ./\n ---> 58e18d409bf5\nRemoving intermediate container f0726603d5fa\nStep 5/9 : COPY my_sls_scraper ./my_sls_scraper\n ---> 2be7fc4a06bb\nRemoving intermediate container aae59bff188d\nStep 6/9 : COPY requirements.txt ./\n ---> 7dbf261f3ade\nRemoving intermediate container 76033ce2ffe6\nStep 7/9 : RUN pip install boto3 --quiet\n ---> Running in 55455a2a4415\n ---> efdc47a54e36\nRemoving intermediate container 55455a2a4415\nStep 8/9 : RUN pip install -r requirements.txt --quiet\n ---> Running in e15817fd1a01\n ---> 84015af5a4ee\nRemoving intermediate container e15817fd1a01\nStep 9/9 : CMD python3 ./launcher.py\n ---> Running in 9c6fe75eb923\n ---> 05a841f9ec00\nRemoving intermediate container 9c6fe75eb923\nSuccessfully built 05a841f9ec00\nSuccessfully tagged my_sls_scraper:latest\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"16:55 $ docker build -t my_sls_scraper:latest .\nSending build context to Docker daemon  15.62MB\nStep 1/9 : FROM python:3.7\n ---> 60e318e4984a\nStep 2/9 : WORKDIR /usr/src/app\n ---> Using cache\n ---> 0277144c85a9\nStep 3/9 : COPY scrapy.cfg ./\n ---> c72f2df3b4d7\nRemoving intermediate container 80cf0e765353\nStep 4/9 : COPY launcher.py ./\n ---> 58e18d409bf5\nRemoving intermediate container f0726603d5fa\nStep 5/9 : COPY my_sls_scraper ./my_sls_scraper\n ---> 2be7fc4a06bb\nRemoving intermediate container aae59bff188d\nStep 6/9 : COPY requirements.txt ./\n ---> 7dbf261f3ade\nRemoving intermediate container 76033ce2ffe6\nStep 7/9 : RUN pip install boto3 --quiet\n ---> Running in 55455a2a4415\n ---> efdc47a54e36\nRemoving intermediate container 55455a2a4415\nStep 8/9 : RUN pip install -r requirements.txt --quiet\n ---> Running in e15817fd1a01\n ---> 84015af5a4ee\nRemoving intermediate container e15817fd1a01\nStep 9/9 : CMD python3 ./launcher.py\n ---> Running in 9c6fe75eb923\n ---> 05a841f9ec00\nRemoving intermediate container 9c6fe75eb923\nSuccessfully built 05a841f9ec00\nSuccessfully tagged my_sls_scraper:latest\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, let's check that the image works by running it in a container on our machine with"}]},{"type":"element","tag":"pre","props":{"code":"docker run my_sls_scraper\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" run"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" my_sls_scraper\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The crawler should run just like it has before except that the crawl output json file will be stored somewhere inside the Docker container, so you cannot see it."}]},{"type":"element","tag":"h3","props":{"id":"configure-fargate-on-aws"},"children":[{"type":"text","value":"Configure Fargate on AWS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's see how a complete CloudFormation template for our purpose looks like."}]},{"type":"element","tag":"pre","props":{"code":"# fargate-template.yml\nResources:\n  FargateECSCluster:\n    Type: \"AWS::ECS::Cluster\"\n    Properties:\n      ClusterName: !Sub\n        - \"fargate-#{StackName}\"\n        - StackName: !Ref \"AWS::StackName\"\n\n  FargateLogGroup:\n    Type: \"AWS::Logs::LogGroup\"\n    Properties:\n      RetentionInDays: 1\n\n  FargateTaskRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: \"2012-10-17\"\n        Statement:\n          - Effect: Allow\n            Sid: \"ECS\"\n            Principal:\n              Service:\n                - ecs-tasks.amazonaws.com\n            Action:\n              - sts:AssumeRole\n      Policies:\n        - PolicyName: ScraperFeedBucketPolicy\n          PolicyDocument:\n            Statement:\n              - Effect: \"Allow\"\n                Action:\n                  - \"s3:PutObject\"\n                Resource: !Sub\n                  - \"arn:aws:s3:::#{BucketName}/*\"\n                  - BucketName: !Ref ScraperFeedBucket\n\n  FargateExecutionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy\n      AssumeRolePolicyDocument:\n        Version: \"2012-10-17\"\n        Statement:\n          - Effect: Allow\n            Sid: \"ECS\"\n            Principal:\n              Service:\n                - ecs-tasks.amazonaws.com\n            Action:\n              - sts:AssumeRole\n\n  FargateVPC:\n    Type: \"AWS::EC2::VPC\"\n    Properties:\n      CidrBlock: 10.10.10.0/24\n      Tags:\n        - Key: Name\n          Value: !Ref \"AWS::StackName\"\n  FargateSubnet:\n    Type: \"AWS::EC2::Subnet\"\n    Properties:\n      CidrBlock: 10.10.10.0/24\n      VpcId: !Ref FargateVPC\n      Tags:\n        - Key: Name\n          Value: !Ref \"AWS::StackName\"\n  FargateIGW:\n    Type: \"AWS::EC2::InternetGateway\"\n    Properties:\n      Tags:\n        - Key: Name\n          Value: !Ref \"AWS::StackName\"\n  FargateAttachGateway:\n    Type: AWS::EC2::VPCGatewayAttachment\n    Properties:\n      VpcId: !Ref FargateVPC\n      InternetGatewayId: !Ref FargateIGW\n  FargateRouteTable:\n    Type: \"AWS::EC2::RouteTable\"\n    Properties:\n      VpcId: !Ref FargateVPC\n      Tags:\n        - Key: Name\n          Value: !Ref \"AWS::StackName\"\n  FargateRoute:\n    Type: \"AWS::EC2::Route\"\n    DependsOn: FargateAttachGateway\n    Properties:\n      RouteTableId: !Ref FargateRouteTable\n      DestinationCidrBlock: 0.0.0.0/0\n      GatewayId: !Ref FargateIGW\n  FargateSubnetRouteTableAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      RouteTableId: !Ref FargateRouteTable\n      SubnetId: !Ref FargateSubnet\n  FargateSG:\n    Type: \"AWS::EC2::SecurityGroup\"\n    Properties:\n      GroupDescription: \"Generated by Serverless\"\n      SecurityGroupIngress:\n        - IpProtocol: -1\n          CidrIp: 127.0.0.1/32\n      Tags:\n        - Key: Name\n          Value: !Ref \"AWS::StackName\"\n      VpcId: !Ref FargateVPC\n\n  FargateECSRepo:\n    Type: \"AWS::ECR::Repository\"\n    Properties:\n      LifecyclePolicy:\n        LifecyclePolicyText: |\n          {\n            \"rules\": [\n            {\n              \"rulePriority\": 1,\n              \"description\": \"Only keep 8 images\",\n              \"selection\": {\n                \"tagStatus\": \"any\",\n                \"countType\": \"imageCountMoreThan\",\n                \"countNumber\": 8\n              },\n              \"action\": { \"type\": \"expire\" }\n            }]\n          }\n\n  FargateECSTaskDefinition:\n    Type: \"AWS::ECS::TaskDefinition\"\n    Properties:\n      Cpu: 512\n      Memory: 1GB\n      NetworkMode: awsvpc\n      RequiresCompatibilities:\n        - \"FARGATE\"\n      ExecutionRoleArn: !GetAtt FargateExecutionRole.Arn\n      TaskRoleArn: !GetAtt FargateTaskRole.Arn\n      ContainerDefinitions:\n        - Name: scraper_container\n          Image: !Sub\n            - \"#{AccountId}.dkr.ecr.#{Region}.amazonaws.com/#{Repo}\"\n            - AccountId: !Ref AWS::AccountId\n              Region: !Ref AWS::Region\n              Repo: !Ref FargateECSRepo\n          LogConfiguration:\n            LogDriver: awslogs\n            Options:\n              awslogs-group: !Ref FargateLogGroup\n              awslogs-region: !Ref AWS::Region\n              awslogs-stream-prefix: !Ref AWS::StackName\nOutputs:\n  ECRRepo:\n    Value: !Sub\n      - \"#{AccountId}.dkr.ecr.#{Region}.amazonaws.com/#{Repo}\"\n      - AccountId: !Ref AWS::AccountId\n        Region: !Ref AWS::Region\n        Repo: !Ref FargateECSRepo\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# fargate-template.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Resources"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateECSCluster"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::ECS::Cluster\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      ClusterName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"fargate-#{StackName}\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"StackName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"AWS::StackName\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateLogGroup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::Logs::LogGroup\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      RetentionInDays"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateTaskRole"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"AWS::IAM::Role\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      AssumeRolePolicyDocument"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Version"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"2012-10-17\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Statement"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"          - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Allow\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            Sid"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"ECS\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            Principal"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"              Service"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"ecs-tasks.amazonaws.com\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"              - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"sts:AssumeRole\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Policies"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"PolicyName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"ScraperFeedBucketPolicy\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          PolicyDocument"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            Statement"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"              - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Allow\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"                Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"s3:PutObject\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"                Resource"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"arn:aws:s3:::#{BucketName}/*\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"BucketName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" ScraperFeedBucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateExecutionRole"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"AWS::IAM::Role\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      ManagedPolicyArns"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      AssumeRolePolicyDocument"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":45},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Version"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"2012-10-17\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":46},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Statement"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":47},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"          - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Allow\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":48},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            Sid"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"ECS\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":49},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            Principal"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":50},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"              Service"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":51},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"ecs-tasks.amazonaws.com\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":52},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":53},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"              - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"sts:AssumeRole\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":54},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":55},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateVPC"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":56},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::EC2::VPC\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":57},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":58},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      CidrBlock"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"10.10.10.0/24\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":59},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Tags"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":60},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Key"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Name\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":61},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"AWS::StackName\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":62},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateSubnet"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":63},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::EC2::Subnet\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":64},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":65},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      CidrBlock"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"10.10.10.0/24\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":66},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      VpcId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateVPC\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":67},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Tags"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":68},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Key"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Name\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":69},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"AWS::StackName\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":70},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateIGW"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":71},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::EC2::InternetGateway\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":72},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":73},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Tags"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":74},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Key"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Name\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":75},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"AWS::StackName\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":76},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateAttachGateway"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":77},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"AWS::EC2::VPCGatewayAttachment\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":78},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":79},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      VpcId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateVPC\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":80},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      InternetGatewayId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateIGW\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":81},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateRouteTable"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":82},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::EC2::RouteTable\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":83},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":84},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      VpcId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateVPC\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":85},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Tags"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":86},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Key"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Name\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":87},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"AWS::StackName\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":88},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateRoute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":89},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::EC2::Route\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":90},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    DependsOn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"FargateAttachGateway\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":91},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":92},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      RouteTableId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateRouteTable\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":93},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      DestinationCidrBlock"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"0.0.0.0/0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":94},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      GatewayId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateIGW\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":95},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateSubnetRouteTableAssociation"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":96},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"AWS::EC2::SubnetRouteTableAssociation\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":97},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":98},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      RouteTableId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateRouteTable\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":99},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      SubnetId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateSubnet\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":100},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateSG"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":101},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::EC2::SecurityGroup\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":102},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":103},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      GroupDescription"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Generated by Serverless\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":104},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      SecurityGroupIngress"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":105},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"IpProtocol"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"-1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":106},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          CidrIp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"127.0.0.1/32\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":107},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Tags"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":108},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Key"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Name\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":109},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"AWS::StackName\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":110},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      VpcId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateVPC\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":111},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":112},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateECSRepo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":113},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::ECR::Repository\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":114},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":115},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      LifecyclePolicy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":116},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        LifecyclePolicyText"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"|\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":117},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"          {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":118},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"            \"rules\": [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":119},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"            {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":120},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"              \"rulePriority\": 1,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":121},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"              \"description\": \"Only keep 8 images\",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":122},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"              \"selection\": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":123},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"                \"tagStatus\": \"any\",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":124},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"                \"countType\": \"imageCountMoreThan\",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":125},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"                \"countNumber\": 8\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":126},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"              },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":127},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"              \"action\": { \"type\": \"expire\" }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":128},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"            }]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":129},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"          }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":130},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":131},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  FargateECSTaskDefinition"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":132},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::ECS::TaskDefinition\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":133},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":134},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Cpu"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"512\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":135},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Memory"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"1GB\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":136},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      NetworkMode"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"awsvpc\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":137},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      RequiresCompatibilities"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":138},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"FARGATE\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":139},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      ExecutionRoleArn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!GetAtt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateExecutionRole.Arn\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":140},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      TaskRoleArn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!GetAtt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateTaskRole.Arn\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":141},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      ContainerDefinitions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":142},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"scraper_container\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":143},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Image"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":144},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"#{AccountId}.dkr.ecr.#{Region}.amazonaws.com/#{Repo}\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":145},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"AccountId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" AWS::AccountId\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":146},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"              Region"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" AWS::Region\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":147},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"              Repo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateECSRepo\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":148},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          LogConfiguration"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":149},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            LogDriver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"awslogs\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":150},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            Options"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":151},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"              awslogs-group"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateLogGroup\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":152},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"              awslogs-region"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" AWS::Region\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":153},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"              awslogs-stream-prefix"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" AWS::StackName\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":154},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Outputs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":155},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  ECRRepo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":156},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":157},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"#{AccountId}.dkr.ecr.#{Region}.amazonaws.com/#{Repo}\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":158},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"AccountId"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" AWS::AccountId\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":159},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Region"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" AWS::Region\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":160},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Repo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateECSRepo\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Credit to "},{"type":"element","tag":"a","props":{"href":"https://github.com/jolexa/fargate-from-lambda","rel":["nofollow"]},"children":[{"type":"text","value":"github.com/jolexa/fargate-from-lambda"}]},{"type":"text","value":" who inspired this CF template."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next, we create a file with a handler to start the Fargate task"}]},{"type":"element","tag":"pre","props":{"code":"# launch_fargate.py\nimport os\nimport json\n\nimport boto3\n\n\ndef launch_fargate(event, context):\n    client = boto3.client(\"ecs\")\n\n    ECSCluster = os.environ[\"ECS_CLUSTER\"]\n    ECSSecGroup = os.environ[\"ECS_SEC_GROUP\"]\n    ECSSubnet = os.environ[\"ECS_SUBNET\"]\n    ECSTaskArn = os.environ[\"ECS_TASK_ARN\"]\n    CONTAINER_NAME = os.environ[\"CONTAINER_NAME\"]\n\n    run_task_response = client.run_task(\n        cluster=ECSCluster,\n        taskDefinition=ECSTaskArn,\n        count=1,\n        launchType=\"FARGATE\",\n        overrides={\n            \"containerOverrides\": [\n                {\n                    \"name\": CONTAINER_NAME,\n                    # We override the command so that we can pass some arguments\n                    # e.g. for running different spiders.\n                    \"command\": [\n                        \"python\",\n                        \"launcher.py\",\n                        json.dumps(event),\n                    ],\n                    \"environment\": [\n                        {\"name\": \"FEED_BUCKET_NAME\", \"value\": os.environ[\"FEED_BUCKET_NAME\"]},\n                    ]\n                }\n            ],\n        },\n        networkConfiguration={\n            \"awsvpcConfiguration\": {\n                \"subnets\": [\n                    ECSSubnet,\n                ],\n                \"securityGroups\": [\n                    ECSSecGroup,\n                ],\n                \"assignPublicIp\": \"ENABLED\"\n            },\n        },\n    )\n    return json.dumps(run_task_response, default=str)\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# launch_fargate.py\nimport os\nimport json\n\nimport boto3\n\n\ndef launch_fargate(event, context):\n    client = boto3.client(\"ecs\")\n\n    ECSCluster = os.environ[\"ECS_CLUSTER\"]\n    ECSSecGroup = os.environ[\"ECS_SEC_GROUP\"]\n    ECSSubnet = os.environ[\"ECS_SUBNET\"]\n    ECSTaskArn = os.environ[\"ECS_TASK_ARN\"]\n    CONTAINER_NAME = os.environ[\"CONTAINER_NAME\"]\n\n    run_task_response = client.run_task(\n        cluster=ECSCluster,\n        taskDefinition=ECSTaskArn,\n        count=1,\n        launchType=\"FARGATE\",\n        overrides={\n            \"containerOverrides\": [\n                {\n                    \"name\": CONTAINER_NAME,\n                    # We override the command so that we can pass some arguments\n                    # e.g. for running different spiders.\n                    \"command\": [\n                        \"python\",\n                        \"launcher.py\",\n                        json.dumps(event),\n                    ],\n                    \"environment\": [\n                        {\"name\": \"FEED_BUCKET_NAME\", \"value\": os.environ[\"FEED_BUCKET_NAME\"]},\n                    ]\n                }\n            ],\n        },\n        networkConfiguration={\n            \"awsvpcConfiguration\": {\n                \"subnets\": [\n                    ECSSubnet,\n                ],\n                \"securityGroups\": [\n                    ECSSecGroup,\n                ],\n                \"assignPublicIp\": \"ENABLED\"\n            },\n        },\n    )\n    return json.dumps(run_task_response, default=str)\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We also need to update our "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" to add some new IAM role statemants, import the CloudFormation template in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"fargate-cf-yml"}]},{"type":"text","value":", add some env variables, include the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"launch_fargate.py"}]},{"type":"text","value":" file, and finally add a new function for launching a Fargate task."}]},{"type":"element","tag":"pre","props":{"code":"# serverless.yml\nservice: my-sls-scraper\n\nprovider:\n  name: aws\n  runtime: python3.7\n  logRetentionInDays: 1\n\n  environment:\n    FEED_BUCKET_NAME: !Ref ScraperFeedBucket\n    ECS_CLUSTER: !GetAtt FargateECSCluster.Arn\n    ECS_TASK_ARN: !Ref FargateECSTaskDefinition\n    ECS_SUBNET: !Ref FargateSubnet\n    ECS_SEC_GROUP: !Ref FargateSG\n    CONTAINER_NAME: \"scraper_container\"\n\n  iamRoleStatements:\n    - Effect: \"Allow\"\n      Action:\n        - \"s3:PutObject\"\n      Resource: !Sub\n        - \"arn:aws:s3:::#{BucketName}/*\"\n        - BucketName: !Ref ScraperFeedBucket\n\n    - Effect: Allow\n      Action:\n        - ecs:RunTask\n      Resource:\n        - !Ref FargateECSTaskDefinition\n    - Effect: Allow\n      Action:\n        - iam:PassRole\n      Resource:\n        - !GetAtt FargateExecutionRole.Arn\n    - Effect: Allow\n      Action:\n        - iam:PassRole\n      Resource:\n        - !GetAtt FargateTaskRole.Arn\n\nfunctions:\n  hello:\n    handler: handler.hello\n  lambdaScrape:\n    handler: launcher.scrape\n  fargateScrape:\n    handler: launch_fargate.launch_fargate\n\n# We include files by whitelisting to reduce the deployment time.\n# Just remember to add any files you create!\npackage:\n  include:\n    - handler.py\n    - launcher.py\n    - launch_fargate.py\n    - my_sls_scraper/**\n    - scrapy.cfg\n  exclude:\n    - \"./**\"\n\nresources:\n  - AWSTemplateFormatVersion: \"2010-09-09\"\n    Transform: \"AWS::Serverless-2016-10-31\"\n  - ${file(./s3-template.yml)}\n  - ${file(./fargate-template.yml)}\n\nplugins:\n  - serverless-python-requirements\n  - serverless-cloudformation-sub-variables\ncustom:\n  pythonRequirements:\n    slim: true # Omits tests, __pycache__, *.pyc etc from dependencies\n    fileName: requirements.txt\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"service"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"my-sls-scraper\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"provider"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"aws\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  runtime"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"python3.7\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  logRetentionInDays"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  environment"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    FEED_BUCKET_NAME"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" ScraperFeedBucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    ECS_CLUSTER"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!GetAtt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateECSCluster.Arn\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    ECS_TASK_ARN"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateECSTaskDefinition\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    ECS_SUBNET"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateSubnet\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    ECS_SEC_GROUP"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateSG\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    CONTAINER_NAME"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"scraper_container\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  iamRoleStatements"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Allow\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"s3:PutObject\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Resource"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"arn:aws:s3:::#{BucketName}/*\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"BucketName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" ScraperFeedBucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Allow\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"ecs:RunTask\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Resource"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateECSTaskDefinition\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Allow\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"iam:PassRole\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Resource"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!GetAtt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateExecutionRole.Arn\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Allow\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"iam:PassRole\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      Resource"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!GetAtt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" FargateTaskRole.Arn\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"functions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  hello"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"handler.hello\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  lambdaScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":45},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"launcher.scrape\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":46},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  fargateScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":47},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"launch_fargate.launch_fargate\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":48},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":49},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# We include files by whitelisting to reduce the deployment time.\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":50},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# Just remember to add any files you create!\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":51},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"package"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":52},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  include"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":53},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"handler.py\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":54},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"launcher.py\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":55},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"launch_fargate.py\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":56},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"my_sls_scraper/**\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":57},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"scrapy.cfg\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":58},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  exclude"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":59},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"./**\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":60},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":61},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"resources"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":62},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"AWSTemplateFormatVersion"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"2010-09-09\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":63},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Transform"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"AWS::Serverless-2016-10-31\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":64},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${file(./s3-template.yml)}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":65},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"${file(./fargate-template.yml)}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":66},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":67},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"plugins"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":68},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"serverless-python-requirements\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":69},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"serverless-cloudformation-sub-variables\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":70},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"custom"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":71},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  pythonRequirements"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":72},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    slim"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":" # Omits tests, __pycache__, *.pyc etc from dependencies\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":73},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    fileName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"requirements.txt\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once again we'll deploy and make a test run with"}]},{"type":"element","tag":"pre","props":{"code":"sls deploy -v\nsls invoke -f fargateScrape --log\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -v\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" invoke"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" fargateScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --log\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The function should execute, but the Fargate task will fail, as we haven't uploaded our Docker image to the repository we created.\nYou can look at what we created in the "},{"type":"element","tag":"a","props":{"href":"https://console.aws.amazon.com/ecs/home","rel":["nofollow"]},"children":[{"type":"text","value":"ECS console"}]},{"type":"text","value":" and the "},{"type":"element","tag":"a","props":{"href":"https://console.aws.amazon.com/vpc/home","rel":["nofollow"]},"children":[{"type":"text","value":"VPC console"}]},{"type":"text","value":". You can see the failed task we started on "},{"type":"element","tag":"a","props":{"href":"https://console.aws.amazon.com/ecs/home?region=us-east-1#/clusters/fargate-my-sls-scraper-dev/tasks","rel":["nofollow"]},"children":[{"type":"text","value":"https://console.aws.amazon.com/ecs/home?region=us-east-1#/clusters/fargate-my-sls-scraper-dev/tasks"}]},{"type":"text","value":" if you toggle "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Stopped"}]},{"type":"text","value":" and change regions if you're not in the default us-east-1."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The final piece in the puzzle is to upload the container image, so let's create a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Makefile"}]},{"type":"text","value":" to make it easy to update it in the future. Maybe you need to change the variables according to your setup."}]},{"type":"element","tag":"pre","props":{"code":"# Makefile\nSTACKNAME_BASE=\"my-sls-scraper-dev\"\n# This is a region that supports AWS Fargate\nREGION=\"us-east-1\"\nPROFILE=\"my-sls-admin\"\nIMAGE_NAME=\"my_sls_scraper\"\n\nbuild:\n    docker build -t $(IMAGE_NAME):latest .\n\nretag:\n    docker tag $(IMAGE_NAME):latest \\\n        $(shell aws cloudformation --region $(REGION) --profile $(PROFILE) describe-stacks --stack-name $(STACKNAME_BASE) --query \"Stacks[0].Outputs[?OutputKey=='ECRRepo'].OutputValue\" --output text):latest\n    @exec $(shell aws ecr --region $(REGION) --profile $(PROFILE) get-login --no-include-email)\n    docker push $(shell aws cloudformation --region $(REGION) --profile $(PROFILE) describe-stacks --stack-name $(STACKNAME_BASE) --query \"Stacks[0].Outputs[?OutputKey=='ECRRepo'].OutputValue\" --output text):latest\n","language":"makefile","meta":"","className":"language-makefile","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# Makefile\nSTACKNAME_BASE=\"my-sls-scraper-dev\"\n# This is a region that supports AWS Fargate\nREGION=\"us-east-1\"\nPROFILE=\"my-sls-admin\"\nIMAGE_NAME=\"my_sls_scraper\"\n\nbuild:\n    docker build -t $(IMAGE_NAME):latest .\n\nretag:\n    docker tag $(IMAGE_NAME):latest \\\n        $(shell aws cloudformation --region $(REGION) --profile $(PROFILE) describe-stacks --stack-name $(STACKNAME_BASE) --query \"Stacks[0].Outputs[?OutputKey=='ECRRepo'].OutputValue\" --output text):latest\n    @exec $(shell aws ecr --region $(REGION) --profile $(PROFILE) get-login --no-include-email)\n    docker push $(shell aws cloudformation --region $(REGION) --profile $(PROFILE) describe-stacks --stack-name $(STACKNAME_BASE) --query \"Stacks[0].Outputs[?OutputKey=='ECRRepo'].OutputValue\" --output text):latest\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We've already build the image, so we just need to upload it with"}]},{"type":"element","tag":"pre","props":{"code":"make retag\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" retag\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The first time pushing, this might take some time depending on how fast your internet connection is.\nYou should see an output similar to"}]},{"type":"element","tag":"pre","props":{"code":"18:17 $ make retag\ndocker tag \"my_sls_scraper\":latest \\\n    459015585648.dkr.ecr.us-east-1.amazonaws.com/my-sl-farga-afj2n785due0:latest\nLogin Succeeded\ndocker push 459015585648.dkr.ecr.us-east-1.amazonaws.com/my-sl-farga-afj2n785due0:latest\nThe push refers to a repository [459015585648.dkr.ecr.us-east-1.amazonaws.com/my-sl-farga-afj2n785due0]\n6b325179a37f: Pushed\n7c486f7d4e0e: Pushed\n5a14878ee86f: Pushed\nfb71908672f7: Pushed\nc028dbad8bfd: Pushed\n424cdf061e9d: Pushed\nbd648e09c386: Pushed\n69d95271719a: Pushed\nf88be44e4bd8: Pushed\ne505c7600391: Pushed\n4d2fd1bf072c: Pushed\n6e302bbcacce: Pushed\n97e8dd85db4e: Pushed\n74e2ede3b29c: Pushed\n6d5a64ea8f37: Pushed\n660314270d76: Pushed\nlatest: digest: sha256:f64c0ed0e5296b03645e5aed927b3af1d75faa226382ac389651519a0b14381c size: 3678\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"18:17 $ make retag\ndocker tag \"my_sls_scraper\":latest \\\n    459015585648.dkr.ecr.us-east-1.amazonaws.com/my-sl-farga-afj2n785due0:latest\nLogin Succeeded\ndocker push 459015585648.dkr.ecr.us-east-1.amazonaws.com/my-sl-farga-afj2n785due0:latest\nThe push refers to a repository [459015585648.dkr.ecr.us-east-1.amazonaws.com/my-sl-farga-afj2n785due0]\n6b325179a37f: Pushed\n7c486f7d4e0e: Pushed\n5a14878ee86f: Pushed\nfb71908672f7: Pushed\nc028dbad8bfd: Pushed\n424cdf061e9d: Pushed\nbd648e09c386: Pushed\n69d95271719a: Pushed\nf88be44e4bd8: Pushed\ne505c7600391: Pushed\n4d2fd1bf072c: Pushed\n6e302bbcacce: Pushed\n97e8dd85db4e: Pushed\n74e2ede3b29c: Pushed\n6d5a64ea8f37: Pushed\n660314270d76: Pushed\nlatest: digest: sha256:f64c0ed0e5296b03645e5aed927b3af1d75faa226382ac389651519a0b14381c size: 3678\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"and, if successful, it should be possible to scrape in Fargate by just invoking a Lambda function. Try it with"}]},{"type":"element","tag":"pre","props":{"code":"sls invoke -f fargateScrape --log\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" invoke"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" fargateScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --log\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It should execute successfully and exit. The logs of the crawler comes from our Fargate task and not the Lambda function, and can be seen in the "},{"type":"element","tag":"a","props":{"href":"https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#logs:","rel":["nofollow"]},"children":[{"type":"text","value":"CloudWatch console"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Well done if you've made it thus far. We've made the basics of a quite sophisticated scraping infrastructure with a lot of potential. The last steps from here are optional.\nWe will set up an S3 bucket for caching responses, and in the end we'll use AWS CloudWatch to schedule automatic crawls and discuss some methods to better automate and control crawl scheduling."}]},{"type":"element","tag":"h2","props":{"id":"using-s3-as-http-cache"},"children":[{"type":"text","value":"Using S3 as HTTP cache"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Caching responses from our spider is good for faster crawls and to avoid getting banned, as well as a store of html responses that can be used for things like machine learning further down the data processing pipeline.\nScrapy comes with a file storage caching system by default, but because of the framework's great extensibility, we can quite easily make our own cache handler. Using persistent file storage is not possible in Lambda or Fargate, so we have to use an object storage like S3 or a database. We will use S3 because it's relatively easy to set up and maintain."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To do this, we first have to add a bucket to our "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"s3-template.yml"}]},{"type":"text","value":" and add IAM role permissions to our "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"fargate-template.yml"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":", as well as an environment variable to the latter and to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"launch_fargate.py"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add an S3 bucket in the S3 template like this"}]},{"type":"element","tag":"pre","props":{"code":"# s3-template.yml\nResources:\n  ScraperFeedBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      VersioningConfiguration:\n        Status: \"Enabled\"\n  HttpCacheBucket:\n    Type: AWS::S3::Bucket\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# s3-template.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Resources"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  ScraperFeedBucket"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"AWS::S3::Bucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      VersioningConfiguration"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Status"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Enabled\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  HttpCacheBucket"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"AWS::S3::Bucket\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add a policy to the Fargate template"}]},{"type":"element","tag":"pre","props":{"code":"# fargate-template.yml\n# ...\n    FargateTaskRole:\n        Type: AWS::IAM::Role\n        Properties:\n            # ...\n            Policies:\n                - PolicyName: HttpCacheBucketPolicy\n                  PolicyDocument:\n                    Statement:\n                      - PolicyName: HttpCacheBucketPolicy\n                          PolicyDocument:\n                            Statement:\n                              - Effect: \"Allow\"\n                                Action:\n                                  - \"s3:GetObject\"\n                                  - \"s3:PutObject\"\n                                  - \"s3:ListBucket\"\n                                Resource:\n                                  - !Sub\n                                    - \"arn:aws:s3:::#{BucketName}/*\"\n                                    - BucketName: !Ref HttpCacheBucket\n                                  - !Sub\n                                    - \"arn:aws:s3:::#{BucketName}\"\n                                    - BucketName: !Ref HttpCacheBucket\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# fargate-template.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    FargateTaskRole"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"AWS::IAM::Role\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        Properties"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"            # ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"            Policies"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"PolicyName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"HttpCacheBucketPolicy\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"                  PolicyDocument"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"                    Statement"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"PolicyName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"HttpCacheBucketPolicy\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"                          PolicyDocument"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"                            Statement"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                              - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Allow\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"                                Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                                  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"s3:GetObject\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                                  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"s3:PutObject\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                                  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"s3:ListBucket\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"                                Resource"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                                  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                                    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"arn:aws:s3:::#{BucketName}/*\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                                    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"BucketName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" HttpCacheBucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                                  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                                    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"arn:aws:s3:::#{BucketName}\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"                                    - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"BucketName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" HttpCacheBucket\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"and statements and env variable to our lambda functions"}]},{"type":"element","tag":"pre","props":{"code":"# serverless.yml\nprovider:\n    # ...\n    environment:\n        HTTP_CACHE_BUCKET_NAME: !Ref HttpCacheBucket\n        # ...\n    iamRoleStatements:\n        - Effect: \"Allow\"\n          Action:\n            - \"s3:GetObject\"\n            - \"s3:PutObject\"\n            - \"s3:ListBucket\"\n          Resource:\n            - !Sub\n              - \"arn:aws:s3:::#{BucketName}/*\"\n              - BucketName: !Ref HttpCacheBucket\n            - !Sub\n              - \"arn:aws:s3:::#{BucketName}\"\n              - BucketName: !Ref HttpCacheBucket\n        # ...\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"provider"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"    # ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    environment"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        HTTP_CACHE_BUCKET_NAME"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" HttpCacheBucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"        # ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    iamRoleStatements"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"Effect"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"Allow\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Action"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"s3:GetObject\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"s3:PutObject\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"s3:ListBucket\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          Resource"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"              - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"arn:aws:s3:::#{BucketName}/*\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"              - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"BucketName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" HttpCacheBucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"            - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Sub\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"              - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"\"arn:aws:s3:::#{BucketName}\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"              - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"BucketName"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"!Ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" HttpCacheBucket\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"        # ...\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"and lastly pass the new env variable when launching the crawler task"}]},{"type":"element","tag":"pre","props":{"code":"# launch_fargate.py\n# ...\n\"environment\": [\n   {\"name\": \"FEED_BUCKET_NAME\",\n       \"value\": os.environ[\"FEED_BUCKET_NAME\"]},\n   {\"name\": \"HTTP_CACHE_BUCKET_NAME\",\n       \"value\": os.environ[\"HTTP_CACHE_BUCKET_NAME\"]},\n],\n# ...\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# launch_fargate.py\n# ...\n\"environment\": [\n   {\"name\": \"FEED_BUCKET_NAME\",\n       \"value\": os.environ[\"FEED_BUCKET_NAME\"]},\n   {\"name\": \"HTTP_CACHE_BUCKET_NAME\",\n       \"value\": os.environ[\"HTTP_CACHE_BUCKET_NAME\"]},\n],\n# ...\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To use all this configuration for some caching, we create a module with our cache implementation in the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"my_sls_scraper"}]},{"type":"text","value":" folder, and don't forget to add an "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"__init__.py"}]},{"type":"text","value":" file in the newly created "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"extensions"}]},{"type":"text","value":" folder."}]},{"type":"element","tag":"pre","props":{"code":"# my_sls_scraper/extensions/s3cache.py\nimport boto3\nimport gzip\nimport json\nimport logging\nimport os\nfrom botocore.exceptions import ClientError\nfrom botocore.stub import Stubber\nfrom time import time\nfrom datetime import datetime\nfrom six.moves import cPickle as pickle\nfrom six.moves.urllib.parse import urlparse\nfrom scrapy.exceptions import NotConfigured\nfrom scrapy.http import Headers\nfrom scrapy.responsetypes import responsetypes\nfrom scrapy.utils.request import request_fingerprint\nfrom w3lib.http import headers_raw_to_dict, headers_dict_to_raw\n\nfrom botocore.exceptions import ClientError\nimport sys\n\nlogger = logging.getLogger(__name__)\n\n\nclass S3CacheStorage(object):\n    def __init__(self, settings):\n        urifmt = settings.get('S3CACHE_URI', '')\n        if not urifmt:\n            raise NotConfigured('S3CACHE_URI must be specified')\n\n        # Parse URI\n        u = urlparse(urifmt)\n        self.keypath_fmt = u.path[1:]\n        if not self.keypath_fmt:\n            raise NotConfigured('Could not get key path from S3CACHE_URI')\n\n        self.bucket_name = u.hostname\n        if self.bucket_name is None:\n            raise NotConfigured('Could not get bucket name from S3CACHE_URI')\n\n        self.use_gzip = settings.getbool('HTTPCACHE_GZIP')\n        self.dont_retrieve = settings.getbool('S3CACHE_DONT_RETRIEVE')\n\n        self._client = None\n        self._spider = None\n        self._keypath = None\n        self.cached_requests = []\n\n    @property\n    def _client_stubber(self):\n        return Stubber(self.client)\n\n    @property\n    def client(self):\n        \"\"\" Connect to S3 and return the connection \"\"\"\n\n        if self._client is None:\n            self._client = boto3.client('s3')\n        return self._client\n\n    @property\n    def keypath(self):\n        \"\"\" Get the keypath as specified in S3CACHE_URI \"\"\"\n        def get_uri_params(obj):\n            \"\"\"Convert an object to a dict\"\"\"\n            params = {}\n            for k in dir(obj):\n                params[k] = getattr(obj, k)\n            params['day'] = datetime.utcnow().strftime('%Y-%m-%d')\n            params['time'] = datetime.utcnow().replace(\n                microsecond=0).isoformat().replace(':', '-')\n            return params\n        if not self._keypath:\n            self._keypath = self.keypath_fmt % get_uri_params(self.spider)\n        return self._keypath\n\n    @property\n    def spider(self):\n        if not self._spider:\n            raise NotConfigured('Could not get spider! Aborting...')\n        return self._spider\n\n    def put_object_to_key(self, obj, bucket, key):\n        try:\n            obj = gzip.compress(obj) if self.use_gzip else obj\n            self.client.put_object(Body=obj, Bucket=bucket, Key=key)\n        except ClientError as e:\n            logger.warning(\n                'Failed to store cache on key {key}: {e}'.format(key=key, e=e))\n            response_code = e.response.get('Error', {}).get('Code')\n            if response_code == 'AccessDenied' or response_code == 'InvalidAccessKeyId':\n                logger.exception(\"Access denied to http cache bucket\")\n                sys.exit(1)\n\n    def get_object_from_key(self, bucket, key):\n        try:\n            response = self.client.get_object(Bucket=bucket, Key=key)\n            obj = response['Body'].read()\n            return gzip.decompress(obj) if self.use_gzip else obj\n        except ClientError as e:\n            logger.debug(\n                'Failed to retrieve cache on key {key}: {e}'.format(key=key, e=e))\n            response_code = e.response.get('Error', {}).get('Code')\n            if response_code == 'AccessDenied' or response_code == 'InvalidAccessKeyId':\n                logger.exception(\"Access denied to http cache bucket\")\n                sys.exit(1)\n\n    def open_spider(self, spider):\n        logger.debug('Using s3 cache storage in %(bucket_name)s' % {'bucket_name': self.bucket_name},\n                     extra={'spider': spider})\n        # Update spider reference\n        self._spider = spider\n\n    def close_spider(self, spider):\n        logger.info(\n            'Cache on s3 bucket {bucket} on key path {keypath}'.format(\n                bucket=self.bucket_name, keypath=self.keypath),\n            extra={'spider': spider}\n        )\n\n    def retrieve_response(self, spider, request):\n        \"\"\"Return response if present in cache, or None otherwise.\"\"\"\n        if self.dont_retrieve:\n            return\n        keyname = self._get_request_path(request)\n        keydata = self.get_object_from_key(self.bucket_name, keyname)\n        if not keydata:\n            return  # not cached\n        keydata = pickle.loads(keydata)\n        metadata = keydata['meta']\n        body = keydata['response_body']\n        rawheaders = keydata['response_headers']\n        url = metadata.get('response_url')\n        status = metadata['status']\n        headers = Headers(headers_raw_to_dict(rawheaders))\n        respcls = responsetypes.from_args(headers=headers, url=url)\n        response = respcls(url=url, headers=headers, status=status, body=body)\n        return response\n\n    def store_response(self, spider, request, response):\n        # TODO: Use a buffer instead of sending the cache files one by one\n        \"\"\"Store the given response in the cache.\"\"\"\n        keyname = self._get_request_path(request)\n        metadata = {\n            'url': request.url,\n            'method': request.method,\n            'status': response.status,\n            'response_url': response.url,\n            'timestamp': time(),\n        }\n        keydata = {\n            'meta': metadata,\n            'response_headers': headers_dict_to_raw(response.headers),\n            'response_body': response.body,\n            'request_headers': headers_dict_to_raw(request.headers),\n            'request_body': request.body\n        }\n        self.put_object_to_key(pickle.dumps(\n            keydata), self.bucket_name, keyname)\n\n    def _get_request_path(self, request):\n        key = request_fingerprint(request)\n        return '{keypath}/{key}'.format(keypath=self.keypath, key=key)\n\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# my_sls_scraper/extensions/s3cache.py\nimport boto3\nimport gzip\nimport json\nimport logging\nimport os\nfrom botocore.exceptions import ClientError\nfrom botocore.stub import Stubber\nfrom time import time\nfrom datetime import datetime\nfrom six.moves import cPickle as pickle\nfrom six.moves.urllib.parse import urlparse\nfrom scrapy.exceptions import NotConfigured\nfrom scrapy.http import Headers\nfrom scrapy.responsetypes import responsetypes\nfrom scrapy.utils.request import request_fingerprint\nfrom w3lib.http import headers_raw_to_dict, headers_dict_to_raw\n\nfrom botocore.exceptions import ClientError\nimport sys\n\nlogger = logging.getLogger(__name__)\n\n\nclass S3CacheStorage(object):\n    def __init__(self, settings):\n        urifmt = settings.get('S3CACHE_URI', '')\n        if not urifmt:\n            raise NotConfigured('S3CACHE_URI must be specified')\n\n        # Parse URI\n        u = urlparse(urifmt)\n        self.keypath_fmt = u.path[1:]\n        if not self.keypath_fmt:\n            raise NotConfigured('Could not get key path from S3CACHE_URI')\n\n        self.bucket_name = u.hostname\n        if self.bucket_name is None:\n            raise NotConfigured('Could not get bucket name from S3CACHE_URI')\n\n        self.use_gzip = settings.getbool('HTTPCACHE_GZIP')\n        self.dont_retrieve = settings.getbool('S3CACHE_DONT_RETRIEVE')\n\n        self._client = None\n        self._spider = None\n        self._keypath = None\n        self.cached_requests = []\n\n    @property\n    def _client_stubber(self):\n        return Stubber(self.client)\n\n    @property\n    def client(self):\n        \"\"\" Connect to S3 and return the connection \"\"\"\n\n        if self._client is None:\n            self._client = boto3.client('s3')\n        return self._client\n\n    @property\n    def keypath(self):\n        \"\"\" Get the keypath as specified in S3CACHE_URI \"\"\"\n        def get_uri_params(obj):\n            \"\"\"Convert an object to a dict\"\"\"\n            params = {}\n            for k in dir(obj):\n                params[k] = getattr(obj, k)\n            params['day'] = datetime.utcnow().strftime('%Y-%m-%d')\n            params['time'] = datetime.utcnow().replace(\n                microsecond=0).isoformat().replace(':', '-')\n            return params\n        if not self._keypath:\n            self._keypath = self.keypath_fmt % get_uri_params(self.spider)\n        return self._keypath\n\n    @property\n    def spider(self):\n        if not self._spider:\n            raise NotConfigured('Could not get spider! Aborting...')\n        return self._spider\n\n    def put_object_to_key(self, obj, bucket, key):\n        try:\n            obj = gzip.compress(obj) if self.use_gzip else obj\n            self.client.put_object(Body=obj, Bucket=bucket, Key=key)\n        except ClientError as e:\n            logger.warning(\n                'Failed to store cache on key {key}: {e}'.format(key=key, e=e))\n            response_code = e.response.get('Error', {}).get('Code')\n            if response_code == 'AccessDenied' or response_code == 'InvalidAccessKeyId':\n                logger.exception(\"Access denied to http cache bucket\")\n                sys.exit(1)\n\n    def get_object_from_key(self, bucket, key):\n        try:\n            response = self.client.get_object(Bucket=bucket, Key=key)\n            obj = response['Body'].read()\n            return gzip.decompress(obj) if self.use_gzip else obj\n        except ClientError as e:\n            logger.debug(\n                'Failed to retrieve cache on key {key}: {e}'.format(key=key, e=e))\n            response_code = e.response.get('Error', {}).get('Code')\n            if response_code == 'AccessDenied' or response_code == 'InvalidAccessKeyId':\n                logger.exception(\"Access denied to http cache bucket\")\n                sys.exit(1)\n\n    def open_spider(self, spider):\n        logger.debug('Using s3 cache storage in %(bucket_name)s' % {'bucket_name': self.bucket_name},\n                     extra={'spider': spider})\n        # Update spider reference\n        self._spider = spider\n\n    def close_spider(self, spider):\n        logger.info(\n            'Cache on s3 bucket {bucket} on key path {keypath}'.format(\n                bucket=self.bucket_name, keypath=self.keypath),\n            extra={'spider': spider}\n        )\n\n    def retrieve_response(self, spider, request):\n        \"\"\"Return response if present in cache, or None otherwise.\"\"\"\n        if self.dont_retrieve:\n            return\n        keyname = self._get_request_path(request)\n        keydata = self.get_object_from_key(self.bucket_name, keyname)\n        if not keydata:\n            return  # not cached\n        keydata = pickle.loads(keydata)\n        metadata = keydata['meta']\n        body = keydata['response_body']\n        rawheaders = keydata['response_headers']\n        url = metadata.get('response_url')\n        status = metadata['status']\n        headers = Headers(headers_raw_to_dict(rawheaders))\n        respcls = responsetypes.from_args(headers=headers, url=url)\n        response = respcls(url=url, headers=headers, status=status, body=body)\n        return response\n\n    def store_response(self, spider, request, response):\n        # TODO: Use a buffer instead of sending the cache files one by one\n        \"\"\"Store the given response in the cache.\"\"\"\n        keyname = self._get_request_path(request)\n        metadata = {\n            'url': request.url,\n            'method': request.method,\n            'status': response.status,\n            'response_url': response.url,\n            'timestamp': time(),\n        }\n        keydata = {\n            'meta': metadata,\n            'response_headers': headers_dict_to_raw(response.headers),\n            'response_body': response.body,\n            'request_headers': headers_dict_to_raw(request.headers),\n            'request_body': request.body\n        }\n        self.put_object_to_key(pickle.dumps(\n            keydata), self.bucket_name, keyname)\n\n    def _get_request_path(self, request):\n        key = request_fingerprint(request)\n        return '{keypath}/{key}'.format(keypath=self.keypath, key=key)\n\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The code is a slightly modified version of "},{"type":"element","tag":"a","props":{"href":"https://github.com/heylouiz/scrapy-s3-http-cache","rel":["nofollow"]},"children":[{"type":"text","value":"github.com/heylouiz/scrapy-s3-http-cache"}]},{"type":"text","value":" to work natively with AWS."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We'll add the necessary settings in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"crawl.py"}]},{"type":"text","value":" so that we can dynamically decide which cache storage to use."}]},{"type":"element","tag":"pre","props":{"code":"# my_sls_scraper/crawl.py\ndef crawl(settings={}, spider_name=\"header_spider\", spider_kwargs={}):\n# ...\n    if (is_in_aws() and os.getenv(\"USE_S3_CACHE\") !=  \"0\") or os.getenv(\"USE_S3_CACHE\"):\n        settings[\"HTTPCACHE_STORAGE\"] =  \"my_sls_scraper.extensions.s3cache.S3CacheStorage\"\n        settings[\"S3CACHE_URI\"] =  f\"s3://{os.environ['HTTP_CACHE_BUCKET_NAME']}/cache\"\n# ...\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# my_sls_scraper/crawl.py\ndef crawl(settings={}, spider_name=\"header_spider\", spider_kwargs={}):\n# ...\n    if (is_in_aws() and os.getenv(\"USE_S3_CACHE\") !=  \"0\") or os.getenv(\"USE_S3_CACHE\"):\n        settings[\"HTTPCACHE_STORAGE\"] =  \"my_sls_scraper.extensions.s3cache.S3CacheStorage\"\n        settings[\"S3CACHE_URI\"] =  f\"s3://{os.environ['HTTP_CACHE_BUCKET_NAME']}/cache\"\n# ...\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we need to do a full deploy by both deploying with Serverless, and rebuild and upload our Docker image. Do that and launch the crawler using S3 as cache storage with"}]},{"type":"element","tag":"pre","props":{"code":"sls deploy -v\nmake build && make retag\nsls invoke -f fargateScrape --log\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -v\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" && "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" retag\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" invoke"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" fargateScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --log\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's probably wise to run the crawler locally after "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"sls deploy -v"}]},{"type":"text","value":" to verify that things work as they should, so you don't need to redeploy 15 times because of various typos (talking from experience).\nRun the crawler locally after finding your cache bucket name in the "},{"type":"element","tag":"a","props":{"href":"https://s3.console.aws.amazon.com/s3/home","rel":["nofollow"]},"children":[{"type":"text","value":"S3 console"}]},{"type":"text","value":" (should be similar to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"my-sls-scraper-dev-httpcachebucket-y2mbtieyeju3"}]},{"type":"text","value":")"}]},{"type":"element","tag":"pre","props":{"code":"sls invoke local -f lambdaScrape --log -e USE_S3_CACHE=1 -e HTTP_CACHE_BUCKET_NAME=<YOUR_CACHE_BUCKET_NAME>\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" invoke"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" local"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" lambdaScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --log"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -e"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" USE_S3_CACHE="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -e"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" HTTP_CACHE_BUCKET_NAME="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"YOUR_CACHE_BUCKET_NAM"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"E"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You should now see objects appearing in the http cache S3 bucket as we run the crawler."}]},{"type":"element","tag":"h2","props":{"id":"scheduling-and-configuring-crawls"},"children":[{"type":"text","value":"Scheduling and Configuring Crawls"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One of the advantages of using the AWS ecosystem is that it contains solutions for all common and uncommon tasks such as scheduling, event notifications, message queues, etc. The Serverless framework even makes some of this easy for beginners, so let's use it to schedule a weekly crawl with our spider."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add a key to our function config in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" (pay damn close attention to the indentation here, or it will not work and no warning will be given)"}]},{"type":"element","tag":"pre","props":{"code":"# serverless.yml\n# ...\nfunctions:\n  fargateScraper:\n    handler: launch_fargate.launch_fargate\nevents:\n  - schedule:\n      rate: cron(0 6 ? * MON *)\n      enabled: true\n      description:\n        Header spider every Monday morning at 6 AM UTC\n        # The input is key-value pairs accessed in the root of the event parameter of every handler function, i.e. event.get(\"spider_name\")\n      input:\n        spider_name: header_spider\n        # ...\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.yml\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"functions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  fargateScraper"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"launch_fargate.launch_fargate\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"events"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"  - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"schedule"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      rate"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"cron(0 6 ? * MON *)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      enabled"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      description"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"        Header spider every Monday morning at 6 AM UTC\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"        # The input is key-value pairs accessed in the root of the event parameter of every handler function, i.e. event.get(\"spider_name\")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"      input"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"        spider_name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"header_spider\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"        # ...\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After deploying, you can verify that a CloudWatch Events tab appears under triggers in the Lambda console."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Lambda console triggers","src":"/posts/scrapy-fargate-sls-guide/lambda-console-triggers.png","title":"Lambda console triggers","style":{"aspectRatio":"1263/812"}},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you have a few spiders, configuring all the launches as scheduled events in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" works fine. If you have a bunch of spiders, you might want to launch several spiders at the same time from a single Lambda function."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We can implement behaviour like that in another Lambda function. Let's remove the dummy function in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"handler.py"}]}]},{"type":"element","tag":"pre","props":{"code":"# handler.py\nimport json\nfrom datetime import datetime, timedelta\nimport logging\n\nfrom launch_fargate import launch_fargate\n\n\ndef run_crawlers(event, context):\n    result = []\n    for x in filter(should_crawl, get_crawler_config()):\n        try:\n            if x.get(\"run_in_lambda\"):\n                # TODO Implement function to invoke crawl in new Lambda function\n                pass\n            else:\n                fargate_launch_response = launch_fargate(dict(\n                    spider_name=x.get(\"spider_name\"),\n                    spider_kwargs=x.get(\"spider_kwargs\"),\n                ), {})\n                result.append(fargate_launch_response)\n        except Exception:\n            logging.exception(\n                f\"Could not launch spider {x.get('spider_name')}\"\n            )\n    return result\n\n\ndef get_crawler_config():\n    # This function could make an API call to a CMS like AirTable,\n    # Strapi or DynamoDB.\n    return [\n        {\n            \"spider_name\": \"header_spider\",\n            \"spider_kwargs\": {\n                \"start_urls\": [\"https://example.com\"],\n            },\n            \"previous_crawl\": {\n                \"success_state\": True,\n                \"items_crawled\": 100,\n                \"finish_date\": datetime.now() - timedelta(days=3),\n            },\n        },\n        {\n            \"spider_name\": \"header_spider\",\n            \"spider_kwargs\": {\n                \"start_urls\": [\"https://www.ietf.org\"],\n            },\n            \"previous_crawl\": {\n                \"success_state\": True,\n                \"items_crawled\": 100,\n                \"finish_date\": datetime.now() - timedelta(hours=16),\n            },\n            \"crawl_interval_hours\": 12,\n            \"settings\": {\n                \"AUTOTHROTTLE_ENABLED\": True,\n            }|\n        },\n        {\n            \"spider_name\": \"header_spider\",\n            \"spider_kwargs\": {\n                \"start_urls\": [\"https://bitcoin.org\"],\n            },\n        },\n        {\n            \"spider_name\": \"other_spider\",\n            \"previous_crawl\": None\n        },\n    ]\n\n\ndef should_crawl(x):\n    previous_crawl = x.get(\"previous_crawl\")\n    if previous_crawl:\n        time_interval_hours = x.get(\"crawl_interval_hours\", 24*7)\n        return previous_crawl.get(\"finish_date\") + timedelta(hours=time_interval_hours) < datetime.now() or not previous_crawl.get(\"success_state\")\n    return True\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# handler.py\nimport json\nfrom datetime import datetime, timedelta\nimport logging\n\nfrom launch_fargate import launch_fargate\n\n\ndef run_crawlers(event, context):\n    result = []\n    for x in filter(should_crawl, get_crawler_config()):\n        try:\n            if x.get(\"run_in_lambda\"):\n                # TODO Implement function to invoke crawl in new Lambda function\n                pass\n            else:\n                fargate_launch_response = launch_fargate(dict(\n                    spider_name=x.get(\"spider_name\"),\n                    spider_kwargs=x.get(\"spider_kwargs\"),\n                ), {})\n                result.append(fargate_launch_response)\n        except Exception:\n            logging.exception(\n                f\"Could not launch spider {x.get('spider_name')}\"\n            )\n    return result\n\n\ndef get_crawler_config():\n    # This function could make an API call to a CMS like AirTable,\n    # Strapi or DynamoDB.\n    return [\n        {\n            \"spider_name\": \"header_spider\",\n            \"spider_kwargs\": {\n                \"start_urls\": [\"https://example.com\"],\n            },\n            \"previous_crawl\": {\n                \"success_state\": True,\n                \"items_crawled\": 100,\n                \"finish_date\": datetime.now() - timedelta(days=3),\n            },\n        },\n        {\n            \"spider_name\": \"header_spider\",\n            \"spider_kwargs\": {\n                \"start_urls\": [\"https://www.ietf.org\"],\n            },\n            \"previous_crawl\": {\n                \"success_state\": True,\n                \"items_crawled\": 100,\n                \"finish_date\": datetime.now() - timedelta(hours=16),\n            },\n            \"crawl_interval_hours\": 12,\n            \"settings\": {\n                \"AUTOTHROTTLE_ENABLED\": True,\n            }|\n        },\n        {\n            \"spider_name\": \"header_spider\",\n            \"spider_kwargs\": {\n                \"start_urls\": [\"https://bitcoin.org\"],\n            },\n        },\n        {\n            \"spider_name\": \"other_spider\",\n            \"previous_crawl\": None\n        },\n    ]\n\n\ndef should_crawl(x):\n    previous_crawl = x.get(\"previous_crawl\")\n    if previous_crawl:\n        time_interval_hours = x.get(\"crawl_interval_hours\", 24*7)\n        return previous_crawl.get(\"finish_date\") + timedelta(hours=time_interval_hours) < datetime.now() or not previous_crawl.get(\"success_state\")\n    return True\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This function makes it possible to run crawls quite intelligently. It also assumes we have more spiders and that our "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"header_spider"}]},{"type":"text","value":" can take arguments in its constructor. Let's change it to do so"}]},{"type":"element","tag":"pre","props":{"code":"# my_sls_scraper/spiders/header_spider.py\nfrom urllib.parse import urlparse\n\nfrom scrapy.spiders import CrawlSpider, Rule\nfrom scrapy.linkextractors import LinkExtractor\n\n\nclass HeaderSpider(CrawlSpider):\n    name = \"header_spider\"\n\n    start_urls = [\"https://scrapy.org\"]\n    allowed_domains = [\"scrapy.org\"]\n\n    def __init__(self, **kwargs):\n        # Enables overriding attributes for a flexible spider\n        if kwargs.get(\"start_urls\"):\n            self.start_urls = kwargs.get(\"start_urls\")\n            self.allowed_domains = list(\n                urlparse(x).hostname for x in self.start_urls\n            )\n\n        super().__init__(\n            **{k: v for k, v in kwargs.items() if not hasattr(self, k)}\n        )\n\n    rules = [  # Get all links on start url\n        Rule(\n            link_extractor=LinkExtractor(\n                deny=r\"\\?\",\n            ),\n            follow=False,\n            callback=\"parse_page\",\n        )\n    ]\n\n    def parse_start_url(self, response):\n        return self.parse_page(response)\n\n    def parse_page(self, response):\n        header = response.css(\"h1, h2\").extract_first(\n        ) or response.css(\"title\").extract_first() or response.url\n        return {\n            \"header\": remove_tags(header),\n            \"url\": response.url,\n        }\n","language":"python","meta":"","className":"language-python","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# my_sls_scraper/spiders/header_spider.py\nfrom urllib.parse import urlparse\n\nfrom scrapy.spiders import CrawlSpider, Rule\nfrom scrapy.linkextractors import LinkExtractor\n\n\nclass HeaderSpider(CrawlSpider):\n    name = \"header_spider\"\n\n    start_urls = [\"https://scrapy.org\"]\n    allowed_domains = [\"scrapy.org\"]\n\n    def __init__(self, **kwargs):\n        # Enables overriding attributes for a flexible spider\n        if kwargs.get(\"start_urls\"):\n            self.start_urls = kwargs.get(\"start_urls\")\n            self.allowed_domains = list(\n                urlparse(x).hostname for x in self.start_urls\n            )\n\n        super().__init__(\n            **{k: v for k, v in kwargs.items() if not hasattr(self, k)}\n        )\n\n    rules = [  # Get all links on start url\n        Rule(\n            link_extractor=LinkExtractor(\n                deny=r\"\\?\",\n            ),\n            follow=False,\n            callback=\"parse_page\",\n        )\n    ]\n\n    def parse_start_url(self, response):\n        return self.parse_page(response)\n\n    def parse_page(self, response):\n        header = response.css(\"h1, h2\").extract_first(\n        ) or response.css(\"title\").extract_first() or response.url\n        return {\n            \"header\": remove_tags(header),\n            \"url\": response.url,\n        }\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It can now scrape the headers on any site with the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"start_urls"}]},{"type":"text","value":" argument.\nWe also have to replace the hello function in "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"serverless.yml"}]},{"type":"text","value":" to the following"}]},{"type":"element","tag":"pre","props":{"code":"# serverless.py\n# ...\nfunctions:\n  pollSpidersScrape:\n    handler: handler.run_crawlers\n    events:\n      - schedule:\n          rate: rate(2 hours)\n          enabled: true\n          description: Poll spiders every 2 hours\n  # ...\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# serverless.py\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"functions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"  pollSpidersScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    handler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"handler.run_crawlers\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    events"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"schedule"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          rate"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"rate(2 hours)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          enabled"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"          description"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"Poll spiders every 2 hours\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"  # ...\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Do a full deploy and see if it works."}]},{"type":"element","tag":"pre","props":{"code":"sls deploy -v\nmake build && make retag\nsls invoke -f pollSpidersScrape --log\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" deploy"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -v\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" build"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" && "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" retag\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" invoke"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" pollSpidersScrape"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" --log\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You should now see output files for scraping "},{"type":"element","tag":"a","props":{"href":"http://www.ietf.org","rel":["nofollow"]},"children":[{"type":"text","value":"www.ietf.org"}]},{"type":"text","value":" and bitcoin.org in S3, while one container will fail because we don't have a spider called "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"other_spider"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"WARNING"}]},{"type":"text","value":"\nDon't forget to remove or stop that last function from running, as starting 3 Fargate containers every 2 hours will cost some money.\nYou can remove all resources* with"}]},{"type":"element","tag":"pre","props":{"code":"sls remove -v\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"sls"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" remove"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -v\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"... and rebuild it all with another command. Infrastructure as code is pretty neat."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"* Serverless will fail to delete the buckets and ECR repository if they are not empty. So you have to manually delete all images from the repository and all objects from the scraper feed bucket and http cache bucket first."}]},{"type":"element","tag":"h2","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This concludes this guide. I hope it was useful for understanding scraping and serverless a little better. The next part will be about setting up a Lambda function that reacts whenever a crawler feed is created in S3, do some processing on that data before it's stored in a database.\nAny feedback is welcome and don't hesitate to contact me if you're interested in the price comparison framework I'm creating."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"running-scrapy-in-aws-lambda","depth":2,"text":"Running Scrapy in AWS Lambda","children":[{"id":"requirements","depth":3,"text":"Requirements"},{"id":"result","depth":3,"text":"Result"}]},{"id":"setting-up-a-crawler","depth":2,"text":"Setting up a crawler","children":[{"id":"creating-the-scraper","depth":3,"text":"Creating the scraper"}]},{"id":"setting-up-an-aws-lambda-function","depth":2,"text":"Setting up an AWS Lambda function"},{"id":"storing-scraped-data-in-s3","depth":2,"text":"Storing scraped data in S3"},{"id":"running-scrapy-in-aws-fargate","depth":2,"text":"Running Scrapy in AWS Fargate","children":[{"id":"dockerize-it","depth":3,"text":"Dockerize it"},{"id":"configure-fargate-on-aws","depth":3,"text":"Configure Fargate on AWS"}]},{"id":"using-s3-as-http-cache","depth":2,"text":"Using S3 as HTTP cache"},{"id":"scheduling-and-configuring-crawls","depth":2,"text":"Scheduling and Configuring Crawls"},{"id":"conclusion","depth":2,"text":"Conclusion"}]}},"_type":"markdown","_id":"content:posts:scrapy-fargate-sls-guide:index.md","_source":"content","_file":"posts/scrapy-fargate-sls-guide/index.md","_extension":"md","sitemap":{"loc":"/posts/scrapy-fargate-sls-guide","images":[]}},{"_path":"/posts/smarte-hjem","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Begynne i det små med smarte hjem","description":"Det har vært snakk om smarte hjem en stund nå. Når alle hus har WiFi, og komponenter er så billige at til og med små enheter kan ha både Blutooth og WiFi, så skal det teoretisk sett være mulig å styre alt elektronisk i hjemmet slik at hjemmet blir smart som bare det. Det teoretiske har faktisk vært på plass i tiår allerede – omtrent fra da WiFi kom. Men utfordringen er å ha et robust grensesnitt for dingser/enheter å snakke sammen. Egentlig snakker sjelden dingser sammen, men de må ha mulighet til å snakke sammen.","date":"2019-08-03T05:52:06.000Z","language":"norwegian","draft":false,"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Det har vært snakk om smarte hjem en stund nå. Når alle hus har WiFi, og komponenter er så billige at til og med små enheter kan ha både Blutooth og WiFi, så skal det teoretisk sett være mulig å styre alt elektronisk i hjemmet slik at hjemmet blir smart som bare det. Det teoretiske har faktisk vært på plass i tiår allerede – omtrent fra da WiFi kom. Men utfordringen er å ha et robust grensesnitt for dingser/enheter å snakke sammen. Egentlig snakker sjelden dingser sammen, men de må ha mulighet til å snakke sammen."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"De trenger bare å kunne høre på kommandoer fra et felles grensesnitt. Hvis det er på plass, kan man styre alt fra en app, en nettside, eller sette opp egne "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"hendelser"}]},{"type":"text","value":" via f eks "},{"type":"element","tag":"a","props":{"href":"https://ifttt.com","rel":["nofollow"]},"children":[{"type":"text","value":"IFTTT"}]},{"type":"text","value":" (IF This Then That – et genialt produkt for automatisere hva som helst) eller Google Home. Dessverre ser det ut til at produsenter ikke er så opptatt av å lage felles grensesnitt eller gjøre det enkelt for brukere. Det er et drøss av forskjellige standarder, og til og med ting som liksom skal være smarte er ganske dumme, og det er vanskelig å integrere ting fra en produsent med noe annet. Vi plages stadig av at det er forskjellige støpsler i forskjellige land. Hva som hver produsent av elektronikk hadde sine egne støpsler og stikkontakter?\nF eks kan man styre en Roomba-støvsuger fra en egen app man må installere. Man kan sette timere og rutiner og sånt. Det virker ganske greit for Roomba, men det hadde vært fint om man kunne velge å styre den fra en hvilken som helst app som f eks IFTTT eller Amazon Alexa. Vi kommer ingen vei hvis man må ha en egen app for hver bidige \"smarte\" ting man har."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Skjermdump av for mange apper for smarte hjem","src":"https://www.loxone.com/enen/wp-content/uploads/sites/3/2014/07/photo-2.png","title":"Skjermdump av for mange apper for smarte hjem"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Litt mange apper for et smart hjem."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Et smart hjem skal ideelt sett erstatte en butler. Man skal kun trenge å fortelle butleren noen få ting om sine dagligdagse rutiner, mens han/hun koordinerer et team av tjenere som gjør alt."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Måten jeg måler hvor langt vi har kommet med smarte hjem er hvor vanskelig det er å starte kaffetrakteren i det øyeblikket vekkerklokka di går av. Det er et åpenbart brukscase som er veldig simpelt, men som hjelper veldig. Hvor mye bedre er det ikke å våkne opp til duften av nytrakta kaffe? Med mindre man har en tjener eller en ektefelle som står opp før deg, er et smarthjem den eneste måten å få til dette."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Problem 1 – starte trakteren.\nHvis trakteren skal starte automatisk, må den kunne ta imot signaler på en måte. Det finnes sikkert kaffetraktere der ute som har mulighet til å koble seg til WiFi på samme måte som Roomba, men det er teit å måtte kjøpe en helt ny kaffetrakter bare for det. Mye bedre om man bare kan bruke den pålitelige trakteren du allerede har. Man vil også gjerne ha mulighet til å starte trakteren på en skreddersydd måte, og ikke konfigurere den fra en app, og brødristeren fra en annen app osv."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Problem 2 – reagere på vekkerklokka.\nLa oss si at du vil stå opp senere en dag. Eller kanskje er på ferie og ikke bruker vekkerklokke. Må man da inn i ørten apper og konfigurere innstillingene i hver eneste en? Slik som det er idag må man det. En enorm fordel med å ha et åpent grensesnitt som enheter kan kommunisere gjennom er at en hvilken som helst hendelse kan utløse en hvilken som helst reaksjon. Det er slik IFTTT og mye annet på internett fungerer. Man vil at alarmen du har satt på telefonen din – enten du har Android, Iphone eller Windows phone eller noe annet – skal si ifra til andre ting i hjemmet at nå ringer alarmen. Hvis hver produsent har sin egen app og et lukket grensesnitt for kommunikasjon vil dette aldri gå.\nNoen enheter begynner nå å komme med støtte for Google Home og Amazon Alexa – som er et godt steg fremover. Men de færreste forbrukere har eller ønsker disse Orwelliske apparatene i hjemmet, så smarte enheter må kunne reagere på enda mer åpne grensesnitt som IFTTT eller det vi webutviklere kaller \"webhooks\"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Heldigvis går vi sakte men sikkert i riktig retning. Jeg synes ikke det er ønskelig at de fleste apparater skal komme med smart-funksjonalitet med mindre de støtter helt åpne grensesnitt. Bedre om de er dumme og enkle, og at kompleksiteten sitter i et annet nivå (layer). Jeg tipper en vanlig person maks til forholde seg til en eller to smarte dingser i hjemmet til enhver tid. For de fleste er dette kun vekkerklokka, men noen har f eks en tidsinnstilt motorvarmer eller sprinkelanlegg i tillegg."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Jeg er åpen for såkalte smart-plugs/sockets (smartkontakt?). De er bare en liten enhet mellom en stikkontakt og et støpsel og bestemmer om det skal gå strøm gjennom eller ikke. De fungerer akkurat som en sånn man kan bruke for å sette på motorvarmeren ved å stille en nedteller, bare at de kan utløses av en hvilken som helst hendelse – ikke bare en nedteller man må sette hver dag. Med en sånn kan man f eks starte motorvarmenen:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Hver ukedag klokka 07:00, men ikke på helligdager"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Når jeg sier til Google Home at den skal starte motorvarmeren"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Når alarmen på telefonen ringer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Når noen twitrer om forsinkelser i "},{"type":"element","tag":"del","props":{},"children":[{"type":"text","value":"NSB"}]},{"type":"text","value":" Vy"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Eller omtrent hva som helst av hendelser som kan representeres digitalt. Slike smartkontakter kan også brukes som en enkel måte å gjøre dumme hjem litt smarte på – på en måte folk flest kan begynne med. F eks kan man styre strømmen til en kaffetrakter med en smartkontakt, og man kan da ganske enkelt nå målet jeg satte i begynnelsen om å trakte kaffe automatisk når vekkerklokka ringer. En sånn smartkontakt er mye billigere enn å kjøpe en helt ny kaffetrakter – de koster omtrent 100kr på Aliexpress eller Ebay. Og de er fleksible og med åpne grensesnitt i tillegg. Man kan også styre andre ting i morgenrutinen med disse. F eks starte en varmluftsovn, starte en radio, skru på lyset, og starte en \"oljediffuser\". Alt dette kan skje på en gang og kan styres fra en enkelt app ved å bare bruke smartkontakter. Kontaktene kan også styres på alle slags kreative måter hvis de støtter IFTTT."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Man er avhengig av å ha apparater som faktisk starter når strømmen kobles til. Dessverre er mange dingser sånn at de ikke starter før man fysisk trykker på en knapp eller to først – etter å ha kobla til strømmen. Spesielt litt mer moderne apparater må konfigureres hver gang de kobles til strømmen, og kan aldri bli smarte av den grunn. Men noen ting som Moccamaster, varmekokere, eller en enkel varmluftsovn starter så straks strømmen kobles til, og kan bli veldig smarte med hjelp av en smartkontakt."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Jeg skal senere skrive en artikkel om hvor mye touch screens, touch-knapper, og mikrokontrollere i vanlige dingser har gjort brukergrensesnittet mye dårligere enn det var før. Jeg savner dingser som starter av seg selv når strømmen kobles til og som har fysiske brytere og knapper man kan vri og trykke på."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Bilde av smartkontakt","src":"https://i.ebayimg.com/images/g/nlcAAOSwRiNdDL60/s-l1600.jpg","title":"Bilde av smartkontakt"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Eksempel på en smartkontakt."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:smarte-hjem.md","_source":"content","_file":"posts/smarte-hjem.md","_extension":"md","sitemap":{"loc":"/posts/smarte-hjem","images":[]}},{"_path":"/posts/conversation-with-yourself-on-messenger","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Start a Conversation With Yourself on Messenger","description":"Did you know it's possible to have a conversation with yourself on Facebook Messenger? I discovered it by accident when creating a share button for my grocery price comparison site https://allematpriser.no. It's convenient to have a convo with yourself as it makes it possible to easily share text and files between your devices.","date":"2019-07-28T02:15:11.000Z","draft":false,"layout":"post","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Did you know it's possible to have a conversation with yourself on Facebook Messenger? I discovered it by accident when creating a share button for my grocery price comparison site "},{"type":"element","tag":"a","props":{"href":"https://allematpriser.no","rel":["nofollow"]},"children":[{"type":"text","value":"https://allematpriser.no"}]},{"type":"text","value":". It's convenient to have a convo with yourself as it makes it possible to easily share text and files between your devices."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Click "},{"type":"element","tag":"button","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.vikfand.com%2F","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"THIS BUTTON"}]}]},{"type":"text","value":" and wait until Facebook is loaded."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Select "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Private Message"}]},{"type":"text","value":" or similar if in another language.\n"},{"type":"element","tag":"div","props":{"style":"max-width: 320px; margin-left: auto; margin-right: auto;"},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"src":"/posts/conversation-with-yourself-on-messenger/share-to-messenger-step-1.png","alt":"Step 2: Click share with friends.","title":"Step 2: Click share with friends.","style":{"aspectRatio":"1080/1920"}},"children":[]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Find yourself by searching.\n"},{"type":"element","tag":"div","props":{"style":"max-width: 320px; margin-left: auto; margin-right: auto;"},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"src":"/posts/conversation-with-yourself-on-messenger/share-to-messenger-step-2.png","alt":"Step 3: Find yourself as the recipient.","title":"Step 3: Find yourself as the recipient.","style":{"aspectRatio":"350/637"}},"children":[]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Click "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"send"}]},{"type":"text","value":" and wait."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can now check Messenger on your computer or phone and use your private conversation however you want."}]},{"type":"element","tag":"div","props":{"style":"max-width: 320px; margin-left: auto; margin-right: auto;"},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"src":"/posts/conversation-with-yourself-on-messenger/conversation-with-myself-messenger.jpg","alt":"Private conversation with myself.","title":"Private conversation with myself.","style":{"aspectRatio":"1080/1920"}},"children":[]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:conversation-with-yourself-on-messenger:index.md","_source":"content","_file":"posts/conversation-with-yourself-on-messenger/index.md","_extension":"md","sitemap":{"loc":"/posts/conversation-with-yourself-on-messenger","images":[]}},{"_path":"/posts/holding-grin","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Holding Grin","description":"","language":"english","date":"2019-06-24","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Grin logo","src":"https://i.imgur.com/iI4TggF.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://grin-tech.org/","rel":["nofollow"]},"children":[{"type":"text","value":"Grin"}]},{"type":"text","value":" is a lightweight implementation of the "},{"type":"element","tag":"a","props":{"href":"https://docs.beam.mw/Mimblewimble.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"mimblewimble"}]},{"type":"text","value":" (MW) protocol. Released 15th Jan 2019, it's basically a cryptocurrency worth watching, but not necessarily worth buying. Let me explain."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There is no doubt that Grin uses promising technology, has a skilled developer team, and does not seem to be just the next big scamcoin. It's more similar to Bitcoin or Monero in their early days. At the core of Grin is mimblewimble, which is a novel way of keeping a distributed ledger that is not fundamentally traceable in the way Bitcoin or Litecoin are*. If the cryptography behind MW is sound, I think it's highly probable that Satoshi would have used that instead of the current \"chain of signatures\" model. This is not true for any other coin, IMO, as e.g. Monero or Zcash make much more significant trade-offs in terms of the complexity of the protocol."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"First paragraphs of the mimblewimble whitepaper by anonymous author Tom Elvis Jedusor.","src":"https://i.imgur.com/8iBtnO3.png"},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Excerpt from the mimblewimble white paper. Published anonymously – just like Bitcoin and Monero."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now that we've made the case for why you should keep an eye on Grin, let us consider the case for buying it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Grin is not a store of value. Grin is not deflationary. Grin is a means of payment. The current community is very clear on this. They want to make anonymous transactions available for everybody. They don't want to make early speculators rich. Bitcoin started with a very high block reward which is getting lower with time. Grin's plan is to have the block reward be 1 coin every block indefinitely. At one block per minute that is 1440 new coins every day or 526k new coins every year. Percentagewise, the inflation will be quite low in the long run, which is strange for a means-of-payment coin. Why they don't have percentage inflation goal is because I think the community is quite conservative, and don't wanna stray too far off what Bitcoin does. That being said, I think it's conceivable that they will change the inflation schedule in a future scenario if it makes the currency a better means-of-payment. This is why Bitcoin is probably a better store-of-value in the long term, but I think Grin as a lot of upside for a speculator in the short term."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bitcoin, Monero, and even Ethereum saw a spike in prices once they found a use case beyond speculation. Bitcoin with The Silk Road, Monero when some dark net markets started accepting it, and Ethereum with the ICO craze. I think this fact makes these three currencies stronger than all those who rose only due to the crypto bubble of 2017. Most of those coins have no use case, and low value proposition even if they get a use case. Grin, however – being the prominent mimblewimble coin – might experience a spike similar to Monero if, say, a dark net market starts accepting it. Grin is, AFAIK, \"underhyped\" – meaning it deserves more attention than it currently has, especially relative to other coins out there. That's why I think Grin has a huge possible upside when the next hype cycle comes around. While other coins will probably double, or even quadruple, Grin will in my estimate** grow ten-fold."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Monero price graph for 2016 to 2017","src":"https://i.imgur.com/wBx6t1K.png"},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.wired.com/2017/01/monero-drug-dealers-cryptocurrency-choice-fire/","rel":["nofollow"]},"children":[{"type":"text","value":"Monero sees 27-fold rise in 2016"}]},{"type":"text","value":". See the spike right after dark net market Alphabay starts accepting it in August 2016."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Say you're the owner of a popular dark net market. Wouldn't it be genius to accumulate a ton of Grin, wait for major exchanges to list it, then start accepting it on your site?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Both Bitcoin and Monero were around for more than 2 years before Silk Road and Alphabay, respectively, started accepting them. Assuming the same timeline for Grin, some dark net market will start accepting it some time in 2021. Maybe the 2 year gap from launch to some adaption is a good rule of thumb, but it's a fragile model, as nothing is certain and anything can happen. For all I know, Monero can implement mimblewimble themselves."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Grin is currently valued at 2-3 USD. It is not listed on many exchanges, which is a good thing if you invest in it, as I would assume the price will rise as soon as more mainstream exchanges start listing it. I'm pretty sure the price will spike, as I think there are more potential big upsides than downsides for this coin. Examples of upsides for Grin could be listing on more exchanges, adoption by a dark net market, Elon Musk tweeting about it, or something else. Who knows? I don't really the value sinking much more for a coin with a solid team and community behind it. Even if the overall crypto market tanks, this particular coin is isolated as it has not yet been overvalued by previous hype cycles, and its holders of last resort are probably quite zealous. However, it's completely imaginable that the value will sink below as 1 USD before it eventually spikes. Only speculate if you can handle that scenario. But if you're convinced to speculate in Grin, don't try timing the bottom, as that is completely unknowable and you risk missing the upturn."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Grin price graph from launch until April 20th 2019.","src":"https://i.imgur.com/SRp33YO.png"},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Ignoring the first tumultous days, the Grin price has been quite stable. I expect a spike to come around."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What about other mimblewimble coins? I've seen other MW coins just when researching Grin, such as "},{"type":"element","tag":"a","props":{"href":"https://www.beam.mw/","rel":["nofollow"]},"children":[{"type":"text","value":"Beam"}]},{"type":"text","value":" but did not pay them attention. My gut feeling tells me they're just the next iterations of Litecoin and Dogecoin, i.e. shittier versions of the high-quality coins like Bitcoin and Monero. A simple rule of thumb I use: the fancier the coin's website, the scammier it is."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I will now go on rambling my moralistic advice to you. Feel free, even encouraged, to skip the last paragraphs."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you made it this far and wanna invest, please consider making a donation to the developers behind Grin. They are talented, no-nonsense individuals who choose to work on making an awesome currency when they could be selfish and just create a scamcoin or take a high paying jobs as rockstar tech people. Grin has no premine, no ICO, no sponsorship, no \"most favorable exchange\", no bullshit – even if you disagree with their philosophy you must give them that. Check out their website, Twitter and IRC. I pledge to donate, before buying, 10% of whatever I buy Grin coins for to one of their community initiatives or developers. You can even buy swag "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"with Grin"}]},{"type":"text","value":" on the charity store "},{"type":"element","tag":"a","props":{"href":"https://tmgox.com/","rel":["nofollow"]},"children":[{"type":"text","value":"https://tmgox.com/"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As of writing this, I don't know how to buy Grin yet. I wanna run a node and buy using atomic swaps with bitcoin via "},{"type":"element","tag":"a","props":{"href":"https://713.mw/","rel":["nofollow"]},"children":[{"type":"text","value":"Vault713"}]},{"type":"text","value":". Even if you're not technical, take the time and educate yourself about the basics. Read, watch videos, ask questions, install it – learn whichever way you feel like. You don't get rich by sitting on your ass using custodial wallets. Take care of your keys and minimize use of exchanges. Many would be millionaires from Bitcoin's early days can testify to that."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TLDR; Grin is probably not store of value, but I expect to see its price spike 10-fold within 3 years."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"* Disclaimer: I have not read the mimblewimble whitepaper – which is why I don't discuss details, but I have heard a couple of podcasts about it, and read the guides on Grin's Github wiki.\n** Disclaimer: What I call estimates are just gut feelings and made up numbers pulled out of my ass."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"PS: I'm a Bitcoin semi-maximalist. I don't hold any strong feelings, but I subscribe to the advantages of Bitcoin's network effects and its stellar community and developer team. But I think there are real scenarios where Bitcoin falls short and risks losing some of its value and/or market share. The reason is because some other currencies have (i) lower transaction costs (Litecoin, BCash), (ii) more privacy (Monero, Grin), or (iii) more expressability (Ethereum, Tron, Dfinity, Tezos, Stellar, Cardano, and so on). If you as a hardcore maximalist have a problem with how I pay for my LSD, fuck off. I use Bitcoin as a SoV, too."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"PS2: This is not investment advice (whatever that means) and you may lose all your money. Anyway, I expect you will donate to me if investing in Grin makes you rich. Thank you."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:Holding Grin.md","_source":"content","_file":"posts/Holding Grin.md","_extension":"md","sitemap":{"loc":"/posts/holding-grin","images":[]}},{"_path":"/posts/how-to-withdraw-grin-from-bitforex","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Complete guide to withdrawing Grin from Bitforex with HTTPS","description":"Operating a Grin wallet is more complicated than a Bitcoin wallet. Transactions require an interactive exchange between the sender and reciever. One way of doing this is to establish a HTTP connection between the transacting parties, and even though a transaction can be made in other ways, this is the only method supported by Bitforex.","extensions":{"preset":""},"date":"2019-06-24","language":"english","tags":"grin, crypto, exchange","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Operating a Grin wallet is more complicated than a Bitcoin wallet. Transactions require an interactive exchange between the sender and reciever. One way of doing this is to establish a HTTP connection between the transacting parties, and even though a transaction can be made in other ways, this is the only method supported by Bitforex."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In fact, Bitforex requires an HTTPS connection, which is not very easy to have on your PC, as you need a certificate and whatnot. This tutorial will explain how you can set up a Grin wallet that accepts transactions over HTTPS using cloud servers."}]},{"type":"element","tag":"h2","props":{"id":"goals"},"children":[{"type":"text","value":"Goals"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Withdraw Grin from Bitforex (or other exchanges) to your personal Grin wallet."}]},{"type":"element","tag":"h2","props":{"id":"prerequisites"},"children":[{"type":"text","value":"Prerequisites"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Domain name – Any domain name you own is fine. If you don't have one, get one for your future blog, business, or homepage. I can recommend to buy it on "},{"type":"element","tag":"a","props":{"href":"https://www.namecheap.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Namecheap"}]},{"type":"text","value":"\nCredit card – To pay for a virtual server\nGrin wallet – I will use Wallet713\nGrin – Can be bought on "},{"type":"element","tag":"a","props":{"href":"https://www.bitforex.com/en/invitationRegister?inviterId=2117019","rel":["nofollow"]},"children":[{"type":"text","value":"Bitforex"}]},{"type":"text","value":" or a few other exchanges"}]},{"type":"element","tag":"h2","props":{"id":"heads-up"},"children":[{"type":"text","value":"Heads up"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will use the command line and many computer related expressions, I hoped to make this tutorial easy for everyone, but I realized it will be hard if you're unfamiliar with the command line.\nSome of the links I use are affiliate links, but all the links are to services I use myself and that are necessary to withdraw Grin over HTTPS."}]},{"type":"element","tag":"h2","props":{"id":"setting-up-a-server"},"children":[{"type":"text","value":"Setting up a server"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Go to "},{"type":"element","tag":"a","props":{"href":"https://www.vultr.com/?ref=8097384","rel":["nofollow"]},"children":[{"type":"text","value":"Vultr"}]},{"type":"text","value":", register and click on the plus button to set up a new server. Select a location close to you, choose Ubuntu version 18.10 x64 and the cheapest server size ($5 in Singapore). Skip all other steps except the SSH key if you know what setting up an SSH key means, and click Deploy Now. You need to wait a couple of minutes for the virtual server to be prohobosedssss in Vultr's data center, so go grab a cup of milk tea or something."}]},{"type":"element","tag":"h2","props":{"id":"configuring-the-server"},"children":[{"type":"text","value":"Configuring the server"}]},{"type":"element","tag":"h3","props":{"id":"access-the-command-line"},"children":[{"type":"text","value":"Access the command line"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TODO use console"}]},{"type":"element","tag":"h3","props":{"id":"install-apache"},"children":[{"type":"text","value":"Install Apache"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You need to install a web server on your computer to handle incoming connections. We will use good old Apache for this tutorial as it's so commonly used.\nFirst, we update the software on the server with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"apt update"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"apt dist-upgrade -y"}]},{"type":"text","value":".\nThen, we install Apache with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"apt install apache2 -y"}]},{"type":"text","value":". (We automatically configure a firewall for the server with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ufw allow 'Apache Full'"}]},{"type":"text","value":" – this opens only ports 80 (HTTP) and 443 (HTTPS).)\nYou should now be able to visit your virtual server in a web browser by typing in the IP address you see on Vultr in your address bar. If you don't get this page, something is wrong. You can debug by following a more detailed tutorial "},{"type":"element","tag":"a","props":{"href":"https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-ubuntu-18-04","rel":["nofollow"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"."},{"type":"element","tag":"img","props":{"alt":"Apache_default_page.","src":"/posts/How to withdraw Grin from Bitforex/apache-default-page.png","style":{"aspectRatio":"1464/961"}},"children":[]}]},{"type":"element","tag":"h4","props":{"id":"configure-your-domain"},"children":[{"type":"text","value":"Configure your domain"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Go to the DNS page for your domain on whatever site you bought the domain on. Since every domain site is slightly different from another, I can't give too detailed instructions here unless you use Namecheap. You can use a domain you already use for something else, just set up a record with grin as a subdomain."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We continue configuring the server by making a virtualhost (do we need this for GRIN???)"}]},{"type":"element","tag":"h3","props":{"id":"configure-ssl-certificate"},"children":[{"type":"text","value":"Configure SSL certificate"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The reason we do all this is to prove we have an SSL certificate. Having an SSL certificate is what allows us to use HTTPS. We need to install something called Let's Encrypt and configure Apache some more.\nRun "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"add-apt-repository ppa:certbot/certbot -y"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"apt install python-certbot-apache -y"}]},{"type":"text","value":" to install certbot.\nWe ask Let's Encrypt to give us a certificate with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"certbot --apache -d grin.vikfand.com"}]},{"type":"text","value":". You can enter your email or a dummy email and accept some terms and conditions. Enter 1 when they ask about redirects, as we don't need to redirect anything."}]},{"type":"element","tag":"h2","props":{"id":"install-grin-wallet"},"children":[{"type":"text","value":"Install Grin wallet"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's finally get to the Grin stuff and install a wallet. I use the "},{"type":"element","tag":"a","props":{"href":"https://github.com/vault713/wallet713/blob/master/docs/setup.md","rel":["nofollow"]},"children":[{"type":"text","value":"vault713"}]},{"type":"text","value":" wallet, but you can also use the default Grin wallet.\nInstall the wallet with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"curl https://wallet.713.mw/install.sh -sSf | sh"}]},{"type":"text","value":". Note that installing a wallet like this without verifying PGP signatures is not good practice, as there is a slight chance you can install a fake wallet made by hackers. Don't follow this tutorial if you handle large funds.\nAnyway, start the wallet with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"./bin/wallet713"}]},{"type":"text","value":". You should already have a wallet and a mnemonic, so enter 2 and type your mnemoic phrase. It will take about 1 minute for the wallet to recover the seed, so wait a little bit and verify that the grinbox address it outputs is the same as the one you have on your own computer. You can now exit.\nWe need to edit one file to make the wallet accept connections over the internet. Open it with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"nano /.wallet713/main/wallet713.toml"}]},{"type":"text","value":". Just add the line "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"foreign_api = true"}]},{"type":"text","value":" to the file and save it. When you start the wallet again with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"./bin/wallet713 -p yourpassphrase"}]},{"type":"text","value":", it should show that it listens to foreign api at "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"127.0.0.1:3415"}]},{"type":"text","value":".\nThe last thing we need to do is set up a proxy in Apache that redirects connections to port 3415, where our Grin wallet is listening."}]},{"type":"element","tag":"h3","props":{"id":"proxy-in-apache"},"children":[{"type":"text","value":"Proxy in Apache"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We need to add three lines to a file Let's Encrypt has generated for us. Open the file with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"nano /etc/apache2/sites-enabled/grin.vikfand.com-le-ssl.conf"}]},{"type":"text","value":". Insert the following lines above the second last line in the file, so that it's above "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"</IfModule>"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"</VirtualHost>"}]},{"type":"text","value":":"}]},{"type":"element","tag":"pre","props":{"code":"SSLProxyEngine On\nProxyPass /abr http://127.0.0.1:3415\nProxyPassReverse /abr http://127.0.0.1:3415\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"SSLProxyEngine On\nProxyPass /abr http://127.0.0.1:3415\nProxyPassReverse /abr http://127.0.0.1:3415\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Save the file and make sure the we made no mistakes with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"apache2ctl configtest"}]},{"type":"text","value":". Oops! It does not work. That's because we need to configure Apache as a proxy server by enabling mod_proxy with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"a2enmod proxy_http"}]},{"type":"text","value":". Run "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"apache2ctl configtest"}]},{"type":"text","value":", and restart apache with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"systemctl restart apache2"}]},{"type":"text","value":" to enable our changes."}]},{"type":"element","tag":"h2","props":{"id":"withdraw-grin"},"children":[{"type":"text","value":"Withdraw Grin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Start the wallet again with "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"./bin/wallet713 -p yourpassphrase"}]},{"type":"text","value":". On your local computer make sure the wallet on your server is actually listening to requests with:"}]},{"type":"element","tag":"pre","props":{"code":"curl -X POST https://grin.vikfand.com:443/abr/v1/wallet/foreign/build_coinbase -d '{\"fees\": 0, \"height\": 13}' -H \"Content-Type: application/json\"\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -X"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" POST"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" https://grin.vikfand.com:443/abr/v1/wallet/foreign/build_coinbase"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -d"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" '{\"fees\": 0, \"height\": 13}'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -H"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" \"Content-Type: application/json\"\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you get a response with a long hexstring it means everything works. Congratulations. If something went wrong, you have my sympathy. This is not exactly easy. Take a walk and try again later."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Your grin HTTPS address is now "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"https://grin.vikfand.com/abr"}]},{"type":"text","value":" – just switch vikfand.com with your domain, but keep the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/abr"}]},{"type":"text","value":", as that is the pattern we chose in our Apache proxy config."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Go to Bitforex, select assets in the top menu, select withdrawals in the left menu, select GRIN from the dropdown of coins. Choose add frequently used address and enter "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"https://grin.vikfand.com/abr"}]},{"type":"text","value":" with your domain in both fields. Try withdrawing a small amount like 1 grin first. For me, Bitforex was a little bit buggy here. I got a strange error message saying \"identifier is invalid\" or something. Just refresh the page if you get it, and you should see the transaction being applied. You can type "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"info"}]},{"type":"text","value":" into your grin wallet on the server or reload the Bitforex page to see the status of your withdrawal. I got mine in a couple of minutes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You may notice that your grin wallet or your local computer won't notice the new funds yet. Just type "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"check"}]},{"type":"text","value":" in wallet713 on your local computer to have it search the blockchain and find your grins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you have a lot of grins, you should generate a new wallet on your local computer and transfer the funds there. Since the wallet we made on the virtual server is in a data centre somewhere, we won't know if somebody watches it and steals your mnemonic phrase. It's also kinda risky for amateur users to expose our wallet to the open internet like we did, as just a small configuration mistake can be abused by an adversary. I saw in the Apache server logs that some unknown bot visitors were probing the server even though it was just minutes old."}]},{"type":"element","tag":"h2","props":{"id":"afterthoughts"},"children":[{"type":"text","value":"Afterthoughts"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Grin is still in the early stage. Only those willing to get their hands dirty with the command line and configuring web servers will become first class Grin citizens with ownership of their keys. I hope exchanges start supporting less complicated withdrawals soon, so we don't need all this setting up a server stuff. On the other hand, I'm optimistic that the price will rise quickly once Grin becomes available to the masses, and maybe used in some Darknetmarkets. I think I'll try making my first purchase with Grin by buying some quirky stuff at "},{"type":"element","tag":"a","props":{"href":"https://tmgox.com/","rel":["nofollow"]},"children":[{"type":"text","value":"https://tmgox.com/"}]},{"type":"text","value":"."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"goals","depth":2,"text":"Goals"},{"id":"prerequisites","depth":2,"text":"Prerequisites"},{"id":"heads-up","depth":2,"text":"Heads up"},{"id":"setting-up-a-server","depth":2,"text":"Setting up a server"},{"id":"configuring-the-server","depth":2,"text":"Configuring the server","children":[{"id":"access-the-command-line","depth":3,"text":"Access the command line"},{"id":"install-apache","depth":3,"text":"Install Apache"},{"id":"configure-ssl-certificate","depth":3,"text":"Configure SSL certificate"}]},{"id":"install-grin-wallet","depth":2,"text":"Install Grin wallet","children":[{"id":"proxy-in-apache","depth":3,"text":"Proxy in Apache"}]},{"id":"withdraw-grin","depth":2,"text":"Withdraw Grin"},{"id":"afterthoughts","depth":2,"text":"Afterthoughts"}]}},"_type":"markdown","_id":"content:posts:How to withdraw Grin from Bitforex:index.md","_source":"content","_file":"posts/How to withdraw Grin from Bitforex/index.md","_extension":"md","sitemap":{"loc":"/posts/how-to-withdraw-grin-from-bitforex","images":[]}},{"_path":"/posts/ai-to-the-masses-with-google-apis","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"AI to the masses with Google APIs","description":"","date":"2019-05-31T17:45:49.000Z","tags":["AI"," ML"," Google"," SaaS"," business idea"],"lang":"english","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'm talking about Google's machine learning APIs available through Google Cloud. Google is no doubt one of, if not "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"the"}]},{"type":"text","value":", company with the most advanced AI in the world. Their competitors envy Google's ginourmous amounts of data, world class talent, and a culture for technical excellence. Wouldn't it be great if anybody could leverage their machine learning to create products in all sectors in all markets? Well, for a small price, services such as image and speech recognition are now available to all of us."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We don't know exactly how useful the machine learning APIs are, but we can compare it to Amazon's launch of cloud computing. Amazon AWS made it cheap to deploy any application to the web, and the pay-as-you-go model allows startups to delay large payments as their revenue increases, instead of paying large fees upfront. This changed the economics for startups and enabled huge amounts of innovation, and eased access for companies without funding."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Similarly, deploying useful machine learning can be difficult and requires sought after expertise. Common tasks like image recognition now doesn't even require training, data, or data scientists. Anyone familiar with programming and cloud computing can now deploy services that use world class AI."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NRKBeta recently published an article describing how the Norwegian state broadcaster experiments with speech recognition for transcription. I'm sure there are tons of services using speech or image recognition out there. Do you know of any worth mentioning?"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:ai-to-the-masses-with-google-apis.md","_source":"content","_file":"posts/ai-to-the-masses-with-google-apis.md","_extension":"md","sitemap":{"loc":"/posts/ai-to-the-masses-with-google-apis","images":[]}},{"_path":"/posts/why-isn-t-bitcoin-banned","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Why isn't Bitcoin banned?","description":"","date":"2019-05-24T09:15:29.000Z","tags":["bitcoin"," crypto"," law"," localbitcoins"],"lang":"english","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bitcoin's proposal from the beginning was to get rid of trusted third parties in our financial system. While te community mostly consisted of technologists in the beginning, libertarians and \"sovereign citizen\" types quickly got interested. Here we have independence, freedom, sound money, no central bankers, interesting discussions on bitcointalk, etc. – all in one project. Then came Silk Road with its infamous drug markets – made possible by Bitcoin! While the authorities went hard on Silk Road, just dark net markets turned out to be a Hydra. Bitcoin itself and a handful of privacy coins are now flourishing in the open. They can be used for money laundering, surpass boycotts, buy drugs, buy sex, surpass the central banks, offshore wealth storage, and many other things the state typically doesn't like its citizens doing. With all the negative press, I would even guess that just banning all cryptocurrencies would not be a too hard a sell for the government. So how the hell did it get this far?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It might be that the decision makers imagine some positive potential in it. Maybe they hear about the innovation, technology, etc., and hope it will be a new internet that will give economic growth and flagship companies, and potentially strengthen the surveillance state. Or maybe they fear that \"if we don't do it, somebody else will\". China, Singapore, Dubai, Switzerland, ...Isle of Man. I don't know if that's what they're thinking, but I think we are in that situation now. Even if the US and all the OPEC nations banned all crypto and aggressively enforced it, companies and individuals would just move somewhere else, and the underground community would still be there. It would certainly be a hard blow, but it would not kill the currencies more effectively than it killed dark net markets."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In my opinion, the more likely exlanation is that the lawmakers and elites just don't understand any of this blockchain-bitcoin-crypto thing. According to Richard Falkvinge, representatives at the European Parliament had their assistants print out their emails for them. Just look at the congress hearings of tech companies. Look at Andreas Antonopolous' testimony to the Canadian senate. Read what criticisms some of the mainstream economists have against Bitcoin. They don't understand the technology at all, and they dismiss the whole ideological thing around it as something fringe and ridiculous."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"But the FBI, CIA, NSA must know something about it. I'm sure all those organizations have very capable people working with crypto, and that they can tell more than we think from all the data they can collect. I'm also sure these guys can effectively persecute a case where crypto is involved, and use it to their advantage. It just doesn't seem like they try to influence the lawmakers in any way. They don't have any nominal authority to do so, but aren't these guys like the shadow governement?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It seems that by now it's too late for the government to ban crypto altogether. Projects like Bitcoin and maybe Ethereum have just gained so much traction that the current system will just have to adopt and integrate it, as they are already doing. I think they can still ban anonymous cryptocurrencies, but they aren't even doing that. And even if they do it, I think even they have enough traction to be able to go strong underground and overseas, and the same goes for exchanges for fiat<->crypto and public coin<->private coin."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Cryptocurrencies have given us many promises, but not many have been fulfilled yet. The original ones of independent value storage and true p2p payments are definitely fullfilled, and that alone will be quite significant. Just consider how crazy the idea of dark net markets actually is, and let it sink in. Functional, secure and safe worldwide drug trade for big and small orders was made possible just within 3 years of Bitcoin launching. TOR also played a part, and I don't see it working that well without the postal system, but I can't imagine this shift in how the world can be reversed now.\nIf the value storage thing also takes off, we might see capital flight from weak currencies unlike anything seen before. Historically, bad governments have confiscated gold, freezed assets, invalidated bank notes, drastically inflated the currency, enforced strict capital controls, and more. Doing any of that if the populace knows how to use Bitcoin sounds difficult. Trace Mayer says that in such a scenario, the old financial system will evaporate rather than collapse, so that just a few things stand left while Bitcoin takes over most functions. The optimistic view of such a scenario is that bad autocrats will have to act better, as people now have a choice. It will be insteresting to see this play out in whatever poor country is the first to fall. They would probably ban Bitcoin at that point, but by then it will be unstoppable."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"PS – case from Norway:\n"},{"type":"element","tag":"a","props":{"href":"https://e24.no/naeringsliv/bitcoin/kjent-bitcoin-veksler-tar-lokalbanken-til-retten-frykter-han-maa-flagge-ut/24596104","rel":["nofollow"]},"children":[{"type":"text","value":"Localbitcoins legend banned from banking – in Norway!"}]},{"type":"element","tag":"a","props":{"href":"https://e24.no/boers-og-finans/bitcoin/bitcoinveksler-godkjent-av-finanstilsynet-bankene-setter-doeren-paa-gloett/24554224","rel":["nofollow"]},"children":[{"type":"text","value":"Even though his business is explicitly licensed and legal"}]},{"type":"text","value":"\nIt looks like there's some kind of struggle between the actual government organization for finance regulations and the private initiatives from the banks themselves. One of the biggest banks in Scandinavia "},{"type":"element","tag":"a","props":{"href":"https://www.tek.no/artikler/nordea-forbyr-alle-sine-ansatte-a-handle-bitcoin-og-andre-kryptovaluta/426654","rel":["nofollow"]},"children":[{"type":"text","value":"bans their employees from holding crypto"}]},{"type":"text","value":" and users of Norway's most popular payment app "},{"type":"element","tag":"a","props":{"href":"https://www.reddit.com/r/BitcoinNO/comments/4rvg55/vipps_bitcoin_sant/","rel":["nofollow"]},"children":[{"type":"text","value":"risk being banned if using it to trade crypto"}]},{"type":"text","value":". It's kinda surprising to see banks act in this way towards a relatively new technology, especially when the government completely permits using crypto as long as they don't use it to break laws. Which is the sensical policy, right? People can also use cars and telephones as long as they don't use them to break laws.\nA possible reason for the banks' response could be that they are worried that cryptocurrencies will challenge their \"monopoly on money\", and create real competition in the financial and payment markets, which is frightening to them. But I think the more probable reason is that they are afraid their customers and employees get entangled in money laundering, scams, non-reversible payments, and stuff like that. Which is what they state as the reason as well."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The bitcoin-fiat exchanger from the articles above is currently awaiting trial against one bank, and appealing a court decision against another bank. He actually lost the first trial on the grounds that one of his customers had used bitcoins to buy illegal drugs. So it's kinda like banning my employer from using banks if I use my salary to buy drugs. It will be interesting to see what happens next. The bitcoin exhanger fears he must move his business overseas if he loses the trial, which confirms my point from the article above. The banks and governments need to either aggressively ban all crypto worldwide, or they might as well embrace it fully. A half-hearted approach will just make crypto adoption more difficult, but still possible – especially if companies can move between jurisdictions."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:why-isn-t-bitcoin-banned.md","_source":"content","_file":"posts/why-isn-t-bitcoin-banned.md","_extension":"md","sitemap":{"loc":"/posts/why-isn-t-bitcoin-banned","images":[]}},{"_path":"/posts/google-as-your-language-coach","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Google as your language coach","description":"I've been using flash cards with Anki to learn Chinese lately. If you don't know Anki, it's just a free app that uses spaced repetition for helping you memorize stuff. The spaced repetition technique is incredibly effective for memorizing stuff. Researchers ave studied why it works, but I think part of it is that it makes it feel like a game that is almost fun. I usually don't have the patience to memorize stuff for exams, but I was able to score a couple of A's in college thanks to Anki. The software is completely free and open source, so you won't be bombarded with ads and upsells like in certain other apps. Memorization of words and phrases alone won't make you fluent in a language, but flash cards combined with Google translate will make it kinda fun and rewarding to learn vocabulary.","date":"2019-02-21T05:20:32.000Z","language":"english","type":"post","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I've been using flash cards with Anki to learn Chinese lately. If you don't know "},{"type":"element","tag":"a","props":{"href":"https://apps.ankiweb.net/","rel":["nofollow"]},"children":[{"type":"text","value":"Anki"}]},{"type":"text","value":", it's just a free app that uses "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Spaced_repetition","rel":["nofollow"]},"children":[{"type":"text","value":"spaced repetition"}]},{"type":"text","value":" for helping you memorize stuff. The spaced repetition technique is incredibly effective for memorizing stuff. Researchers ave studied why it works, but I think part of it is that it makes it feel like a game that is almost fun. I usually don't have the patience to memorize stuff for exams, but I was able to score a couple of A's in college thanks to Anki. The software is completely free and open source, so you won't be bombarded with ads and upsells like in certain other apps. Memorization of words and phrases alone won't make you fluent in a language, but flash cards combined with Google translate will make it kinda fun and rewarding to learn vocabulary."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Speaking to Google translate","src":"https://i.imgur.com/6I5m3oK.gif"},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Instant feedback on my pronounciation"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What I do is having "},{"type":"element","tag":"a","props":{"href":"https://translate.google.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Google translate"}]},{"type":"text","value":" open on my laptop while using the Anki app on my phone. I tell Google to translate from Chinese to English and use the voice recognition function. For every flash card, I say the word or phrase to Google translate, and it gives me some feedback on my pronounciation. The voice recognition is not perfect, and sometimes it won't understand what you're saying even if you say it 100% correctly. But in most cases it will help you correct your mistakes. Google translate basically works and an automated language coach. If I want feedback on my pronounciation, I would normally need a teacher or a native speaker to tell me. Speaking to a computer is not the same as speaking to a human, but it still feels a little bit interactive and social."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:google-as-your-language-coach.md","_source":"content","_file":"posts/google-as-your-language-coach.md","_extension":"md","sitemap":{"loc":"/posts/google-as-your-language-coach","images":[]}},{"_path":"/posts/hvordan-finne-navn","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Hvordan finne på navn til din nye ting","description":"Å finne et navn er en stor ting for et nytt selskap, et nytt produkt, en ny blogg, et nytt barn, eller hva enn du har. Det er nok noe nybegynnere bruker unødvendig mye tid på. Jeg har til og med hørt om folk som vil starte en business kun fordi de eier et domenenavn. Jeg tror vanglivis det viktigste er å ha et navn som er lett å si og lett å skrive. La oss se på noen taktikker rundt det å velge navn med utangspunkt i norske sjokolader.","date":"2019-02-20T05:52:06.000Z","language":"norwegian","draft":false,"layout":"article","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Å finne et navn er en stor ting for et nytt selskap, et nytt produkt, en ny blogg, et nytt barn, eller hva enn du har. Det er nok noe nybegynnere bruker unødvendig mye tid på. Jeg har til og med hørt om folk som vil starte en business kun fordi de eier et domenenavn. Jeg tror vanglivis det viktigste er å ha et navn som er lett å si og lett å skrive. La oss se på noen taktikker rundt det å velge navn med utangspunkt i norske sjokolader."}]},{"type":"element","tag":"h3","props":{"id":"_1-bokstavelig-talt"},"children":[{"type":"text","value":"1 – Bokstavelig talt"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Noen kaller bedriften eller produktet akkurat hva det er, og ferdig med det. Eksempler fra sjokoladeverdenenen er da Mandelstang, Banankrem, Kex og Helnøtt. Det er jo rimelig enkelt, og kunden skjønner umiddelbart hva produktet ditt dreier seg om. Det er kanskje den beste taktikken når man ikke har tid eller evne til å bygge et merkenavn i seg selv. Bare ikke gjør som Gullbrød og lov mer enn du kan levere.\n"},{"type":"element","tag":"img","props":{"alt":"Sjokoladen Mandelstang","src":"/posts/hvordan-finne-navn/mandelstang.jpg","style":{"aspectRatio":"576/432"}},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"En stang med mandler."}]}]},{"type":"element","tag":"h3","props":{"id":"_2-bygge-merkenavn-fra-bunn-av"},"children":[{"type":"text","value":"2 – Bygge merkenavn fra bunn av"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"På den andre siden av spekteret har vi de som finner på et helt nytt ord, og med reklame eller dekning i pressen, etter tid klarer å gjøre det til et nytt merkenavn som står på egne ben. Få sjokolader klarer dette, men jeg tror Snickers og Kit Kat ikke hadde noen betydning før sjokoladen. Å bruke sitt eget navn som produktnavn er en litt mindre kreativt, men litt mer ambisiøst enn å finne på et nytt ord. Anthon Berg jobbet hele livet og satt ryktet sitt på spill ved å lage konfekt og ble ganske kjent for det.\n"},{"type":"element","tag":"img","props":{"alt":"Anthon Berg-butikken The Generous Store","src":"/posts/hvordan-finne-navn/anthon-berg-generous-store.jpg","style":{"aspectRatio":"520/348"}},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Å bygge merkenavn fra bunn av er mye jobb, men kan lønne seg veldig."}]}]},{"type":"element","tag":"h3","props":{"id":"_3-ta-et-positivt-ord"},"children":[{"type":"text","value":"3 – Ta et positivt ord"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hvis man ikke vil være bokstavelig eller bygge et merkenavn fra bånn av, kan man bare ta et ord som allerede vekker positive assosiasjoner. Smil har åpenbart gjort nytte av dette trikset, og mange andre er i grenseland. Vi har New Energy, men sliter med å finne flere som bruker dette enkle trikset. Nero våger å gjøre det stikk motsatte, og tar navnet til den romerske keiseren Nero som er beryktet for å være ond, sadistisk, og dårlig på jobben sin som keiser.\n"},{"type":"element","tag":"img","props":{"alt":"Sjokoladen Smil","src":"/posts/hvordan-finne-navn/smil.jpg","style":{"aspectRatio":"1600/900"}},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Kjøp meg og smil :):):):)"}]}]},{"type":"element","tag":"h3","props":{"id":"_4-ta-et-ord-din-målgruppe-allerede-liker"},"children":[{"type":"text","value":"4 – Ta et ord din målgruppe allerede liker"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Denne er litt vrien. Jeg tenker på Kong Haakon, Lohengrin, Sport Lunch – kanskje Cuba og Bounty. Lohengrin ble laget spesielt i forbindelse med visningen av Wagners opera med samme navn på Nationaltheatret i 1911, og ble designet av arkitekten Henrik Bull. 108 år senere besluttet Freia å ikke produsere sjokoladen lenger pga lite etterspørsel. Skulle de byttet navn til "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"The Sound of Music"}]},{"type":"text","value":" eller noe? Denne taktikken er på en måte en målrettet bruk av å ta et generelt positivt ord."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Sjokoladen Lohengrin","src":"/posts/hvordan-finne-navn/Lohengrin.jpg","style":{"aspectRatio":"1200/680"}},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Lohengrin ble spist for første gang i 1911. Salget stoppet i februar 2019 pga lite etterspørsel."}]}]},{"type":"element","tag":"h3","props":{"id":"_5-ta-et-ord-løst-tilknyttet-ideen-din"},"children":[{"type":"text","value":"5 – Ta et ord løst tilknyttet ideen din"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Stratos høres litt luftig ut, eller hva? Bounty er en tropisk øy i stillehavet og bruker den tropiske ingrediensen kokos. Troika er en trio og består av 3 elementer. Twix har to \"pinner\", og twigs betyr pinne på engelsk, og twix betyr sikkert tvillinger på latin eller noe. Føler at de som velger navn på denne måten vil være litt kreative, men ikke for kreative.\n"},{"type":"element","tag":"img","props":{"alt":"Gammel reklame for Troika og dens forgjenger Gele-trøffel.","src":"/posts/hvordan-finne-navn/troika_gammel.jpeg","style":{"aspectRatio":"720/450"}},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Troika tok steget fra å være en bokstavelig-talt-sjokolade kalt gele-trøffel, til dagens navn som lover trippel nytelse."}]}]},{"type":"element","tag":"h3","props":{"id":"_6-bare-ta-et-ord"},"children":[{"type":"text","value":"6 – Bare ta et ord..."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Noen navn ser ut til å bare komme fra løse lufta. Monolitt, Firkløver, Hval, Lion ... Hobby! Det er ikke nye ord, men de har ingenting med sjokolade å gjøre. Man må bygge det nye ordet som et merkenavn, og det er et ord folk er kjent med, og som er lett å si.\n"},{"type":"element","tag":"img","props":{"alt":"Sjokoladen Hobby","src":"/posts/hvordan-finne-navn/hobby.jpeg","style":{"aspectRatio":"300/170"}},"children":[]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Hobby. For deg som har en hobby."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mangler jeg noe? Kan noen lage en tilsvarende for bloggere? Komikerfrue og Trines Matblogg er bokstavelig-talt-navn. Sofie Elise bygger et brand rundt sitt ekte navn. Voe er et helt nytt ord?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"PS:"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nKom over en gammel reklame for Troika da jeg gjorde \"research\" for denne artikkelen. Husker den ofte gikk i reklamepausen mellom Mot i Brøstet og Hotel Cæsar.."}]},{"type":"element","tag":"video","props":{"controls":true},"children":[{"type":"text","value":"\n    "},{"type":"element","tag":"source","props":{"src":"/troika_lang.mp4","type":"video/mp4"},"children":[]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"_1-bokstavelig-talt","depth":3,"text":"1 – Bokstavelig talt"},{"id":"_2-bygge-merkenavn-fra-bunn-av","depth":3,"text":"2 – Bygge merkenavn fra bunn av"},{"id":"_3-ta-et-positivt-ord","depth":3,"text":"3 – Ta et positivt ord"},{"id":"_4-ta-et-ord-din-målgruppe-allerede-liker","depth":3,"text":"4 – Ta et ord din målgruppe allerede liker"},{"id":"_5-ta-et-ord-løst-tilknyttet-ideen-din","depth":3,"text":"5 – Ta et ord løst tilknyttet ideen din"},{"id":"_6-bare-ta-et-ord","depth":3,"text":"6 – Bare ta et ord..."}]}},"_type":"markdown","_id":"content:posts:hvordan-finne-navn:index.md","_source":"content","_file":"posts/hvordan-finne-navn/index.md","_extension":"md","sitemap":{"loc":"/posts/hvordan-finne-navn","images":[]}},{"_path":"/posts/supermarket-price-lookup","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Supermarket Price Lookup","description":"There is no service that lets consumers easily look up and compare prices on common products typically sold in supermarkets, such as groceries. This article will discuss whether it makes sense making an online tool for doing so.","date":"2018-11-15T13:42:46.000Z","language":"english","type":"post","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There is no service that lets consumers easily look up and compare prices on common products typically sold in supermarkets, such as groceries. This article will discuss whether it makes sense making an online tool for doing so."}]},{"type":"element","tag":"h3","props":{"id":"price-lookup-and-comparison"},"children":[{"type":"text","value":"Price lookup and comparison"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Almost all other products have some online tool for looking up and comparing prices. The most well-known in Norway is "},{"type":"element","tag":"a","props":{"href":"https://prisjakt.no","rel":["nofollow"]},"children":[{"type":"text","value":"Prisjakt"}]},{"type":"text","value":" which compares products that online stores feed to Prisjakt's database. It works as markering for the online stores and Prisjakt makes money by being an affiliate. Due to many reasons, groceries and other products sold at supermarkets are not included in Prisjakt's or and of their competitors' databases."}]},{"type":"element","tag":"h3","props":{"id":"supermarket-catalogs"},"children":[{"type":"text","value":"Supermarket catalogs"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All supermarkets in Norway publish a catalog with special offers every week or every few weeks. The quality of the offers vary. Some are indeed very cheap and actually sold at a loss by the stores, while some are made to look like offers while not actually being cheaper than similar products with their competitors. The offers may vary regionally in Norway, so each region typically has its own catalog. The set of offers are, however, often overlapping across regions. The catalogs are interesting because there exist very successful apps – both in terms of active users and value "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" – that merely presents the supermarket catalogs in a digital format. The weakness of these apps is that their listings are limited to what is published in the catalogs, and in the case of Mattilbud, not indexed and searchable, so that the user has to manually scroll through every catalog."}]},{"type":"element","tag":"h3","props":{"id":"other-offers"},"children":[{"type":"text","value":"Other offers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Supermarkets also often have offers not published in the catalogs. These are made by independent franchised stores. They are typically marketed on signs outside and inside the physical stores. They can also not be marketed at all, and only discoverable by looking at the product's price tag inside the store."}]},{"type":"element","tag":"h3","props":{"id":"prices-in-online-supermarkets"},"children":[{"type":"text","value":"Prices in online supermarkets"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The most significant innovation in the supermarket business lately has been the introduction of online supermarkets such as "},{"type":"element","tag":"a","props":{"href":"https://kolonial.no","rel":["nofollow"]},"children":[{"type":"text","value":"kolonial.no"}]},{"type":"text","value":". These are interesting for us because they provide a full overview of prices for all typical products. A simple web scraping bot can thrawl their online catalog and save all prices in a database, so that the price and price history of every product is searchable and can be compared to other supermarkets. This allow us to automatically assess the quality of an offer by comparing the price to that of the price in the online supermarket. The prices on kolonial.no are typically the same or 1-5% higher than in the cheap Rema 1000 chain."}]},{"type":"element","tag":"h3","props":{"id":"current-situation"},"children":[{"type":"text","value":"Current situation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The app Mattilbud in Norway and Shopgun in Denmark have been wildly successful considering all they do is showing a collection of digital catalogs. There is a quite popular Facebook group for sharing various offers in Norwegian supermarkets called "},{"type":"element","tag":"a","props":{"href":"https://www.facebook.com/groups/1522454624723003/","rel":["nofollow"]},"children":[{"type":"text","value":"Tilbud og priskriger"}]},{"type":"text","value":" with 24199 members. Members often ask about some good offers and share good offers they have discovered. It seems like Pepsi Max and Grandiosa are the most popular products here. This is done manually and there is no easy way to search for prices of products among all supermarkets in Norway."}]},{"type":"element","tag":"h3","props":{"id":"suggestion-for-new-application"},"children":[{"type":"text","value":"Suggestion for new application"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Our idea is to make a website/PWA/app that is backed by a reasonably up-to-date database with prices of all popular supermarket products in Norway, including offers in the catalogs. The data is gathered by scraping the online supermarkets (kolonial, meny, europris) and using Shopgun's API to get the catalog offers in a digital format. Additional sources can be users' contributions and receipt scanning, but these are hard to implement, and the app should work well without them. The app simply has a text input box for searching for products names or categories. It may have a top list of relevant offers for the user. It can be customized for each user by using their location, history, or user submitted information."}]},{"type":"element","tag":"h3","props":{"id":"arguments-against-the-new-application"},"children":[{"type":"text","value":"Arguments against the new application"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The main competitor, Mattilbud, can easily implement a search function themselves"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"It's not clear whether users actually want a search function, or any of the new features the new app can have"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"It's very hard to market a new app to a general audience"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"It's hard to maintain high quality data about prices as they vary across time, regions, and individual stores"}]}]},{"type":"element","tag":"h3","props":{"id":"arguments-in-favor-of-the-new-application"},"children":[{"type":"text","value":"Arguments in favor of the new application"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"There is usually space for some competition in a profitable market"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"No current apps collect prices from products not listed in catalogs"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Mattilbud in Norway is not as popular as Shopgun in Denmark, maybe because Mattilbud is not as good as Shopgun"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Making a MVP and marketing it for free in Facebook groups is not expensive or very time consuming"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Mattilbud is only available as a native app on Android or iOS"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"User contributions can allow independent supermarkets such as immigrant stores, which often has better goods and lower prices than the main chains, to get the promotion they deserve, and help break the supermarket oligopoly in Norway"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"[1] "},{"type":"element","tag":"a","props":{"href":"https://e24.no/naeringsliv/danske-shopgun-kjoeper-den-norske-appen-mattilbud-for-tosifret-millionbeloep/24416671","rel":["nofollow"]},"children":[{"type":"text","value":"Shopgun buys Mattilbud for 7-figure sum (NOK)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Online supermarkets:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://kolonial.no","rel":["nofollow"]},"children":[{"type":"text","value":"kolonial.no"}]},{"type":"text","value":" (Norway)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://meny.no/varer","rel":["nofollow"]},"children":[{"type":"text","value":"Meny"}]},{"type":"text","value":" (Norway)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.europris.no/","rel":["nofollow"]},"children":[{"type":"text","value":"Europris"}]},{"type":"text","value":" (Norway)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.mat.se/","rel":["nofollow"]},"children":[{"type":"text","value":"mat.se"}]},{"type":"text","value":" (Sweden)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Offer catalog apps:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://shopgun.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Shopgun"}]},{"type":"text","value":" (Norway, Denmark, ++)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.mattilbud.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Mattilbud"}]},{"type":"text","value":" (Norway)"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"price-lookup-and-comparison","depth":3,"text":"Price lookup and comparison"},{"id":"supermarket-catalogs","depth":3,"text":"Supermarket catalogs"},{"id":"other-offers","depth":3,"text":"Other offers"},{"id":"prices-in-online-supermarkets","depth":3,"text":"Prices in online supermarkets"},{"id":"current-situation","depth":3,"text":"Current situation"},{"id":"suggestion-for-new-application","depth":3,"text":"Suggestion for new application"},{"id":"arguments-against-the-new-application","depth":3,"text":"Arguments against the new application"},{"id":"arguments-in-favor-of-the-new-application","depth":3,"text":"Arguments in favor of the new application"}]}},"_type":"markdown","_id":"content:posts:supermarket-price-lookup.md","_source":"content","_file":"posts/supermarket-price-lookup.md","_extension":"md","sitemap":{"loc":"/posts/supermarket-price-lookup","images":[]}},{"_path":"/posts/spotify-social-jukeboxes","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Spotify Social Jukeboxes","description":"","date":"2018-10-23T08:09:23.000Z","language":"english","type":"post","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"my-take-on-the-current-available-social-jukeboxes-out-there"},"children":[{"type":"text","value":"My take on the current available \"social jukeboxes\" out there"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Having participants at a party voting for songs to be played is a common app idea that is often mentioned, or silently thought about, when IT students have parties and social events with music. The party's playlist can often be handled by a tyrant who has a very specific taste in music. It can default to some bland music because nobody is willing to risk their reputation as a music connoseur by playing their guilty pleasure songs. With Spotify's queue, a carefully crafted queue can be ruined by one well-meaning contributor clicking the wrong button and erasing the queue. The solution is, an idea as old as the good old jukebox, a computer program selecting songs in order based on input by the participants at the party.\nWhat will follow is the apps and websites doing that function that I know about, and concluding remarks about what yet another such service can do better and differently."}]},{"type":"element","tag":"h3","props":{"id":"festify"},"children":[{"type":"text","value":"Festify"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://festify.rocks/","rel":["nofollow"]},"children":[{"type":"text","value":"Festify"}]},{"type":"text","value":" is a web app that uses Spotify's "},{"type":"element","tag":"a","props":{"href":"https://developer.spotify.com/documentation/web-playback-sdk/","rel":["nofollow"]},"children":[{"type":"text","value":"Web Playback SDK"}]},{"type":"text","value":" to play tracks directly in the party host's browser. Participants join by visiting a url or entering the party name on the landing page. It has a nice UI, a search function, fallback playlists, and more. I have tried it without discovering any bugs, which together with having the basic features locked in, a clean UI, and no-installation setup, makes it the best social jukebox app out there, as far as I can tell.\nThe source code is openly available on "},{"type":"element","tag":"a","props":{"href":"https://github.com/Festify","rel":["nofollow"]},"children":[{"type":"text","value":"Github"}]},{"type":"text","value":", and is maintained by what appears to be three German students. They don't work full time on it, but have been working steadily for several years, doing a great job. They have an active account on "},{"type":"element","tag":"a","props":{"href":"https://twitter.com/GetFestify","rel":["nofollow"]},"children":[{"type":"text","value":"Twitter"}]},{"type":"text","value":", and have captured the top spot on Google search results when searching for "},{"type":"element","tag":"a","props":{"href":"https://www.google.com/search?q=vote+songs+spotify","rel":["nofollow"]},"children":[{"type":"text","value":"\"vote songs spotify\""}]},{"type":"text","value":".\nThe technology stack is based on various front-end web frameworks and libraries. The web app itself is in React and Typescript, while authentication and global state (the queue and votes) are handled by Google Firebase.\nThe main weakness of Festify is that it's only available on a desktop device, as the "},{"type":"element","tag":"a","props":{"href":"https://developers.google.com/web/fundamentals/media/eme","rel":["nofollow"]},"children":[{"type":"text","value":"media playing protocol"}]},{"type":"text","value":" for using Spotify in the browser is not supported on mobile browsers. While it's extremly easy to get started by only using the browser, I suppose there are some situations where people would prefer to play music from their smart phone, Chromecast, or other device. Further, I can only think of improving their markering and promotion, as their product is quite solid. But that #1 spot on Google will probably take them a long way if the concept of social jukeboxes goes viral."}]},{"type":"element","tag":"h3","props":{"id":"mubo"},"children":[{"type":"text","value":"Mubo"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.mubo-app.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Mubo"}]},{"type":"text","value":" is downloadable on the app stores as an app that implements the Spotify jukebox functionality on a smart phone. Once installed, it works seamlessly. The UI is nice, it has the basic functions pinned down, and I did not discover any bugs. I don't know anything about the developers or technology used, but I suppose they use the Spotify SDK for "},{"type":"element","tag":"a","props":{"href":"https://developer.spotify.com/documentation/android/","rel":["nofollow"]},"children":[{"type":"text","value":"Android"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://developer.spotify.com/documentation/ios/","rel":["nofollow"]},"children":[{"type":"text","value":"IOS"}]},{"type":"text","value":".\nThe drawback is of course that the host and participants need to download an actual app from the app store to their device before they can use it. I think something like this might have worked in 2012, but having a large amount of people download an app for a niche use case is not something I think works anymore. If only the host needs to download it, it might actually work, and all they need to do is have a global state in a back-end and a simple web client for that to work. My guess is that Mubo, like several other apps that do the same thing are not under active development."}]},{"type":"element","tag":"h3","props":{"id":"outloud"},"children":[{"type":"text","value":"OutLoud"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://outloud.dj/","rel":["nofollow"]},"children":[{"type":"text","value":"Outload"}]},{"type":"text","value":" is available as an app on Android and IOS. The party host needs to install the app to play from their phone, and it does not support playing from other sources. The participants can join through the browser which works on any platform. It supports using both Spotify and Soundcloud as sources from music, which gives Outloud an advantage over its competitors. I did not, however, find the songs I was looking for when trying to search with Soundcloud in the web interface, so I guess either Soundcloud's search API is limited, or there is a bug in Outloud. It is also the most advances app I tried as there are many options for the party host to configure their party. I can turn on downvotes, choose a custom url, only allow participants in the vicinity to join (via geolocation), disable explicit songs ... I consider this too much, especially as you needed to select an url and party name before starting it.\nThe UI is quite intuitive and easy to understand, but it was too slow on my kinda shitty Android phone. In addition to the unresponsivness due to lag, I think it lacks a polished finish that makes some apps just look attractive. The developers seem to have focused too much on the technical, and not been able to create a really good user experience in my opinion. The technical parts are quite good, though, and apart from lag, I could not find any bugs.\nAt the first glance, I thought the project was abandoned, but they made a recent Facebook post, and the app was updated recently in the Play Store. The developers seem to know what they're doing, and with a better user experience and some marketing, they might be the superior option."}]},{"type":"element","tag":"h3","props":{"id":"others"},"children":[{"type":"text","value":"Others"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Just from a DuckDuckGo search, I found several clones who all are smart phone apps.  "},{"type":"element","tag":"a","props":{"href":"http://jukeboxforspotify.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Jukebox for Spotify"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://jukestar.mobi/","rel":["nofollow"]},"children":[{"type":"text","value":"Jukestar"}]},{"type":"text","value":" both look to be abandoned, and it doesn't seem like they offer anything the other apps can't do better."}]},{"type":"element","tag":"h3","props":{"id":"whats-missing"},"children":[{"type":"text","value":"What's missing?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What's missing is something that is as easy to set up as Festify, and that works on all devices, especially on smart phones. I think being share the party as fast and seamlessly as possible is very important. You don't want to ask everybody in your party to enter a url, then join 'Luke's party', and all that. So just a QR code, sharing links on messenging apps, invitations with push notifications, is the way to go for quickly sharing. The UI should probably be very simple, as people at a party often have more interesting things to do than learning how to use various \"cool\" features in a new app."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAs long as the encrypted media standard does not work on mobile, the only way to be playing from a smart phone is by installing an app or managing the queue and playback in the cloud. This is what I'm doing in my app, tentatively called Votify, but the name needs to change, as the Google real estate is taken for searches on "},{"type":"element","tag":"a","props":{"href":"https://www.google.com/search?q=votify","rel":["nofollow"]},"children":[{"type":"text","value":"\"votify\""}]},{"type":"text","value":". I have a server running that sends commands to the Spotify "},{"type":"element","tag":"a","props":{"href":"https://developer.spotify.com/documentation/web-api/","rel":["nofollow"]},"children":[{"type":"text","value":"Web API"}]},{"type":"text","value":", which again controls the party host's currently playing Spotify instance, whether it be on a desktop computer, a smart phone, on Chromecast, or whatever. This makes it somewhat error prone and hard to program, but offers great flexibilty in that it basically works everywhere without needing to download anything. Both the host and participants start, vote and manage their party in the browser, mobile or desktop work equally well."}]},{"type":"element","tag":"h3","props":{"id":"afterthoughts"},"children":[{"type":"text","value":"Afterthoughts"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A quick search on DuckDuckGo actually bears witness to the inviability of social jukebox apps. The top 10 results show many abandoned projects, or apps with few users, so I'm not convinced that the social jukebox idea is actually something enough people want to use. It is, however, quite fun to work with, and people who hear about the idea often say it's a good one. So there's that."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"my-take-on-the-current-available-social-jukeboxes-out-there","depth":2,"text":"My take on the current available \"social jukeboxes\" out there","children":[{"id":"festify","depth":3,"text":"Festify"},{"id":"mubo","depth":3,"text":"Mubo"},{"id":"outloud","depth":3,"text":"OutLoud"},{"id":"others","depth":3,"text":"Others"},{"id":"whats-missing","depth":3,"text":"What's missing?"},{"id":"afterthoughts","depth":3,"text":"Afterthoughts"}]}]}},"_type":"markdown","_id":"content:posts:spotify-social-jukeboxes.md","_source":"content","_file":"posts/spotify-social-jukeboxes.md","_extension":"md","sitemap":{"loc":"/posts/spotify-social-jukeboxes","images":[]}},{"_path":"/posts/using-your-own-data-for-value","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Using Your Own Data for Value","description":"","date":"2018-10-19T04:27:20.000Z","language":"english","type":"post","body":{"type":"root","children":[{"type":"element","tag":"h3","props":{"id":"get-value-from-your-own-data-with-gdpr-data-portability-requirements"},"children":[{"type":"text","value":"Get value from your own data with GDPR data portability requirements"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://gdpr-info.eu/art-20-gdpr/","rel":["nofollow"]},"children":[{"type":"text","value":"Article 20"}]},{"type":"text","value":" of the General Data Protection Regulation (GDPR) states that:"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The data subject shall have the right to receive the personal data\nconcerning him or her, which he or she has provided to a controller,\nin a structured, commonly used and machine-readable format and have\nthe right to transmit those data to another controller "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"..."}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This may seem like just one item in a long list of boring and complicated requirements in GDPR, but the implications can be quite drastic. It basically means that all the data any organization has stored about you, you have the right to receive in a machine readable format that you can either process yourself or give to a competitor. For social media it means all your likes, friend list, posts, pictures, etc. For your bank or payment processor it means all your transactions. For a loyalty program it means all your purchases. Data that is valueable to the companies that store them, and that they would never give away if not for regulations."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Fine, but what does this mean for me? If you have ever been frustrated that your data has been locked into one platform, or one app, without being able to get it out, this is a solution. It will now be much easier to switch between apps and services. There are also opportunities for using the data yourself. If you can download all your payment transactions and receipts, you can feed them into a personal finance tool that can give you a detailed view of how you spend your money. It can also suggest how you can change your habits to save money by automatically doing price comparison. It's also not too far fetched that you can sell that data yourself to a company that does consumer analysis."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All the talk around GDPR so far has been about companies comlying, and whether it is a good regulation or not. No matter the answer, it is here to stay, and we should use it for the good it's worth. I hope coders and data scientists take some time to experiment. See what data you can download from whatever services you use. I already mentioned banks and retailers as interesting data sources, but there is much more out there. What will your phone company give you? Make notes of what data you get and in which format, and make do some calculations, measure statistics, create visualizations, and share it (just erase your ... "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"sensitive"}]},{"type":"text","value":" information first)."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"get-value-from-your-own-data-with-gdpr-data-portability-requirements","depth":3,"text":"Get value from your own data with GDPR data portability requirements"}]}},"_type":"markdown","_id":"content:posts:using-your-own-data-for-value.md","_source":"content","_file":"posts/using-your-own-data-for-value.md","_extension":"md","sitemap":{"loc":"/posts/using-your-own-data-for-value","images":[]}},{"_path":"/posts/getting-started-with-cd","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Getting Started With CD","description":"Working with devops things like setting up custom CI/CD for my projects honestly scares the shit out of me. Once I start reading about how to do it, I realize how much I don't know. It's also so much harder to tinker with than just code, where you get instant feedback, and can debug. Tinkering with cloudformations, docker images, or virtual machines requires building and running them. Takes much longer time. There's also the sense of never being good enough. You start with a simple manual deployment method on Firebase or Heroku. Maybe you can use a hosted database on something like mLab. You can even make Heroku listen to your repo on Github. Works well, but it gets expensive if you want to scale. So I turn to using Docker and a virtual machine on Digital Ocean. I quickly realize just Docker is not enough. I need Docker Compose which complicates things a little bit. I also need to handle images, tags, expose, networks, etc. which I arrogantly think I can handle without taking the time to really learn what the are. I realize I need a place to host docker images, as Docker Hub only gives you one free private image. So I start making my own image repository on a virtual server. It needs to be served over HTTPS, so I also need to host an Nginx reverse proxy with Letsencrypt. I would be so lost here if there weren't for some great guides on how to do this. After some messing around with different Docker Compose versions I figure it out. I also learnt how easy it can be to get a certified HTTPS using these tools.","date":"2018-10-13T02:15:11.000Z","language":"english","type":"post","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Working with devops things like setting up custom CI/CD for my projects honestly scares the shit out of me. Once I start reading about how to do it, I realize how much I don't know. It's also so much harder to tinker with than just code, where you get instant feedback, and can debug. Tinkering with cloudformations, docker images, or virtual machines requires building and running them. Takes much longer time. There's also the sense of never being good enough. You start with a simple manual deployment method on Firebase or Heroku. Maybe you can use a hosted database on something like mLab. You can even make Heroku listen to your repo on Github. Works well, but it gets expensive if you want to scale. So I turn to using Docker and a virtual machine on Digital Ocean. I quickly realize just Docker is not enough. I need Docker Compose which complicates things a little bit. I also need to handle images, tags, expose, networks, etc. which I arrogantly think I can handle without taking the time to really learn what the are. I realize I need a place to host docker images, as Docker Hub only gives you one free private image. So I start making my own image repository on a virtual server. It needs to be served over HTTPS, so I also need to host an Nginx reverse proxy with Letsencrypt. I would be so lost here if there weren't for some "},{"type":"element","tag":"a","props":{"href":"https://github.com/evertramos/docker-compose-letsencrypt-nginx-proxy-companion","rel":["nofollow"]},"children":[{"type":"text","value":"great guides on how to do this"}]},{"type":"text","value":". After some messing around with different Docker Compose versions I figure it out. I also learnt how easy it can be to get a certified HTTPS using these tools."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Back to CI/CD. I tried to host a docker version of Strapi. It has a quite strange deployment method, as the configuration and code base can be changed both on the live version through a web ui, and by actually coding on your local machine. When deploying changes, I need to ssh into the vm, pull a repo from Github, and then restart a Docker container which loads the repo as a volume. I thought of using Jenkins for this, but I heard some great things about Gitlab CI. It works well, and Gitlab seems quite amazing. Even though it's a little clumsy, I look forward to learning how to use Gitlab effectively."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I really start to fall off when I see the peaks ahead of me. I can do some ssh-ing, some Git pulling, some Docker building, even some Docker composing. But what is this Kubernetes, Docker Swarm, Terraform, those huge Cloud Formation files. Oh my god, all the configuration. Hopefully, I can take the next step on the stair ladder to becoming a decent devopser. Or maybe I should just focus on developing and creating products, and just use Heroku, and hosted services for everything."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:getting-started-with-cd.md","_source":"content","_file":"posts/getting-started-with-cd.md","_extension":"md","sitemap":{"loc":"/posts/getting-started-with-cd","images":[]}},{"_path":"/posts/build-small-website","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"How to build a small and manageable website cheaply and with flexibility","description":"There are many complex or expensive ways to build websites. What about a simple and cheap way?","date":"2018-10-11T05:52:06.000Z","draft":false,"language":"english","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Building a website is quite easy. Just some HTML, CSS and Javascript and you can make quite great things. Hosting it is also quite easy and often cost no money either, like when you use something like Firebase free tier. Making a website, hosting it, and managing content is where it's starting to get more difficult. You will need a CMS of some sort. Traditionally this locked you into a large framework such as Wordpress, Drupal or Squarespace, but quite recent inventions such as static site generators and headless CMSs mitigate that. As clients are not only web browsers anymore, but mobile devices, smart TVs, home assistants, and more, many projects require a headless CMS. Having complete ownership of your content with the possibility to migrate it anywhere is also a requirement for many of us. A static site generator or some CMSs will give you that. A problem with SSGs is that they can be quite inflexible with regards to what technologies you can use on the front end. Just using Babel and SASS in a Hugo project will turn the default superfast generator into a multistep, complicated, Webpack-configured mess."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"My ideal setup would be something like Squarespace where I have full ownership and control over the content, and I'm free to use whatever frontend I want to. It should have"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Serve content from the cloud with a restful api (like a headless CMS)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Be editable in the cloud (like Wordpress or Squarespace)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Be able to migrate all the content (like a self-hosted database or static site generator)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Be able to host wherever I want"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Having all this means that the data will have to live somewhere on the internet. Either a database, a Git repo, or a decentralized storage such as IPFS*. Unless all content is served dynamically through a headless CMS, we need a building step to build the static site. Services like NetlifyCMS and Forestry does this for you. After building is deployment. NetlifyCMS and Foresty do this for you, too, but I'm not sure how flexible they are with where you can deploy it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Strapi.io is an open-source Node CMS that you can host yourself, adding as many users as you want for no extra cost. Editing some content can trigger a hook that will build and deploy a static site with that data, or a completely dynamic client will be updated immediately. Sanity.io is a very similar but closed-source CMS. It provides a hosted backend for the content, but is quite pricey for hobbyists."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So, while there is no perfect stack for all projects, it's useful to be able to make a good decision on the stack you choose for whatever project you're working on. If it's something small that only you are going to update, it's probably best to just use a static site generator or a single page app based on your favorite framework. Just remember to host it on Github and write a readme for how to build and deploy it, so that everything is smooth when you switch to a new computer. If you don't wanna open an editor and do the build and deploy steps on your computer, you need to be able to edit, build, and deploy in the cloud. For a small project, maybe it's just best to use Netlify or Forestry with their free-tier. If you have bigger plans, and you're trying to make something scalable, you need to be more creative. Maybe you plan to have many users with different privileges. Maybe you want backups, many different data types with special widget editors. Maybe the pricing plans of the services don't work for you. Maybe you have an agency or want to create a platform for making a special kind of website. I really don't know how to handle this. Using different services might lock you in and be expensive. Hosting your own things have their own kinds of problems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'll try to experiment and build some more, and try to write about how it went."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"* These technologies are cutting edge and not widely used at all, but it's very interesting to see how people experiment with them. If someone creates a user-friendly way to save something on IPFS with high availability (Fileocoin), it might open up a swath of new possibilities in static site hosting. Imagine just storing a complete static site project on IPFS, make changes and build the entire site in the browser. The site can then be previewed and deployed directly to IPFS. It will only require authentication with a private key that can be retrieved with a username-password or 2fa behind a cloud function or something. CMS, editor, building, deployment – all in the browser accessible from anywhere."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:build-small-website.md","_source":"content","_file":"posts/build-small-website.md","_extension":"md","sitemap":{"loc":"/posts/build-small-website","images":[]}},{"_path":"/posts/gdpr-kvitteringer","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"GDPR og dine kvitteringer","description":"EU sitt direktiv om personvern på nett har nå trådt i kraft og er blitt en del av norsk lov under personopplysningsloven. Som del av dette skal alle som har data lagret om seg ha rett til innsyn i deres data, og kanskje viktigere, ha “... rett til å motta personopplysninger ...  i et strukturert, alminnelig anvendt og maskinlesbart format ...”. Videre hintes det til at slik data skal kunne overføres automatisk fra en tilbyder til en annen “... ha rett til å få overført personopplysningene direkte fra en behandlingsansvarlig til en annen.” [Artikkel 20] Dette med data i maskinlesbart format betyr at en app skal kunne lese og bruke dataene, slik at man skal kunne bytte tilbyder, eller la en annen tilbyder bruke din data, på en enkel måte. Et fint ord som brukes til å beskrive dette er dataportabilitet. For eksempel skal det da være mulig å automatisk sende hele Facebook-profilen din til Google+, eller overføre alle preferansene dine fra hotels.com til booking.com.","date":"2018-09-14T13:41:53.000Z","language":"norwegian","draft":false,"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"EU sitt direktiv om personvern på nett har nå trådt i kraft og er blitt en del av norsk lov under "},{"type":"element","tag":"a","props":{"href":"https://lovdata.no/dokument/NL/lov/2018-06-15-38","rel":["nofollow"]},"children":[{"type":"text","value":"personopplysningsloven"}]},{"type":"text","value":". Som del av dette skal alle som har data lagret om seg ha rett til innsyn i deres data, og kanskje viktigere, ha "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"“"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"..."}]},{"type":"text","value":" rett til å motta personopplysninger "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"..."}]},{"type":"text","value":"  i et strukturert, alminnelig anvendt og maskinlesbart format "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"..."}]},{"type":"text","value":"”"}]},{"type":"text","value":". Videre hintes det til at slik data skal kunne overføres automatisk fra en tilbyder til en annen "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"“"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"..."}]},{"type":"text","value":" ha rett til å få overført personopplysningene direkte fra en behandlingsansvarlig til en annen.”"}]},{"type":"text","value":" ["},{"type":"element","tag":"a","props":{"href":"https://lovdata.no/NL/lov/2018-06-15-38/gdpr/a20","rel":["nofollow"]},"children":[{"type":"text","value":"Artikkel 20"}]},{"type":"text","value":"] Dette med data i maskinlesbart format betyr at en app skal kunne lese og bruke dataene, slik at man skal kunne bytte tilbyder, eller la en annen tilbyder bruke din data, på en enkel måte. Et fint ord som brukes til å beskrive dette er dataportabilitet. For eksempel skal det da være mulig å automatisk sende hele Facebook-profilen din til Google+, eller overføre alle preferansene dine fra hotels.com til booking.com."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vi skal bruke Rema 1000 sin Æ app som eksempel på hvordan denne loven kan gi deg som kunde mulighet til å analysere egne data på en måte som ikke var mulig før."}]},{"type":"element","tag":"img","props":{"alt":"Skjermdump fra Rema 1000 sin Æ-app som viser hvordan man kan be om opplysninger","src":"/posts/gdpr-kvitteringer/rema-ae-give-innsyn-data.png","style":"width: 200px; display: inline; aspect-ratio: 1080/1920;"},"children":[]},{"type":"element","tag":"img","props":{"alt":"Skjermdump fra Rema 1000 sin Æ-app som viser hvordan man ber om maskinlesbare opplysninger","src":"/posts/gdpr-kvitteringer/rema-ae-send-data-email.png","style":"width: 200px; display: inline; aspect-ratio: 1080/1920;"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Rema følger så vidt jeg kan se GDPR til punkt og prikke, og har attpåtil veldig bra brukergrensesnitt. Mange andre selskaper prøver å hindre deres brukere i å få tilgang til data til tross for loven."}]},{"type":"text","value":" *"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Butikkene lagrer og bruker data om kundene sine til å optimalisere sitt sortiment og sine priser. De kan f eks analysere når på dagen visse grupper handler visse varer. For å få til dette må de lagre data om produktene kunder kjøper, som er omtrent alt som står på papirkvitteringen man får i kassa. Derfor kan man få utlevert strukturert og utfyllende data om alle varer man har kjøpt fra Rema. Dette kan man importere til et regneark som excel og analysere selv, eller bruke en tjeneste eller app som gjør dette for deg. Jeg er både interessert i privatøkonomi og dagligvarehandelen, så dette er som en gullgruve av interessant data for meg. Det vil f eks være potensiale til å sammenligne priser og varer mellom alle dagligvarehandler, finne ut hva man bruker unødvendig mye på, automatisk trekke fra noen varer dersom man handler med en felles famlie- eller bofelleskapskonto, osv. Med et lengre tidsperspektiv vil man også i fremtiden kunne analysere dagligvarehandelen sin gjennom flere tiår."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Digitale kvitteringer er utrolig kjekt, men ikke noe nytt. Tidligere har butikker hatt retten til å bestemme om de vil gi deg en digital kvittering eller ikke. Nå må i praksis alle butikker som har et kundefordelsprogram utlevere en til sine kunder."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"* Dette gjøres bl.a. ved å lage dårlig brukergrensesnitt, ikke tilby maskinlesbar data, eller bruke sin rett til å ikke gi opplysningene før om 30 dager. Det skal også sies at mange selskaper sliter med å følge GDPR pga. manglende IT-ressurser og reelle tekniske utfordringer."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:gdpr-kvitteringer:index.md","_source":"content","_file":"posts/gdpr-kvitteringer/index.md","_extension":"md","sitemap":{"loc":"/posts/gdpr-kvitteringer","images":[{"loc":"/posts/gdpr-kvitteringer/rema-ae-give-innsyn-data.png"},{"loc":"/posts/gdpr-kvitteringer/rema-ae-send-data-email.png"}]}},{"_path":"/posts/2018-07-25-eu-e-bikes-and-premature-regulation","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"EU, e-bikes and premature regulation","description":"","date":"2018-07-25 15:40:32 +0000","categories":["eu","regulation","electric","vehicle","bicycle","scooter","transportation","urban planning","china"],"layout":"post","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"lost-opportunities-in-innovation-from-regulation-and-legacy-law"},"children":[{"type":"text","value":"Lost opportunities in innovation from regulation and legacy law"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I’m a big fan of using bicycles as a means of transportation. Not only is it the most efficient means humans can move themselves with, it’s also environmental and good exercise. It also puts people out there in the open. Exposed to nature and other people. Not locked into noisy cars, in bubbles separated from the rest of the world. I really wish bicycles and similar tools were used much more in urban and suburban environments."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some politicians and urban planners also think like that. Some have been more successful than everybody else. I’m thinking of course of Denmark and the Netherlands, where urban planners carefully designed transportation veins so that citizens would prefer using bicycles."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I lived one year in China where I experienced all the innovation going on around electric vehicles from scooters, hoverboards, bicycles among other peculiar devices on wheels. Both genius and terrible ideas will flourish when enterprise is free, components are commoditized and regulation low."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I want to focus on the regulation aspect of innovative electric vehicles and urban planning in the EU. Before anyone had even heard about electric bicycles, hoverboards, or segways, the EU and already put in place extensive regulations about how these inventions could be used, and which were forbidden. One can wonder how regulators can be so wise to know exactly how to regulate technology that has not even been tried in any meaningful scale yet. who knows which genius inventions were with good faith made illegal by regulations because they never had a chance to be tried."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The 2002/24/EC EU directive categorized electric vehicles that stop their torque at 25km/h and does not give power when the rider is not pedaling herself, as regular bicycles and not mopeds or other motor vehicles. As with all EU directives, member states can add their tweaks, but it has become the standard for most countries in the European market."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The directive has been implemented gradually by member states since its introduction in 2002. I think I saw an electric bicycle for the first time in 2014, as they were getting more and more common. It’s pretty amazing that the directive was already 12 years old by that time. I’m sure the regulators are great people, but do anyone have that kind of foresight?"}]},{"type":"element","tag":"h2","props":{"id":"what-china-does"},"children":[{"type":"text","value":"What China does"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"China is in a special situation with regards to electric bicycles and other innovative small, electric vehicles. First, most of the components needed to make such vehicles are made in China and sold cheaply by producers who are very flexible and fast when it comes to product design and redesign. Second, the country is undergoing a massive urbanization. Many will buy their first vehicle ever, and even be the first person in their family to own a  motorized vehicle. Most of the urban population are very familiar with one speed bicycles, but small motorcycles and cars to a lesser degree became common from the 90s. I suspect the bicycle usage in China hit a bottom right before the dockless bicycle sharing craze started in 2016. Third, regulation has been lax with regards to electric vehicles for the most part. Like other (South) East Asian countries, motorbikes were king in China before the main urban centers started severely restricting their use. It’s notoriously hard to get a registration plate for cars in the tier 1 cities, and even harder to get a motorcycle plate. Electric mopeds are currently the dominating vehicle for the “low-end” population, such as migrant workers, but also students, in major cities. They are cheap, widely available and not regulated all too much. They are also produced domestically and sometimes encouraged by local governments. In the countryside and minor urban centers, where gasoline powered motorcycles and mopeds are not restricted, their noisy and polluting cousins dominate, which is a testimony to that the market would prefer these for now. There are also some electric bicycles with pedals that look and feel more like bicycles than mopeds. They are different from their European counterparts in that they will give torque even when the rider is not pedalling, just like a motorbike."}]},{"type":"element","tag":"h2","props":{"id":"what-are-we-missing"},"children":[{"type":"text","value":"What are we missing?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Other commonly used small electric vehicles include segways, airwheels, hoverboards, kick scooters, and variations of these are in a legal gray area in the EU. According to EU regulations, if they are faster than 6km/h, are not toys for children, or intended for off-road, competitive or industrial use, they are not legal. The 2002 directive only covers pedal-powered vehicles, which kick scooters are not. In the UK, their legal state depends in the interpretation The Highways Act  of 1835(!). Perhaps Europeans take laws too seriously, while in China there are laws for everything, but only a few are enforced and the rest ignored. I remember kick scooters being common in China for commuters working or living in some distance from metro and bus stations. They are reasonably fast and safe for anyone, can be brought on a bus or metro car, and quite cheap. I will end with some good news from my home country Norway. As of April 2018, small electric vehicles weighing less than 70kg and driving slower than 20km/h are regulated as bicycles. That means anyone of any age can use them, using helmet is recommended, but optional. The only requirements are of breaks, reflective tape and a bell if it can be mounted. I hope the San Francisco scooter rental companies realize where their next market is."}]},{"type":"element","tag":"h4","props":{"id":"sources"},"children":[{"type":"text","value":"Sources"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Electric_bicycle_laws","rel":["nofollow"]},"children":[{"type":"text","value":"Wikipedia laws on electric bicycles"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://ec.europa.eu/growth/sectors/automotive/legislation/motorbikes-trikes-quads_en","rel":["nofollow"]},"children":[{"type":"text","value":"EU directives about light vehicles"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://ec.europa.eu/energy/intelligent/projects/sites/iee-projects/files/projects/documents/presto_fact_sheet_legislation_en.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"EU legislature on light vehicles"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://ec.europa.eu/docsroom/documents/18992/attachments/1/translations/en/renditions/native","rel":["nofollow"]},"children":[{"type":"text","value":"EU guidance on scooters"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.regjeringen.no/no/aktuelt/sma-elektriske-kjoretoy-blir-likestilt-med-sykkel/id2596831/","rel":["nofollow"]},"children":[{"type":"text","value":"Norway equates small e-vehicles with bicycles"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"lost-opportunities-in-innovation-from-regulation-and-legacy-law","depth":2,"text":"Lost opportunities in innovation from regulation and legacy law"},{"id":"what-china-does","depth":2,"text":"What China does"},{"id":"what-are-we-missing","depth":2,"text":"What are we missing?"}]}},"_type":"markdown","_id":"content:posts:2018-07-25-eu-e-bikes-and-premature-regulation.md","_source":"content","_file":"posts/2018-07-25-eu-e-bikes-and-premature-regulation.md","_extension":"md","sitemap":{"loc":"/posts/2018-07-25-eu-e-bikes-and-premature-regulation","images":[]}}]