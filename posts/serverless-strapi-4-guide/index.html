<!DOCTYPE html>
<html  lang="en">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AWS Lambda Serverless Strapi 4 Guide</title>
<meta name="twitter:card" content="summary_large_image">
<meta property="og:image" content="/social-card-preview.png">
<meta property="og:image:width" content="400">
<meta property="og:image:height" content="300">
<meta property="og:image:alt" content="An image showcasing my project.">
<meta property="og:title" content="AWS Lambda Serverless Strapi 4 Guide">
<meta name="description" content="The code for this guide is in this Github repo.">
<meta property="og:description" content="The code for this guide is in this Github repo.">
<link rel="preload" as="fetch" crossorigin="anonymous" href="/posts/serverless-strapi-4-guide/_payload.json">
<link rel="stylesheet" href="/_nuxt/entry.97ab6348.css">
<link rel="stylesheet" href="/_nuxt/DocumentDrivenNotFound.17085fcb.css">
<link rel="stylesheet" href="/_nuxt/ProseP.2188f7db.css">
<link rel="stylesheet" href="/_nuxt/ProseA.f70b28a1.css">
<link rel="stylesheet" href="/_nuxt/ProseH2.b565e694.css">
<link rel="stylesheet" href="/_nuxt/ProseUl.dbdeb511.css">
<link rel="stylesheet" href="/_nuxt/ProseLi.fd79bc46.css">
<link rel="stylesheet" href="/_nuxt/ProsePre.e63e49c6.css">
<link rel="stylesheet" href="/_nuxt/ProseCode.91016173.css">
<link rel="stylesheet" href="/_nuxt/ProseImg.4753ea4a.css">
<link rel="stylesheet" href="/_nuxt/ProseCodeInline.46b97b4c.css">
<link rel="stylesheet" href="/_nuxt/ProseEm.e73a4b12.css">
<link rel="stylesheet" href="/_nuxt/ProseH3.9316dd33.css"><style id="pinceau-runtime-hydratable">@media{.phy[--]{--puid:Uzit8l-v;}.pv-P0h2ZQ{max-width:var(--elements-container-maxWidth);padding-left:var(--elements-container-padding-mobile);padding-right:var(--elements-container-padding-mobile);}@media (min-width: 475px){.pv-P0h2ZQ{padding-left:var(--elements-container-padding-xs);padding-right:var(--elements-container-padding-xs);}}@media (min-width: 640px){.pv-P0h2ZQ{padding-left:var(--elements-container-padding-sm);padding-right:var(--elements-container-padding-sm);}}@media (min-width: 768px){.pv-P0h2ZQ{padding-left:var(--elements-container-padding-md);padding-right:var(--elements-container-padding-md);}}} </style><style id="pinceau-theme">@media { :root {--pinceau-mq: initial; --alpine-readableLine: 68ch;--alpine-backdrop-backgroundColor: #f4f4f5b3;--prose-code-inline-padding: 0.2rem 0.375rem 0.2rem 0.375rem;--prose-code-block-backdropFilter: contrast(1);--prose-code-block-border-style: solid;--prose-code-block-border-width: 1px;--prose-tbody-tr-borderBottom-style: dashed;--prose-tbody-tr-borderBottom-width: 1px;--prose-th-textAlign: inherit;--prose-thead-borderBottom-style: solid;--prose-thead-borderBottom-width: 1px;--prose-thead-border-style: solid;--prose-thead-border-width: 0px;--prose-table-textAlign: start;--prose-hr-width: 1px;--prose-hr-style: solid;--prose-li-listStylePosition: outside;--prose-ol-li-markerColor: currentColor;--prose-ol-paddingInlineStart: 21px;--prose-ol-listStyleType: decimal;--prose-ul-li-markerColor: currentColor;--prose-ul-paddingInlineStart: 21px;--prose-ul-listStyleType: disc;--prose-blockquote-border-style: solid;--prose-blockquote-border-width: 4px;--prose-blockquote-quotes: '201C' '201D' '2018' '2019';--prose-blockquote-paddingInlineStart: 24px;--prose-a-code-color-hover: currentColor;--prose-a-code-color-static: currentColor;--prose-a-hasCode-borderBottom: none;--prose-a-border-distance: 2px;--prose-a-border-color-hover: currentColor;--prose-a-border-color-static: currentColor;--prose-a-border-style-hover: solid;--prose-a-border-style-static: dashed;--prose-a-border-width: 1px;--prose-a-color-static: inherit;--prose-a-textDecoration: none;--prose-h6-margin: 3rem 0 2rem;--prose-h5-margin: 3rem 0 2rem;--prose-h4-margin: 3rem 0 2rem;--prose-h3-margin: 3rem 0 2rem;--prose-h2-margin: 3rem 0 2rem;--prose-h1-margin: 0 0 2rem;--prose-p-fontSize: 18px;--typography-lead-loose: 2;--typography-lead-relaxed: 1.625;--typography-lead-normal: 1.5;--typography-lead-snug: 1.375;--typography-lead-tight: 1.25;--typography-lead-none: 1;--typography-lead-10: 2.5rem;--typography-lead-9: 2.25rem;--typography-lead-8: 2rem;--typography-lead-7: 1.75rem;--typography-lead-6: 1.5rem;--typography-lead-5: 1.25rem;--typography-lead-4: 1rem;--typography-lead-3: .75rem;--typography-lead-2: .5rem;--typography-lead-1: .025rem;--typography-fontWeight-black: 900;--typography-fontWeight-extrabold: 800;--typography-fontWeight-bold: 700;--typography-fontWeight-semibold: 600;--typography-fontWeight-medium: 500;--typography-fontWeight-normal: 400;--typography-fontWeight-light: 300;--typography-fontWeight-extralight: 200;--typography-fontWeight-thin: 100;--typography-fontSize-9xl: 128px;--typography-fontSize-8xl: 96px;--typography-fontSize-7xl: 72px;--typography-fontSize-6xl: 60px;--typography-fontSize-5xl: 48px;--typography-fontSize-4xl: 36px;--typography-fontSize-3xl: 30px;--typography-fontSize-2xl: 24px;--typography-fontSize-xl: 20px;--typography-fontSize-lg: 18px;--typography-fontSize-base: 16px;--typography-fontSize-sm: 14px;--typography-fontSize-xs: 12px;--typography-letterSpacing-wide: 0.025em;--typography-letterSpacing-tight: -0.025em;--typography-verticalMargin-base: 24px;--typography-verticalMargin-sm: 16px;--elements-border-secondary-hover: [object Object];--elements-backdrop-background: #fffc;--elements-backdrop-filter: saturate(200%) blur(20px);--elements-container-maxWidth: 64rem;--lead-loose: 2;--lead-relaxed: 1.625;--lead-normal: 1.5;--lead-snug: 1.375;--lead-tight: 1.25;--lead-none: 1;--lead-10: 2.5rem;--lead-9: 2.25rem;--lead-8: 2rem;--lead-7: 1.75rem;--lead-6: 1.5rem;--lead-5: 1.25rem;--lead-4: 1rem;--lead-3: .75rem;--lead-2: .5rem;--lead-1: .025rem;--letterSpacing-widest: 0.1em;--letterSpacing-wider: 0.05em;--letterSpacing-wide: 0.025em;--letterSpacing-normal: 0em;--letterSpacing-tight: -0.025em;--letterSpacing-tighter: -0.05em;--fontSize-9xl: 8rem;--fontSize-8xl: 6rem;--fontSize-7xl: 4.5rem;--fontSize-6xl: 3.75rem;--fontSize-5xl: 3rem;--fontSize-4xl: 2.25rem;--fontSize-3xl: 1.875rem;--fontSize-2xl: 1.5rem;--fontSize-xl: 1.25rem;--fontSize-lg: 1.125rem;--fontSize-base: 1rem;--fontSize-sm: 0.875rem;--fontSize-xs: 0.75rem;--fontWeight-black: 900;--fontWeight-extrabold: 800;--fontWeight-bold: 700;--fontWeight-semibold: 600;--fontWeight-medium: 500;--fontWeight-normal: 400;--fontWeight-light: 300;--fontWeight-extralight: 200;--fontWeight-thin: 100;--font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace;--font-serif: ui-serif, Georgia, Cambria, Times New Roman, Times, serif;--font-sans: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;--opacity-total: 1;--opacity-high: 0.8;--opacity-medium: 0.5;--opacity-soft: 0.3;--opacity-light: 0.15;--opacity-bright: 0.1;--opacity-noOpacity: 0;--borderWidth-lg: 3px;--borderWidth-md: 2px;--borderWidth-sm: 1px;--borderWidth-noBorder: 0;--space-rem-875: 0.875rem;--space-rem-625: 0.625rem;--space-rem-375: 0.375rem;--space-rem-125: 0.125rem;--space-px: 1px;--space-128: 32rem;--space-96: 24rem;--space-80: 20rem;--space-72: 18rem;--space-64: 16rem;--space-60: 15rem;--space-56: 14rem;--space-52: 13rem;--space-48: 12rem;--space-44: 11rem;--space-40: 10rem;--space-36: 9rem;--space-32: 8rem;--space-28: 7rem;--space-24: 6rem;--space-20: 5rem;--space-16: 4rem;--space-14: 3.5rem;--space-12: 3rem;--space-11: 2.75rem;--space-10: 2.5rem;--space-9: 2.25rem;--space-8: 2rem;--space-7: 1.75rem;--space-6: 1.5rem;--space-5: 1.25rem;--space-4: 1rem;--space-3: 0.75rem;--space-2: 0.5rem;--space-1: 0.25rem;--space-0: 0px;--size-full: 100%;--size-7xl: 80rem;--size-6xl: 72rem;--size-5xl: 64rem;--size-4xl: 56rem;--size-3xl: 48rem;--size-2xl: 42rem;--size-xl: 36rem;--size-lg: 32rem;--size-md: 28rem;--size-sm: 24rem;--size-xs: 20rem;--size-200: 200px;--size-104: 104px;--size-80: 80px;--size-64: 64px;--size-56: 56px;--size-48: 48px;--size-40: 40px;--size-32: 32px;--size-24: 24px;--size-20: 20px;--size-16: 16px;--size-12: 12px;--size-8: 8px;--size-6: 6px;--size-4: 4px;--size-2: 2px;--size-0: 0px;--radii-full: 9999px;--radii-3xl: 1.75rem;--radii-2xl: 1.5rem;--radii-xl: 1rem;--radii-lg: 0.75rem;--radii-md: 0.5rem;--radii-sm: 0.375rem;--radii-xs: 0.25rem;--radii-2xs: 0.125rem;--radii-none: 0px;--shadow-none: 0px 0px 0px 0px transparent;--shadow-lg: 0px 10px 15px -3px #000000, 0px 4px 6px -4px #000000;--shadow-md: 0px 4px 6px -1px #000000, 0px 2px 4px -2px #000000;--shadow-sm: 0px 1px 3px 0px #000000, 0px 1px 2px -1px #000000;--shadow-xs: 0px 1px 2px 0px #000000;--height-screen: 100vh;--width-screen: 100vw;--color-primary-900: #002e38;--color-primary-800: #005c70;--color-primary-700: #008aa9;--color-primary-600: #00b9e1;--color-primary-500: #1ad6ff;--color-primary-400: #40ddff;--color-primary-300: #66e4ff;--color-primary-200: #8deaff;--color-primary-100: #b3f1ff;--color-primary-50: #d9f8ff;--color-ruby-900: #380011;--color-ruby-800: #700021;--color-ruby-700: #a90032;--color-ruby-600: #e10043;--color-ruby-500: #ff1a5e;--color-ruby-400: #ff4079;--color-ruby-300: #ff6694;--color-ruby-200: #ff8dae;--color-ruby-100: #ffb3c9;--color-ruby-50: #ffd9e4;--color-pink-900: #380025;--color-pink-800: #70004b;--color-pink-700: #a90070;--color-pink-600: #e10095;--color-pink-500: #ff1ab2;--color-pink-400: #ff40bf;--color-pink-300: #ff66cc;--color-pink-200: #ff8dd8;--color-pink-100: #ffb3e5;--color-pink-50: #ffd9f2;--color-purple-900: #190038;--color-purple-800: #330070;--color-purple-700: #4c00a9;--color-purple-600: #6500e1;--color-purple-500: #811aff;--color-purple-400: #9640ff;--color-purple-300: #ab66ff;--color-purple-200: #c08dff;--color-purple-100: #d5b3ff;--color-purple-50: #ead9ff;--color-royalblue-900: #0b0531;--color-royalblue-800: #160a62;--color-royalblue-700: #211093;--color-royalblue-600: #2c15c4;--color-royalblue-500: #4127e8;--color-royalblue-400: #614bec;--color-royalblue-300: #806ff0;--color-royalblue-200: #a093f3;--color-royalblue-100: #c0b7f7;--color-royalblue-50: #dfdbfb;--color-indigoblue-900: #001238;--color-indigoblue-800: #002370;--color-indigoblue-700: #0035a9;--color-indigoblue-600: #0047e1;--color-indigoblue-500: #1a62ff;--color-indigoblue-400: #407cff;--color-indigoblue-300: #6696ff;--color-indigoblue-200: #8db0ff;--color-indigoblue-100: #b3cbff;--color-indigoblue-50: #d9e5ff;--color-blue-900: #002438;--color-blue-800: #004870;--color-blue-700: #006ca9;--color-blue-600: #0090e1;--color-blue-500: #1aadff;--color-blue-400: #40bbff;--color-blue-300: #66c8ff;--color-blue-200: #8dd6ff;--color-blue-100: #b3e4ff;--color-blue-50: #d9f1ff;--color-lightblue-900: #002e38;--color-lightblue-800: #005c70;--color-lightblue-700: #008aa9;--color-lightblue-600: #00b9e1;--color-lightblue-500: #1ad6ff;--color-lightblue-400: #40ddff;--color-lightblue-300: #66e4ff;--color-lightblue-200: #8deaff;--color-lightblue-100: #b3f1ff;--color-lightblue-50: #d9f8ff;--color-teal-900: #062a28;--color-teal-800: #0b544f;--color-teal-700: #117d77;--color-teal-600: #16a79e;--color-teal-500: #1cd1c6;--color-teal-400: #36e4da;--color-teal-300: #5fe9e1;--color-teal-200: #87efe9;--color-teal-100: #aff4f0;--color-teal-50: #d7faf8;--color-pear-900: #2a2b09;--color-pear-800: #545512;--color-pear-700: #7e801b;--color-pear-600: #a8aa24;--color-pear-500: #d0d32f;--color-pear-400: #d8da52;--color-pear-300: #e0e274;--color-pear-200: #e8e997;--color-pear-100: #eff0ba;--color-pear-50: #f7f8dc;--color-red-900: #380300;--color-red-800: #700700;--color-red-700: #a90a00;--color-red-600: #e10e00;--color-red-500: #ff281a;--color-red-400: #ff4c40;--color-red-300: #ff7066;--color-red-200: #ff948d;--color-red-100: #ffb7b3;--color-red-50: #ffdbd9;--color-orange-900: #381800;--color-orange-800: #702f00;--color-orange-700: #a94700;--color-orange-600: #e15e00;--color-orange-500: #ff7a1a;--color-orange-400: #ff9040;--color-orange-300: #ffa666;--color-orange-200: #ffbd8d;--color-orange-100: #ffd3b3;--color-orange-50: #ffe9d9;--color-yellow-900: #362b03;--color-yellow-800: #6d5605;--color-yellow-700: #a38108;--color-yellow-600: #daac0a;--color-yellow-500: #f5c828;--color-yellow-400: #f7d14c;--color-yellow-300: #f8da70;--color-yellow-200: #fae393;--color-yellow-100: #fcedb7;--color-yellow-50: #fdf6db;--color-green-900: #003f25;--color-green-800: #005e38;--color-green-700: #007e4a;--color-green-600: #009d5d;--color-green-500: #00bd6f;--color-green-400: #00dc82;--color-green-300: #30ffaa;--color-green-200: #83ffcc;--color-green-100: #acffdd;--color-green-50: #d6ffee;--color-gray-900: #18181B;--color-gray-800: #27272A;--color-gray-700: #3f3f46;--color-gray-600: #52525B;--color-gray-500: #71717A;--color-gray-400: #a1a1aa;--color-gray-300: #D4d4d8;--color-gray-200: #e4e4e7;--color-gray-100: #f4f4f5;--color-gray-50: #fafafa;--color-black: #0c0c0d;--color-white: #FFFFFF;--media-portrait: only screen and (orientation: portrait);--media-landscape: only screen and (orientation: landscape);--media-rm: (prefers-reduced-motion: reduce);--media-2xl: (min-width: 1536px);--media-xl: (min-width: 1280px);--media-lg: (min-width: 1024px);--media-md: (min-width: 768px);--media-sm: (min-width: 640px);--media-xs: (min-width: 475px);--alpine-body-color: var(--color-gray-800);--alpine-body-backgroundColor: var(--color-white);--prose-code-inline-fontWeight: var(--typography-fontWeight-normal);--prose-code-inline-fontSize: var(--typography-fontSize-sm);--prose-code-inline-borderRadius: var(--radii-xs);--prose-code-block-pre-padding: var(--typography-verticalMargin-sm);--prose-code-block-margin: var(--typography-verticalMargin-base) 0;--prose-code-block-fontSize: var(--typography-fontSize-sm);--prose-tbody-code-inline-fontSize: var(--typography-fontSize-sm);--prose-tbody-td-padding: var(--typography-verticalMargin-sm);--prose-th-fontWeight: var(--typography-fontWeight-semibold);--prose-th-padding: 0 var(--typography-verticalMargin-sm) var(--typography-verticalMargin-sm) var(--typography-verticalMargin-sm);--prose-table-lineHeight: var(--typography-lead-6);--prose-table-fontSize: var(--typography-fontSize-sm);--prose-table-margin: var(--typography-verticalMargin-base) 0;--prose-hr-margin: var(--typography-verticalMargin-base) 0;--prose-li-margin: var(--typography-verticalMargin-sm) 0;--prose-ol-margin: var(--typography-verticalMargin-base) 0;--prose-ul-margin: var(--typography-verticalMargin-base) 0;--prose-blockquote-margin: var(--typography-verticalMargin-base) 0;--prose-a-code-border-style: var(--prose-a-border-style-static);--prose-a-code-border-width: var(--prose-a-border-width);--prose-a-fontWeight: var(--typography-fontWeight-medium);--prose-img-margin: var(--typography-verticalMargin-base) 0;--prose-strong-fontWeight: var(--typography-fontWeight-semibold);--prose-h6-iconSize: var(--typography-fontSize-base);--prose-h6-fontWeight: var(--typography-fontWeight-semibold);--prose-h6-lineHeight: var(--typography-lead-normal);--prose-h6-fontSize: var(--typography-fontSize-lg);--prose-h5-iconSize: var(--typography-fontSize-lg);--prose-h5-fontWeight: var(--typography-fontWeight-semibold);--prose-h5-lineHeight: var(--typography-lead-snug);--prose-h5-fontSize: var(--typography-fontSize-xl);--prose-h4-iconSize: var(--typography-fontSize-lg);--prose-h4-letterSpacing: var(--typography-letterSpacing-tight);--prose-h4-fontWeight: var(--typography-fontWeight-semibold);--prose-h4-lineHeight: var(--typography-lead-snug);--prose-h4-fontSize: var(--typography-fontSize-2xl);--prose-h3-iconSize: var(--typography-fontSize-xl);--prose-h3-letterSpacing: var(--typography-letterSpacing-tight);--prose-h3-fontWeight: var(--typography-fontWeight-semibold);--prose-h3-lineHeight: var(--typography-lead-snug);--prose-h3-fontSize: var(--typography-fontSize-3xl);--prose-h2-iconSize: var(--typography-fontSize-2xl);--prose-h2-letterSpacing: var(--typography-letterSpacing-tight);--prose-h2-fontWeight: var(--typography-fontWeight-semibold);--prose-h2-lineHeight: var(--typography-lead-tight);--prose-h2-fontSize: var(--typography-fontSize-4xl);--prose-h1-iconSize: var(--typography-fontSize-3xl);--prose-h1-letterSpacing: var(--typography-letterSpacing-tight);--prose-h1-fontWeight: var(--typography-fontWeight-bold);--prose-h1-lineHeight: var(--typography-lead-tight);--prose-h1-fontSize: var(--typography-fontSize-5xl);--prose-p-br-margin: var(--typography-verticalMargin-base) 0 0 0;--prose-p-margin: var(--typography-verticalMargin-base) 0;--prose-p-lineHeight: var(--typography-lead-normal);--typography-color-primary-900: var(--color-primary-900);--typography-color-primary-800: var(--color-primary-800);--typography-color-primary-700: var(--color-primary-700);--typography-color-primary-600: var(--color-primary-600);--typography-color-primary-500: var(--color-primary-500);--typography-color-primary-400: var(--color-primary-400);--typography-color-primary-300: var(--color-primary-300);--typography-color-primary-200: var(--color-primary-200);--typography-color-primary-100: var(--color-primary-100);--typography-color-primary-50: var(--color-primary-50);--typography-font-code: var(--font-mono);--typography-font-body: var(--font-sans);--typography-font-display: var(--font-sans);--typography-body-backgroundColor: var(--color-white);--typography-body-color: var(--color-black);--elements-state-danger-borderColor-secondary: var(--color-red-200);--elements-state-danger-borderColor-primary: var(--color-red-100);--elements-state-danger-backgroundColor-secondary: var(--color-red-100);--elements-state-danger-backgroundColor-primary: var(--color-red-50);--elements-state-danger-color-secondary: var(--color-red-600);--elements-state-danger-color-primary: var(--color-red-500);--elements-state-warning-borderColor-secondary: var(--color-yellow-200);--elements-state-warning-borderColor-primary: var(--color-yellow-100);--elements-state-warning-backgroundColor-secondary: var(--color-yellow-100);--elements-state-warning-backgroundColor-primary: var(--color-yellow-50);--elements-state-warning-color-secondary: var(--color-yellow-700);--elements-state-warning-color-primary: var(--color-yellow-600);--elements-state-success-borderColor-secondary: var(--color-green-200);--elements-state-success-borderColor-primary: var(--color-green-100);--elements-state-success-backgroundColor-secondary: var(--color-green-100);--elements-state-success-backgroundColor-primary: var(--color-green-50);--elements-state-success-color-secondary: var(--color-green-600);--elements-state-success-color-primary: var(--color-green-500);--elements-state-info-borderColor-secondary: var(--color-blue-200);--elements-state-info-borderColor-primary: var(--color-blue-100);--elements-state-info-backgroundColor-secondary: var(--color-blue-100);--elements-state-info-backgroundColor-primary: var(--color-blue-50);--elements-state-info-color-secondary: var(--color-blue-600);--elements-state-info-color-primary: var(--color-blue-500);--elements-state-primary-borderColor-secondary: var(--color-primary-200);--elements-state-primary-borderColor-primary: var(--color-primary-100);--elements-state-primary-backgroundColor-secondary: var(--color-primary-100);--elements-state-primary-backgroundColor-primary: var(--color-primary-50);--elements-state-primary-color-secondary: var(--color-primary-700);--elements-state-primary-color-primary: var(--color-primary-600);--elements-surface-secondary-backgroundColor: var(--color-gray-200);--elements-surface-primary-backgroundColor: var(--color-gray-100);--elements-surface-background-base: var(--color-gray-100);--elements-border-secondary-static: var(--color-gray-200);--elements-border-primary-hover: var(--color-gray-200);--elements-border-primary-static: var(--color-gray-100);--elements-container-padding-md: var(--space-16);--elements-container-padding-sm: var(--space-12);--elements-container-padding-xs: var(--space-8);--elements-container-padding-mobile: var(--space-6);--elements-text-secondary-color-hover: var(--color-gray-700);--elements-text-secondary-color-static: var(--color-gray-500);--elements-text-primary-color-static: var(--color-gray-900);--text-6xl-lineHeight: var(--lead-none);--text-6xl-fontSize: var(--fontSize-6xl);--text-5xl-lineHeight: var(--lead-none);--text-5xl-fontSize: var(--fontSize-5xl);--text-4xl-lineHeight: var(--lead-10);--text-4xl-fontSize: var(--fontSize-4xl);--text-3xl-lineHeight: var(--lead-9);--text-3xl-fontSize: var(--fontSize-3xl);--text-2xl-lineHeight: var(--lead-8);--text-2xl-fontSize: var(--fontSize-2xl);--text-xl-lineHeight: var(--lead-7);--text-xl-fontSize: var(--fontSize-xl);--text-lg-lineHeight: var(--lead-7);--text-lg-fontSize: var(--fontSize-lg);--text-base-lineHeight: var(--lead-6);--text-base-fontSize: var(--fontSize-base);--text-sm-lineHeight: var(--lead-5);--text-sm-fontSize: var(--fontSize-sm);--text-xs-lineHeight: var(--lead-4);--text-xs-fontSize: var(--fontSize-xs);--shadow-2xl: 0px 25px 50px -12px var(--color-gray-900);--shadow-xl: 0px 20px 25px -5px var(--color-gray-400), 0px 8px 10px -6px #000000;--color-secondary-900: var(--color-gray-900);--color-secondary-800: var(--color-gray-800);--color-secondary-700: var(--color-gray-700);--color-secondary-600: var(--color-gray-600);--color-secondary-500: var(--color-gray-500);--color-secondary-400: var(--color-gray-400);--color-secondary-300: var(--color-gray-300);--color-secondary-200: var(--color-gray-200);--color-secondary-100: var(--color-gray-100);--color-secondary-50: var(--color-gray-50);--prose-a-code-background-hover: var(--typography-color-primary-50);--prose-a-code-border-color-hover: var(--typography-color-primary-500);--prose-a-color-hover: var(--typography-color-primary-500);--typography-color-secondary-900: var(--color-secondary-900);--typography-color-secondary-800: var(--color-secondary-800);--typography-color-secondary-700: var(--color-secondary-700);--typography-color-secondary-600: var(--color-secondary-600);--typography-color-secondary-500: var(--color-secondary-500);--typography-color-secondary-400: var(--color-secondary-400);--typography-color-secondary-300: var(--color-secondary-300);--typography-color-secondary-200: var(--color-secondary-200);--typography-color-secondary-100: var(--color-secondary-100);--typography-color-secondary-50: var(--color-secondary-50);--prose-code-inline-backgroundColor: var(--typography-color-secondary-100);--prose-code-inline-color: var(--typography-color-secondary-700);--prose-code-block-backgroundColor: var(--typography-color-secondary-100);--prose-code-block-color: var(--typography-color-secondary-700);--prose-code-block-border-color: var(--typography-color-secondary-200);--prose-tbody-tr-borderBottom-color: var(--typography-color-secondary-200);--prose-th-color: var(--typography-color-secondary-600);--prose-thead-borderBottom-color: var(--typography-color-secondary-200);--prose-thead-border-color: var(--typography-color-secondary-300);--prose-hr-color: var(--typography-color-secondary-200);--prose-blockquote-border-color: var(--typography-color-secondary-200);--prose-blockquote-color: var(--typography-color-secondary-500);--prose-a-code-border-color-static: var(--typography-color-secondary-400); } }@media { :root.dark {--pinceau-mq: dark; --alpine-backdrop-backgroundColor: #18181bb3;--prose-code-block-backdropFilter: contrast(1);--prose-ol-li-markerColor: currentColor;--prose-ul-li-markerColor: currentColor;--prose-a-code-color-hover: currentColor;--prose-a-code-color-static: currentColor;--prose-a-border-color-hover: currentColor;--prose-a-border-color-static: currentColor;--prose-a-color-static: inherit;--elements-backdrop-background: #0c0d0ccc;--alpine-body-color: var(--color-gray-200);--alpine-body-backgroundColor: var(--color-black);--typography-body-backgroundColor: var(--color-black);--typography-body-color: var(--color-white);--elements-state-danger-borderColor-secondary: var(--color-red-700);--elements-state-danger-borderColor-primary: var(--color-red-800);--elements-state-danger-backgroundColor-secondary: var(--color-red-800);--elements-state-danger-backgroundColor-primary: var(--color-red-900);--elements-state-danger-color-secondary: var(--color-red-200);--elements-state-danger-color-primary: var(--color-red-300);--elements-state-warning-borderColor-secondary: var(--color-yellow-700);--elements-state-warning-borderColor-primary: var(--color-yellow-800);--elements-state-warning-backgroundColor-secondary: var(--color-yellow-800);--elements-state-warning-backgroundColor-primary: var(--color-yellow-900);--elements-state-warning-color-secondary: var(--color-yellow-200);--elements-state-warning-color-primary: var(--color-yellow-400);--elements-state-success-borderColor-secondary: var(--color-green-700);--elements-state-success-borderColor-primary: var(--color-green-800);--elements-state-success-backgroundColor-secondary: var(--color-green-800);--elements-state-success-backgroundColor-primary: var(--color-green-900);--elements-state-success-color-secondary: var(--color-green-200);--elements-state-success-color-primary: var(--color-green-400);--elements-state-info-borderColor-secondary: var(--color-blue-700);--elements-state-info-borderColor-primary: var(--color-blue-800);--elements-state-info-backgroundColor-secondary: var(--color-blue-800);--elements-state-info-backgroundColor-primary: var(--color-blue-900);--elements-state-info-color-secondary: var(--color-blue-200);--elements-state-info-color-primary: var(--color-blue-400);--elements-state-primary-borderColor-secondary: var(--color-primary-700);--elements-state-primary-borderColor-primary: var(--color-primary-800);--elements-state-primary-backgroundColor-secondary: var(--color-primary-800);--elements-state-primary-backgroundColor-primary: var(--color-primary-900);--elements-state-primary-color-secondary: var(--color-primary-200);--elements-state-primary-color-primary: var(--color-primary-400);--elements-surface-secondary-backgroundColor: var(--color-gray-800);--elements-surface-primary-backgroundColor: var(--color-gray-900);--elements-surface-background-base: var(--color-gray-900);--elements-border-secondary-static: var(--color-gray-800);--elements-border-primary-hover: var(--color-gray-800);--elements-border-primary-static: var(--color-gray-900);--elements-text-secondary-color-hover: var(--color-gray-200);--elements-text-secondary-color-static: var(--color-gray-400);--elements-text-primary-color-static: var(--color-gray-50);--prose-a-code-background-hover: var(--typography-color-primary-900);--prose-a-code-border-color-hover: var(--typography-color-primary-600);--prose-a-color-hover: var(--typography-color-primary-400);--prose-code-inline-backgroundColor: var(--typography-color-secondary-800);--prose-code-inline-color: var(--typography-color-secondary-200);--prose-code-block-backgroundColor: var(--typography-color-secondary-900);--prose-code-block-color: var(--typography-color-secondary-200);--prose-code-block-border-color: var(--typography-color-secondary-800);--prose-tbody-tr-borderBottom-color: var(--typography-color-secondary-800);--prose-th-color: var(--typography-color-secondary-400);--prose-thead-borderBottom-color: var(--typography-color-secondary-800);--prose-thead-border-color: var(--typography-color-secondary-600);--prose-hr-color: var(--typography-color-secondary-800);--prose-blockquote-border-color: var(--typography-color-secondary-700);--prose-blockquote-color: var(--typography-color-secondary-400);--prose-a-code-border-color-static: var(--typography-color-secondary-600); } }</style><script>"use strict";(()=>{const a=window,e=document.documentElement,m=["dark","light"],c=window.localStorage.getItem("nuxt-color-mode")||"system";let n=c==="system"?f():c;const l=e.getAttribute("data-color-mode-forced");l&&(n=l),i(n),a["__NUXT_COLOR_MODE__"]={preference:c,value:n,getColorScheme:f,addColorScheme:i,removeColorScheme:d};function i(o){const t=""+o+"",s="";e.classList?e.classList.add(t):e.className+=" "+t,s&&e.setAttribute("data-"+s,o)}function d(o){const t=""+o+"",s="";e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp(t,"g"),""),s&&e.removeAttribute("data-"+s)}function r(o){return a.matchMedia("(prefers-color-scheme"+o+")")}function f(){if(a.matchMedia&&r("").media!=="not all"){for(const o of m)if(r(":"+o).matches)return o}return"light"}})();
</script></head>
<body ><div id="__nuxt"><div class="container pv-P0h2ZQ pc-Uzit8l app-layout" data-v-a9d5dfed data-v-77841c0a><!--[--><div class="nuxt-progress" style="width:0%;height:3px;opacity:0;background-size:Infinity% auto;" data-v-a9d5dfed></div><header class="right" data-v-a9d5dfed data-v-0528598b><div class="menu" data-v-0528598b><button aria-label="Navigation Menu" data-v-0528598b><svg width="24" height="24" viewBox="0 0 68 68" fill="currentColor" xmlns="http://www.w3.org/2000/svg" data-v-0528598b><path d="M8 34C8 32.1362 8 31.2044 8.30448 30.4693C8.71046 29.4892 9.48915 28.7105 10.4693 28.3045C11.2044 28 12.1362 28 14 28C15.8638 28 16.7956 28 17.5307 28.3045C18.5108 28.7105 19.2895 29.4892 19.6955 30.4693C20 31.2044 20 32.1362 20 34C20 35.8638 20 36.7956 19.6955 37.5307C19.2895 38.5108 18.5108 39.2895 17.5307 39.6955C16.7956 40 15.8638 40 14 40C12.1362 40 11.2044 40 10.4693 39.6955C9.48915 39.2895 8.71046 38.5108 8.30448 37.5307C8 36.7956 8 35.8638 8 34Z" data-v-0528598b></path><path d="M28 34C28 32.1362 28 31.2044 28.3045 30.4693C28.7105 29.4892 29.4892 28.7105 30.4693 28.3045C31.2044 28 32.1362 28 34 28C35.8638 28 36.7956 28 37.5307 28.3045C38.5108 28.7105 39.2895 29.4892 39.6955 30.4693C40 31.2044 40 32.1362 40 34C40 35.8638 40 36.7956 39.6955 37.5307C39.2895 38.5108 38.5108 39.2895 37.5307 39.6955C36.7956 40 35.8638 40 34 40C32.1362 40 31.2044 40 30.4693 39.6955C29.4892 39.2895 28.7105 38.5108 28.3045 37.5307C28 36.7956 28 35.8638 28 34Z" data-v-0528598b></path><path d="M48 34C48 32.1362 48 31.2044 48.3045 30.4693C48.7105 29.4892 49.4892 28.7105 50.4693 28.3045C51.2044 28 52.1362 28 54 28C55.8638 28 56.7956 28 57.5307 28.3045C58.5108 28.7105 59.2895 29.4892 59.6955 30.4693C60 31.2044 60 32.1362 60 34C60 35.8638 60 36.7956 59.6955 37.5307C59.2895 38.5108 58.5108 39.2895 57.5307 39.6955C56.7956 40 55.8638 40 54 40C52.1362 40 51.2044 40 50.4693 39.6955C49.4892 39.2895 48.7105 38.5108 48.3045 37.5307C48 36.7956 48 35.8638 48 34Z" data-v-0528598b></path></svg></button></div><div class="overlay" data-v-0528598b><nav data-v-0528598b data-v-f1645879><ul data-v-f1645879><!--[--><li data-v-f1645879><a href="/" class="" data-v-f1645879><span class="underline-fx" data-v-f1645879></span> Home</a></li><li data-v-f1645879><a href="/contact" class="" data-v-f1645879><span class="underline-fx" data-v-f1645879></span> Contact</a></li><li data-v-f1645879><a href="/posts" class="" data-v-f1645879><span class="underline-fx" data-v-f1645879></span> Archive</a></li><!--]--></ul></nav></div><div class="logo" data-v-0528598b><a href="/" class="" data-v-0528598b><img src="/logo-dark.svg" class="dark-img" alt="alpine" width="89" height="31" data-v-0528598b><img src="/logo.svg" class="light-img" alt="alpine" width="89" height="31" data-v-0528598b></a></div><div class="main-nav" data-v-0528598b><nav data-v-0528598b data-v-f1645879><ul data-v-f1645879><!--[--><li data-v-f1645879><a href="/" class="" data-v-f1645879><span class="underline-fx" data-v-f1645879></span> Home</a></li><li data-v-f1645879><a href="/contact" class="" data-v-f1645879><span class="underline-fx" data-v-f1645879></span> Contact</a></li><li data-v-f1645879><a href="/posts" class="" data-v-f1645879><span class="underline-fx" data-v-f1645879></span> Archive</a></li><!--]--></ul></nav></div></header><!--[--><div class="document-driven-page"><main><!--[--><div><p data-v-f4c85dbd><!--[-->The code for this guide is in <a href="https://github.com/viktorfa/strapi-4-serverless-guide" rel="nofollow" data-v-d83694f9><!--[-->this Github repo<!--]--></a>.<!--]--></p><p data-v-f4c85dbd><!--[-->I earlier wrote <a href="/posts/serverless-strapi-tutorial/" class="" data-v-d83694f9><!--[-->a guide<!--]--></a> on how to use Strapi 3 on AWS Lambda. Now that a new non-backward-compatible Strapi version is released, it’s time to make a new guide for Strapi 4.<!--]--></p><p data-v-f4c85dbd><!--[-->Hosting Strapi on Lambda comes with some restrictions, as some features and plugins will not work.<!--]--></p><p data-v-f4c85dbd><!--[-->However, using Lambda to host Strapi is a great way to create a scalable deployment where you pay as you go, can enjoy Amazon’s generous free tier, and don’t need to worry about server updates.<!--]--></p><p data-v-f4c85dbd><!--[-->As I said in the previous article, “serverless” does not mean there are no servers. It means that the developer or organization can minimize the concern about managing servers. Ideally, serverless applications should be scalable and priced in a pay-for-what-you-use basis.<!--]--></p><h2 id="strapi-4-databases" data-v-6d609909><a aria-current="page" href="/posts/serverless-strapi-4-guide#strapi-4-databases" class="router-link-active router-link-exact-active" data-v-6d609909><!--[-->Strapi 4 databases<!--]--><!----></a></h2><p data-v-f4c85dbd><!--[-->Unfortunately, Strapi 4 does not support using MongoDB. I this this is kinda bad, because it’s so easy to get free managed MongoDB hosting with Mongo Atlas. We will use PostgreSQL from AWS RDS in this guide, as they offer a free tier for 12 months.<!--]--></p><h2 id="what-tools-we-will-use" data-v-6d609909><a aria-current="page" href="/posts/serverless-strapi-4-guide#what-tools-we-will-use" class="router-link-active router-link-exact-active" data-v-6d609909><!--[-->What tools we will use<!--]--><!----></a></h2><p data-v-f4c85dbd><!--[-->This guide will use<!--]--></p><ul data-v-b9ad2675><!--[--><li data-v-3181147b><!--[-->Unix command line<!--]--></li><li data-v-3181147b><!--[-->Serverless Framework<!--]--></li><li data-v-3181147b><!--[-->Strapi 4<!--]--></li><li data-v-3181147b><!--[-->Node and Yarn (NPM will also work)<!--]--></li><li data-v-3181147b><!--[-->An AWS account<!--]--></li><!--]--></ul><h2 id="set-up-strapi" data-v-6d609909><a aria-current="page" href="/posts/serverless-strapi-4-guide#set-up-strapi" class="router-link-active router-link-exact-active" data-v-6d609909><!--[-->Set up Strapi<!--]--><!----></a></h2><div class="highlight-bash prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">yarn</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> create</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> strapi-app</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> serverless-strapi-4-guide</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF"> --quickstart
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:945/946;" src="/posts/serverless-strapi-4-guide/create_strapi_app.png" alt="create strapi app.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->This will create a new folder and automatically install the dependencies, start Strapi and open a browser window. If it does not open, just visit <a href="http://localhost:1337/admin" rel="nofollow" data-v-d83694f9><!--[-->http://localhost:1337/admin<!--]--></a> to see the admin dashboard. You can register a user to see that it works, but we will change databases and not use this user later.<!--]--></p><p data-v-f4c85dbd><!--[-->Change to the newly created folder.<!--]--></p><h2 id="set-up-the-serverless-framework" data-v-6d609909><a aria-current="page" href="/posts/serverless-strapi-4-guide#set-up-the-serverless-framework" class="router-link-active router-link-exact-active" data-v-6d609909><!--[-->Set up the Serverless framework<!--]--><!----></a></h2><p data-v-f4c85dbd><!--[-->Install the dependencies and create a basic configuration in <code class="" data-v-69006e27><!--[-->serverless.yml<!--]--></code><!--]--></p><div class="highlight-bash prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> serverless
</span></span><span class="line" line="2"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">yarn</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> add</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF"> -D</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> serverless-offline
</span></span><span class="line" line="3"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">yarn</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> add</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> serverless-http</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> pg
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><div class="highlight-yaml prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-yaml shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D"># serverless.yml
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">service</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">strapi-4-serverless-guide
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">frameworkVersion</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;3&quot;
</span></span><span class="line" line="6"><span emptylineplaceholder="true">
</span></span><span class="line" line="7"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">provider</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="8"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  name</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">aws
</span></span><span class="line" line="9"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  runtime</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">nodejs16.x
</span></span><span class="line" line="10"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  region</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">eu-central-1</span><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D"> # NOTE: Update to your region
</span></span><span class="line" line="11"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  logRetentionInDays</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">1
</span></span><span class="line" line="12"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  versionFunctions</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">false
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  memorySize</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">2048
</span></span><span class="line" line="15"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  timeout</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">30
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">package</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="18"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  excludeDevDependencies</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">true
</span></span><span class="line" line="19"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  exclude</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;**/**&quot;
</span></span><span class="line" line="20"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  include</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;src/**&quot;
</span></span><span class="line" line="21"><span emptylineplaceholder="true">
</span></span><span class="line" line="22"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">functions</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="23"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  hello</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="24"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    handler</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">src/app.hello
</span></span><span class="line" line="25"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    events</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="26"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">http</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="27"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          path</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">/
</span></span><span class="line" line="28"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          method</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">ANY
</span></span><span class="line" line="29"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          cors</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">true
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">http</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="31"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          path</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">/{any+}
</span></span><span class="line" line="32"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          method</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">ANY
</span></span><span class="line" line="33"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          cors</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">true
</span></span><span class="line" line="34"><span emptylineplaceholder="true">
</span></span><span class="line" line="35"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">plugins</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">serverless-offline
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->We will first make a simple function just to see that we can run Serverless locally and deploy it without problems.<!--]--></p><p data-v-f4c85dbd><!--[-->Create a file with a handler in <code class="" data-v-69006e27><!--[-->src/app.js<!--]--></code><!--]--></p><div class="highlight-javascript prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-javascript shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D">// src/app.js
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">module</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">hello</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> async</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">event</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">context</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  return</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    body: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">JSON</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">stringify</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">({ message: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;Hello from Serverless&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> }),
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    headers: { </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;Content-Type&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;application/json&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> },
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  };
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">};
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->Check that Serverless offline works with<!--]--></p><div class="highlight-bash prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">yarn</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> serverless</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> offline
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->Go to <a href="http://localhost:3000/dev" rel="nofollow" data-v-d83694f9><!--[-->http://localhost:3000/dev<!--]--></a> in your browser where you should get the response from <code class="" data-v-69006e27><!--[-->src/app.js<!--]--></code><!--]--></p><p data-v-f4c85dbd><!--[-->Now, deploy the function to the AWS cloud.<!--]--></p><div class="highlight-bash prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">yarn</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> serverless</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> deploy
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->If you have not used the Serverless framework before, you have to do some configuration. Create a role for serverless and make a user with the client id and client secret in <code class="" data-v-69006e27><!--[-->~/.aws/credentials<!--]--></code>. See <a href="https://www.serverless.com/framework/docs/providers/aws/guide/credentials/" rel="nofollow" data-v-d83694f9><!--[-->the guide<!--]--></a> from Serverless on how to do this on. If you don&#39;t have an AWS account yet, you can register one in the <a href="https://aws.amazon.com/console/" rel="nofollow" data-v-d83694f9><!--[-->AWS console<!--]--></a>.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:382/88;" src="/posts/serverless-strapi-4-guide/aws_credentials_file.png" alt="aws credentials file.png" data-v-80d56572><em data-v-4353b993><!--[-->This is the profile this guide will use from ~/.aws/credentials<!--]--></em><!--]--></p><div class="highlight-bash prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">yarn</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> serverless</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> deploy</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF"> --aws-profile</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> strapi-serverless-admin
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:952/324;" src="/posts/serverless-strapi-4-guide/serverless_hello_deployed.png" alt="./serverless hello deployed.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->It should now be deployed and available on the url showed in the terminal. Visit the url to be sure that it works.<!--]--></p><h2 id="creating-a-postgresql-database" data-v-6d609909><a aria-current="page" href="/posts/serverless-strapi-4-guide#creating-a-postgresql-database" class="router-link-active router-link-exact-active" data-v-6d609909><!--[-->Creating a PostgreSQL database<!--]--><!----></a></h2><p data-v-f4c85dbd><!--[-->If you already have a database you want to use with Strapi, you can skip this step and just configure <code class="" data-v-69006e27><!--[-->config/database.js<!--]--></code> to connect to it. See the Strapi docs for more information.<!--]--></p><p data-v-f4c85dbd><!--[-->This guide will set up a free tier PostgreSQL database in AWS. This is a good choice as it&#39;s free for 12 months and has good enough performance for using Strapi as a CMS. Having the database in the AWS system is also practical, as we don&#39;t need to subscribe to more services.
You can choose to use serverless AWS Aurora with PostgreSQL compatibility, but this offering does not have a free tier and will cost about 0.70$ per day for the cheapest option.<!--]--></p><p data-v-f4c85dbd><!--[-->We will create the database in the AWS web console using so called &quot;click ops&quot;. We could use CloudFormation and so called &quot;infastructure as code&quot;. But it&#39;s quite cumbersome to define an Aurora database cluster in CloudFormation because of the sheer size and readability of the yaml file, the creation of a master password which is of risk of being leaked, and the risk of accidental deletion of the database when automatically updating the CloudFormation stack.<!--]--></p><p data-v-f4c85dbd><!--[-->Go to the AWS web console and remember to switch to the region you want to deploy to. This guide will use eu-central-1. Search for RDS in the search bar and select RDS. Click the button to create a new database.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:974/518;" src="/posts/serverless-strapi-4-guide/select_rds.png" alt="select rds.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->Select PostgreSQL as the database. It&#39;s probably a good idea to select the latest PostgreSQL version. Choose a cluster name, username and password. It&#39;s not a good idea to use the default username, as this makes the database more vulnerable to bots who automatically guess credentials. <a href="https://passwordsgenerator.net/" rel="nofollow" data-v-d83694f9><!--[-->Generate a password<!--]--></a> 32 characters long with only letters and numbers as some special characters are not supported. Copy and paste the password somewhere as you will not see the password again.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:812/895;" src="/posts/serverless-strapi-4-guide/create_postgres_1.png" alt="create postgres 1.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->Choose the default db.t3.micro instance. You can of course modify the configuration to fit your needs, but this guide will choose the cheapest options. Select to create a new VPC.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:784/878;" src="/posts/serverless-strapi-4-guide/create_postgres_2.png" alt="create postgres 2.png" data-v-80d56572><img style="aspect-ratio:776/893;" src="/posts/serverless-strapi-4-guide/create_postgres_3.png" alt="create postgres 3.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->Check the &quot;Allow public access&quot; option and select create to create a new VPC security group.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:761/894;" src="/posts/serverless-strapi-4-guide/create_postgres_4.png" alt="create postgres 4.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->Monitoring can be useful if you plan to use this database in production, but it will add some cost if you go above the free tier of CloudWatch logs. Choose an initial database name such as &quot;strapi4&quot;. The rest of the options can just the the default ones.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:775/886;" src="/posts/serverless-strapi-4-guide/create_postgres_5.png" alt="create postgres 5.png" data-v-80d56572><img style="aspect-ratio:770/897;" src="/posts/serverless-strapi-4-guide/create_postgres_6.png" alt="create postgres 6.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->Scroll down and click the button to create the database. You will need to wait about 5 minutes for the instance to be ready. When it&#39;s ready you can see the endpoint which we will use to connect to the database from Strapi.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:1576/387;" src="/posts/serverless-strapi-4-guide/creating_postgres.png" alt="creating postgres.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->The last thing is to enable access from all IP addresses. Since we generated a long password, this is not a considerable security risk for most cases.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:1390/811;" src="/posts/serverless-strapi-4-guide/postgres_overview.png" alt="postgres overview.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->Under &quot;Security&quot; in the instance overview, select the VPC security group. Go to &quot;Inbound rules&quot; and click &quot;Edit inbound rules&quot;. Select &quot;Anywhere-IPv4&quot; under &quot;Source&quot; and save.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:1550/383;" src="/posts/serverless-strapi-4-guide/select_inbound_rules.png" alt="select inbound rules.png" data-v-80d56572><img style="aspect-ratio:1796/440;" src="/posts/serverless-strapi-4-guide/security_group_anywhere.png" alt="security group anywhere.png" data-v-80d56572><!--]--></p><h2 id="connecting-to-the-new-database-with-strapi" data-v-6d609909><a aria-current="page" href="/posts/serverless-strapi-4-guide#connecting-to-the-new-database-with-strapi" class="router-link-active router-link-exact-active" data-v-6d609909><!--[-->Connecting to the new database with Strapi<!--]--><!----></a></h2><p data-v-f4c85dbd><!--[-->Now that we have a database, we can configure Strapi to connect to it.<!--]--></p><p data-v-f4c85dbd><!--[-->Populate the <code class="" data-v-69006e27><!--[-->.env<!--]--></code> file with the credentials, database name and the host name.<!--]--></p><div class="highlight-null prose-code" data-v-ef0b30fc><!----><!--[--><pre class="" style=""><!--[--><code># ...
# Change to the values from the database configuration

SERVER_URL=&quot;https://localhost:3000/dev&quot;
DATABASE_PASSWORD=ENTER_YOUR_DATABASE_PASSWORD
DATABASE_USERNAME=strapi_4_owner
DATABASE_NAME=strapi4
DATABASE_HOST=&quot;strapi-serverless-postgres.YOUR_HASH.eu-central-1.rds.amazonaws.com&quot;
</code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->Then edit <code class="" data-v-69006e27><!--[-->config/database.js<!--]--></code> to the following<!--]--></p><div class="highlight-javascript prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-javascript shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D">// config/database.js
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">module</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> ({
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  connection: {
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    client: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;postgres&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">,
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    connection: {
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      host: </span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;DATABASE_HOST&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      port: env.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">int</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;DATABASE_PORT&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">5432</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      database: </span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;DATABASE_NAME&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      user: </span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;DATABASE_USERNAME&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      password: </span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;DATABASE_PASSWORD&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      schema: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;public&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">,
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      ssl: {
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">        rejectUnauthorized: env.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">bool</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;DATABASE_SSL_SELF&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">false</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">), </span><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D">// For self-signed certificates
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      },
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    },
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    debug: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">false</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">,
</span></span><span class="line" line="18"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D">    // The connection pool can be adjusted, but these minimal limits seem to work well.
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    pool: {
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      min: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">,
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      max: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">,
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      idleTimeoutMillis: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">500</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">,
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    },
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  },
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">});
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->Run Strapi in development again to see that it works. You can now register a new user and create a content type if you want.<!--]--></p><div class="highlight-bash prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">yarn</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> develop
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->If everything works, we are ready to deploy to Lambda.  If <code class="" data-v-69006e27><!--[-->yarn develop<!--]--></code> does not work properly, you might have to delete the <code class="" data-v-69006e27><!--[-->build<!--]--></code> folder which is created whenever you run <code class="" data-v-69006e27><!--[-->yarn build<!--]--></code>.<!--]--></p><h2 id="strapi-with-serverless" data-v-6d609909><a aria-current="page" href="/posts/serverless-strapi-4-guide#strapi-with-serverless" class="router-link-active router-link-exact-active" data-v-6d609909><!--[-->Strapi with Serverless<!--]--><!----></a></h2><p data-v-f4c85dbd><!--[-->We have to configure Strapi in a certain way to make it work.<!--]--></p><div class="highlight-javascript prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-javascript shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D">// config/server.js
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> getUrl</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  if</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (process.argv.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">join</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot; &quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">).</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">includes</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;strapi develop&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">)) {
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> &quot;&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">;
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  } </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">else</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (env.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">bool</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;IS_OFFLINE&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">||</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> env.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">bool</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;BUILD_FOR_OFFLINE&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">)) {
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> &quot;http://localhost:3000/dev&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  } </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">else</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="9"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;SERVER_URL&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;dev&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">);
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  }
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">};
</span></span><span class="line" line="12"><span emptylineplaceholder="true">
</span></span><span class="line" line="13"><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">module</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> ({
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  host: </span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;HOST&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;0.0.0.0&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  port: env.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">int</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;PORT&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">1337</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  app: {
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    keys: env.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">array</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;APP_KEYS&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  },
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  url: </span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">getUrl</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">({ env }),
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">});
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><div class="highlight-javascript prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-javascript shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D">// config/admin.js
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> getUrl</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  if</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (process.argv.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">join</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot; &quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">).</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">includes</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;strapi develop&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">)) {
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> &quot;admin&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">;
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  } </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">else</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> &quot;dev/admin&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  }
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">};
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">module</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> ({
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  auth: {
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    secret: </span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;ADMIN_JWT_SECRET&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  },
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  apiToken: {
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    salt: </span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">env</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;API_TOKEN_SALT&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">),
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  },
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  url: </span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">getUrl</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(),
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  autoOpen: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">false</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">,
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">});
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->Before we run it in with Serverless, we need to update <code class="" data-v-69006e27><!--[-->src/app.js<!--]--></code> and <code class="" data-v-69006e27><!--[-->serverless.yml<!--]--></code>.<!--]--></p><div class="highlight-javascript prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-javascript shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D">// src/app.js
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF"> serverless</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;serverless-http&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">);
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF"> Strapi</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;@strapi/strapi/lib/index.js&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">);
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">module</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">hello</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> async</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">event</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">context</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  return</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    body: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">JSON</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">stringify</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">({ message: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;Hello from Serverless&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> }),
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    headers: { </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;Content-Type&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;application/json&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> },
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  };
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">};
</span></span><span class="line" line="12"><span emptylineplaceholder="true">
</span></span><span class="line" line="13"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> startStrapi</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> async</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">strapi</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="14"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  try</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="15"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    if</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">!</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">strapi.isLoaded) {
</span></span><span class="line" line="16"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">      await</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> strapi.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">load</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">();
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    }
</span></span><span class="line" line="18"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    await</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> strapi.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">postListen</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">();
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    strapi.server.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">mount</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">();
</span></span><span class="line" line="20"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> strapi;
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  } </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">catch</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (error) {
</span></span><span class="line" line="22"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> strapi.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">stopWithError</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(error);
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  }
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">};
</span></span><span class="line" line="25"><span emptylineplaceholder="true">
</span></span><span class="line" line="26"><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">module</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">strapiHandler</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> async</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">event</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-default:#E36209;--shiki-dark:#FFAB70">context</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> {
</span></span><span class="line" line="27"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  let</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> workingDir </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> process.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">cwd</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">();
</span></span><span class="line" line="28"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  if</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (process.env.</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">LAMBDA_TASK_ROOT</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> &amp;&amp;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> process.env.</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">IS_OFFLINE</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> !==</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> &quot;true&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">) {
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    workingDir </span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> process.env.</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">LAMBDA_TASK_ROOT</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">;
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  }
</span></span><span class="line" line="31"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  if</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">!</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">global.strapi) {
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    console.</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">info</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;Cold starting Strapi&quot;</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">);
</span></span><span class="line" line="33"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">    Strapi</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">({ dir: workingDir });
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  }
</span></span><span class="line" line="35"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  if</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">!</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">global.strapi.isLoaded) {
</span></span><span class="line" line="36"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">    await</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> startStrapi</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(global.strapi);
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  }
</span></span><span class="line" line="38"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF"> handler</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> serverless</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(global.strapi.server.app);
</span></span><span class="line" line="39"><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">  return</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> handler</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">(event, context);
</span></span><span class="line" line="40"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">};
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><div class="highlight-yaml prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-yaml shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D"># serverless.yml
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">service</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">strapi-4-serverless-guide
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">frameworkVersion</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;3&quot;
</span></span><span class="line" line="6"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">useDotenv</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">true
</span></span><span class="line" line="7"><span emptylineplaceholder="true">
</span></span><span class="line" line="8"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">provider</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="9"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  name</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">aws
</span></span><span class="line" line="10"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  runtime</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">nodejs16.x
</span></span><span class="line" line="11"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  region</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">eu-central-1</span><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D"> # NOTE: Update to your region
</span></span><span class="line" line="12"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  profile</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">strapi-serverless-admin</span><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D"> # NOTE: Update to your profile name as in ~/.aws/credentials
</span></span><span class="line" line="13"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  logRetentionInDays</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">1
</span></span><span class="line" line="14"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  versionFunctions</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">false
</span></span><span class="line" line="15"><span emptylineplaceholder="true">
</span></span><span class="line" line="16"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  memorySize</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">2048
</span></span><span class="line" line="17"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  timeout</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">30
</span></span><span class="line" line="18"><span emptylineplaceholder="true">
</span></span><span class="line" line="19"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  environment</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="20"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    APP_KEYS</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">${env:APP_KEYS}
</span></span><span class="line" line="21"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    API_TOKEN_SALT</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">${env:API_TOKEN_SALT}
</span></span><span class="line" line="22"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    ADMIN_JWT_SECRET</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">${env:ADMIN_JWT_SECRET}
</span></span><span class="line" line="23"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    JWT_SECRET</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">${env:JWT_SECRET}
</span></span><span class="line" line="24"><span emptylineplaceholder="true">
</span></span><span class="line" line="25"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    SERVER_URL</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">${env:SERVER_URL}
</span></span><span class="line" line="26"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    DATABASE_PASSWORD</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">${env:DATABASE_PASSWORD}
</span></span><span class="line" line="27"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    DATABASE_USERNAME</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">${env:DATABASE_USERNAME}
</span></span><span class="line" line="28"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    DATABASE_NAME</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">${env:DATABASE_NAME}
</span></span><span class="line" line="29"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    DATABASE_HOST</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">${env:DATABASE_HOST}
</span></span><span class="line" line="30"><span emptylineplaceholder="true">
</span></span><span class="line" line="31"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">package</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="32"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  excludeDevDependencies</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">true
</span></span><span class="line" line="33"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  exclude</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;**&quot;
</span></span><span class="line" line="35"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  include</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;build/**&quot;
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;config/**&quot;
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;database/**&quot;
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;node_modules/**&quot;
</span></span><span class="line" line="40"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;public/**&quot;
</span></span><span class="line" line="41"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;src/**&quot;
</span></span><span class="line" line="42"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;.env.example&quot;
</span></span><span class="line" line="43"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;package.json&quot;
</span></span><span class="line" line="44"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;!node_modules/esbuild-linux-64/**&quot;
</span></span><span class="line" line="45"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;!node_modules/@babel/**&quot;
</span></span><span class="line" line="46"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;!node_modules/@types/**&quot;
</span></span><span class="line" line="47"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;!node_modules/webpack/**&quot;
</span></span><span class="line" line="48"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">&quot;!node_modules/@sentry/**&quot;
</span></span><span class="line" line="49"><span emptylineplaceholder="true">
</span></span><span class="line" line="50"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">functions</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="51"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  api</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="52"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    handler</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">src/app.strapiHandler
</span></span><span class="line" line="53"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    events</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="54"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">http</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="55"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          path</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">/
</span></span><span class="line" line="56"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          method</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">ANY
</span></span><span class="line" line="57"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          cors</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">true
</span></span><span class="line" line="58"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">http</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="59"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          path</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">/{any+}
</span></span><span class="line" line="60"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          method</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">ANY
</span></span><span class="line" line="61"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">          cors</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">true
</span></span><span class="line" line="62"><span emptylineplaceholder="true">
</span></span><span class="line" line="63"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">plugins</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="64"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">  - </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">serverless-offline
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->Now we can check that it works with Serverless offline. First, we need to build the frontend with <code class="" data-v-69006e27><!--[-->BUILD_FOR_OFFLINE=true yarn build<!--]--></code><!--]--></p><div class="highlight-bash prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">BUILD_FOR_OFFLINE</span><span style="--shiki-default:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">true</span><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0"> yarn</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> build
</span></span><span class="line" line="2"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">serverless</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> offline
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:523/189;" src="/posts/serverless-strapi-4-guide/yarn_strapi_build.png" alt="yarn strapi build.png" data-v-80d56572><!--]--></p><p data-v-f4c85dbd><!--[-->Go to <a href="http://localhost:3000/dev/index.html" rel="nofollow" data-v-d83694f9><!--[-->http://localhost:3000/dev/index.html<!--]--></a> then log in see see that it works. Strapi is now connected to the database in the cloud and running on Lambda locally.<!--]--></p><p data-v-f4c85dbd><!--[-->We can now deploy to the cloud<!--]--></p><div class="highlight-null prose-code" data-v-ef0b30fc><!----><!--[--><pre class="" style=""><!--[--><code>serverless deploy
</code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->It should upload successfully. Note that the UI will not work, as we use <code class="" data-v-69006e27><!--[-->http://localhost:3000/dev<!--]--></code> as the SERVER_URL. After running <code class="" data-v-69006e27><!--[-->serverless deploy<!--]--></code> you should see a url in the format of <code class="" data-v-69006e27><!--[-->https://YOUR_HASH.execute-api.eu-central-1.amazonaws.com/dev<!--]--></code> in the console. Copy this and paste it in <code class="" data-v-69006e27><!--[-->.env<!--]--></code>.<!--]--></p><p data-v-f4c85dbd><!--[--><img style="aspect-ratio:727/281;" src="/posts/serverless-strapi-4-guide/serverless_deployed.png" alt="serverless deployed.png" data-v-80d56572><!--]--></p><div class="highlight-null prose-code" data-v-ef0b30fc><!----><!--[--><pre class="" style=""><!--[--><code># .env
# ...
SERVER_URL=&quot;https://YOUR_HASH.execute-api.eu-central-1.amazonaws.com/dev&quot;
# ...
</code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->You can see the logs from lambda with<!--]--></p><div class="highlight-bash prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">serverless</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> logs</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF"> -f</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> api</span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF"> -t
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->While the GUI will not work, you can check that the API works by going to <code class="" data-v-69006e27><!--[-->https://YOUR_HASH.execute-api.eu-central-1.amazonaws.com/dev/api/users<!--]--></code>. You should get a <code class="" data-v-69006e27><!--[-->403 Forbidden response<!--]--></code>. If you get a 5xx response, something is wrong, and you can check the logs to debug it.<!--]--></p><p data-v-f4c85dbd><!--[-->After you have inserted the correct <code class="" data-v-69006e27><!--[-->SERVER_URL<!--]--></code> environment variable to <code class="" data-v-69006e27><!--[-->.env<!--]--></code>, we can build and deploy again.<!--]--></p><div class="highlight-bash prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">yarn</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> build
</span></span><span class="line" line="2"><span style="--shiki-default:#6F42C1;--shiki-dark:#B392F0">serverless</span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF"> deploy
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><p data-v-f4c85dbd><!--[-->Visit <code class="" data-v-69006e27><!--[-->https://YOUR_HASH.execute-api.eu-central-1.amazonaws.com/dev<!--]--></code> and login to the GUI. The username and password you chose locally should work here too, as we use the same database.<!--]--></p><p data-v-f4c85dbd><!--[-->If it works, congratulations! You have successfully deployed Strapi with Lambda.<!--]--></p><h2 id="whats-next" data-v-6d609909><a aria-current="page" href="/posts/serverless-strapi-4-guide#whats-next" class="router-link-active router-link-exact-active" data-v-6d609909><!--[-->What&#39;s next<!--]--><!----></a></h2><h3 id="deploying-the-frontend-separately" data-v-4af47174><a aria-current="page" href="/posts/serverless-strapi-4-guide#deploying-the-frontend-separately" class="router-link-active router-link-exact-active" data-v-4af47174><!--[-->Deploying the frontend separately<!--]--><!----></a></h3><p data-v-f4c85dbd><!--[-->It&#39;s possible to split up the Strapi app and deploy the frontend on a separate static site. This will Make the initial loading of the site a little bit faster, and also save you a few requests to API Gateway and Lambda. To do this, you need to edit <code class="" data-v-69006e27><!--[-->config/admin.js<!--]--></code> and change the url to the domain you&#39;re hosting on. Then run <code class="" data-v-69006e27><!--[-->yarn build<!--]--></code> and deploy the <code class="" data-v-69006e27><!--[-->build<!--]--></code> folder to whatever static site hosting you prefer.<!--]--></p><h3 id="use-lambda-url" data-v-4af47174><a aria-current="page" href="/posts/serverless-strapi-4-guide#use-lambda-url" class="router-link-active router-link-exact-active" data-v-4af47174><!--[-->Use Lambda URL<!--]--><!----></a></h3><p data-v-f4c85dbd><!--[-->It&#39;s possible to invoke a <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-urls.html" rel="nofollow" data-v-d83694f9><!--[-->Lambda directly<!--]--></a> with HTTP without using API Gateway. This will save some cost if you go above the free tier of Lambda and API Gateway. The backside is that the Serverless Offline plugin will not work, so you can&#39;t test your app locally easily. You can use Lambda URL by adding the following to <code class="" data-v-69006e27><!--[-->serverless.yml<!--]--></code> and removing <code class="" data-v-69006e27><!--[-->dev<!--]--></code> from the url in <code class="" data-v-69006e27><!--[-->config/server.js<!--]--></code> and <code class="" data-v-69006e27><!--[-->config/admin.js<!--]--></code><!--]--></p><div class="highlight-yaml prose-code" meta data-v-ef0b30fc><!----><!--[--><pre class="language-yaml shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D"># serverless.yml
</span></span><span class="line" line="2"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D">#...
</span></span><span class="line" line="3"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">functions</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="4"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">  api-url</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="5"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    handler</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#032F62;--shiki-dark:#9ECBFF">src/app.strapiHandler
</span></span><span class="line" line="6"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">    url</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">:
</span></span><span class="line" line="7"><span style="--shiki-default:#22863A;--shiki-dark:#85E89D">      cors</span><span style="--shiki-default:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-default:#005CC5;--shiki-dark:#79B8FF">true
</span></span><span class="line" line="8"><span style="--shiki-default:#6A737D;--shiki-dark:#6A737D">#...
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-ef0b30fc data-v-2c5d870f><span class="sr-only" data-v-2c5d870f>Copy to clipboard</span><span class="icon-wrapper" data-v-2c5d870f><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-2c5d870f style="" width="18px" height="18px" viewBox="0 0 256 256" data-v-5f091540><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"/></svg></span></button></div><h3 id="further-reduce-the-package-size" data-v-4af47174><a aria-current="page" href="/posts/serverless-strapi-4-guide#further-reduce-the-package-size" class="router-link-active router-link-exact-active" data-v-4af47174><!--[-->Further reduce the package size<!--]--><!----></a></h3><p data-v-f4c85dbd><!--[-->If you use additional Strapi plugins or dependencies, your package size might get higher than the maximum limit for Lambda. More dependencies can safely be removed from <code class="" data-v-69006e27><!--[-->node_modules<!--]--></code> by adding them under <code class="" data-v-69006e27><!--[-->include<!--]--></code> in <code class="" data-v-69006e27><!--[-->serverless.yml<!--]--></code>. All the frontend dependencies can be safely removed if you host the frontend separately.<!--]--></p><h3 id="deploy-several-strapi-instances" data-v-4af47174><a aria-current="page" href="/posts/serverless-strapi-4-guide#deploy-several-strapi-instances" class="router-link-active router-link-exact-active" data-v-4af47174><!--[-->Deploy several Strapi instances<!--]--><!----></a></h3><p data-v-f4c85dbd><!--[-->If you need to deploy several Strapi instances, you can configure this project differently or just make several copies of the project. Each instance needs its own database, but you can use the same AWS PostgreSQL database cluster for several databases without any extra cost. Just create a new database with an SQL query in PostgreSQL.<!--]--></p><h3 id="upload-images-and-static-assets" data-v-4af47174><a aria-current="page" href="/posts/serverless-strapi-4-guide#upload-images-and-static-assets" class="router-link-active router-link-exact-active" data-v-4af47174><!--[-->Upload images and static assets<!--]--><!----></a></h3><p data-v-f4c85dbd><!--[-->You can use S3 to host your images and static assets in Strapi. The <a href="/posts/serverless-strapi-tutorial/" class="" data-v-d83694f9><!--[-->previous guide<!--]--></a> explains how to do this in Strapi 3. It should be fairly similar to do it in Strapi 4.<!--]--></p><h2 id="feedback" data-v-6d609909><a aria-current="page" href="/posts/serverless-strapi-4-guide#feedback" class="router-link-active router-link-exact-active" data-v-6d609909><!--[-->Feedback<!--]--><!----></a></h2><p data-v-f4c85dbd><!--[-->Mention me on Twitter on @vikfand or send a mail to <a href="mailto:vikfand@gmail.com" rel="noopener noreferrer" data-v-d83694f9><!--[-->vikfand@gmail.com<!--]--></a>.<!--]--></p><p data-v-f4c85dbd><!--[-->Check the <a href="https://github.com/viktorfa/strapi-4-serverless-guide" rel="nofollow" data-v-d83694f9><!--[-->Github repo<!--]--></a> for the full code used.<!--]--></p><style>html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}</style></div><!--]--></main></div><!--]--><footer class="center" data-v-a9d5dfed data-v-654b05f0><a href="https://www.github.com/nuxt-themes/alpine" rel="noopener noreferrer" class="credits" data-v-654b05f0>Alpine</a><div class="navigation" data-v-654b05f0><nav data-v-654b05f0 data-v-f1645879><ul data-v-f1645879><!--[--><li data-v-f1645879><a href="/" class="" data-v-f1645879><span class="underline-fx" data-v-f1645879></span> Home</a></li><li data-v-f1645879><a href="/contact" class="" data-v-f1645879><span class="underline-fx" data-v-f1645879></span> Contact</a></li><li data-v-f1645879><a href="/posts" class="" data-v-f1645879><span class="underline-fx" data-v-f1645879></span> Archive</a></li><!--]--></ul></nav></div><p class="message" data-v-654b05f0>Follow me on</p><div class="icons" data-v-654b05f0><div class="social" data-v-654b05f0><!--[--><a href="https://twitter.com/vikfand" rel="noopener noreferrer" target="_blank" title="vikfand" aria-label="vikfand" data-v-bb750848><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-bb750848 style="" width="1em" height="1em" viewBox="0 0 24 24" data-v-5f091540><path fill="currentColor" d="M22 5.8a8.49 8.49 0 0 1-2.36.64a4.13 4.13 0 0 0 1.81-2.27a8.21 8.21 0 0 1-2.61 1a4.1 4.1 0 0 0-7 3.74a11.64 11.64 0 0 1-8.45-4.29a4.16 4.16 0 0 0-.55 2.07a4.09 4.09 0 0 0 1.82 3.41a4.05 4.05 0 0 1-1.86-.51v.05a4.1 4.1 0 0 0 3.3 4a3.93 3.93 0 0 1-1.1.17a4.9 4.9 0 0 1-.77-.07a4.11 4.11 0 0 0 3.83 2.84A8.22 8.22 0 0 1 3 18.34a7.93 7.93 0 0 1-1-.06a11.57 11.57 0 0 0 6.29 1.85A11.59 11.59 0 0 0 20 8.45v-.53a8.43 8.43 0 0 0 2-2.12Z"/></svg></a><a href="https://instagram.com/viktorfandersen" rel="noopener noreferrer" target="_blank" title="viktorfandersen" aria-label="viktorfandersen" data-v-bb750848><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-bb750848 style="" width="1em" height="1em" viewBox="0 0 24 24" data-v-5f091540><path fill="currentColor" d="M17.34 5.46a1.2 1.2 0 1 0 1.2 1.2a1.2 1.2 0 0 0-1.2-1.2Zm4.6 2.42a7.59 7.59 0 0 0-.46-2.43a4.94 4.94 0 0 0-1.16-1.77a4.7 4.7 0 0 0-1.77-1.15a7.3 7.3 0 0 0-2.43-.47C15.06 2 14.72 2 12 2s-3.06 0-4.12.06a7.3 7.3 0 0 0-2.43.47a4.78 4.78 0 0 0-1.77 1.15a4.7 4.7 0 0 0-1.15 1.77a7.3 7.3 0 0 0-.47 2.43C2 8.94 2 9.28 2 12s0 3.06.06 4.12a7.3 7.3 0 0 0 .47 2.43a4.7 4.7 0 0 0 1.15 1.77a4.78 4.78 0 0 0 1.77 1.15a7.3 7.3 0 0 0 2.43.47C8.94 22 9.28 22 12 22s3.06 0 4.12-.06a7.3 7.3 0 0 0 2.43-.47a4.7 4.7 0 0 0 1.77-1.15a4.85 4.85 0 0 0 1.16-1.77a7.59 7.59 0 0 0 .46-2.43c0-1.06.06-1.4.06-4.12s0-3.06-.06-4.12ZM20.14 16a5.61 5.61 0 0 1-.34 1.86a3.06 3.06 0 0 1-.75 1.15a3.19 3.19 0 0 1-1.15.75a5.61 5.61 0 0 1-1.86.34c-1 .05-1.37.06-4 .06s-3 0-4-.06a5.73 5.73 0 0 1-1.94-.3a3.27 3.27 0 0 1-1.1-.75a3 3 0 0 1-.74-1.15a5.54 5.54 0 0 1-.4-1.9c0-1-.06-1.37-.06-4s0-3 .06-4a5.54 5.54 0 0 1 .35-1.9A3 3 0 0 1 5 5a3.14 3.14 0 0 1 1.1-.8A5.73 5.73 0 0 1 8 3.86c1 0 1.37-.06 4-.06s3 0 4 .06a5.61 5.61 0 0 1 1.86.34a3.06 3.06 0 0 1 1.19.8a3.06 3.06 0 0 1 .75 1.1a5.61 5.61 0 0 1 .34 1.9c.05 1 .06 1.37.06 4s-.01 3-.06 4ZM12 6.87A5.13 5.13 0 1 0 17.14 12A5.12 5.12 0 0 0 12 6.87Zm0 8.46A3.33 3.33 0 1 1 15.33 12A3.33 3.33 0 0 1 12 15.33Z"/></svg></a><a href="https://www.linkedin.com/in/viktor-frede-andersen-31650153/" rel="noopener noreferrer" target="_blank" title="LinkedIn" aria-label="LinkedIn" data-v-bb750848><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon" data-v-bb750848 style="" width="1em" height="1em" viewBox="0 0 24 24" data-v-5f091540><path fill="currentColor" d="M20.47 2H3.53a1.45 1.45 0 0 0-1.47 1.43v17.14A1.45 1.45 0 0 0 3.53 22h16.94a1.45 1.45 0 0 0 1.47-1.43V3.43A1.45 1.45 0 0 0 20.47 2ZM8.09 18.74h-3v-9h3ZM6.59 8.48a1.56 1.56 0 1 1 0-3.12a1.57 1.57 0 1 1 0 3.12Zm12.32 10.26h-3v-4.83c0-1.21-.43-2-1.52-2A1.65 1.65 0 0 0 12.85 13a2 2 0 0 0-.1.73v5h-3v-9h3V11a3 3 0 0 1 2.71-1.5c2 0 3.45 1.29 3.45 4.06Z"/></svg></a><!--]--></div><div class="color-mode-switch" data-v-654b05f0><button aria-label="Color Mode" data-v-654b05f0 data-v-fd50f6ca><span data-v-fd50f6ca></span></button></div></div></footer><!--]--></div></div></body>
</html>